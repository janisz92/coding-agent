{
  "createdAt": "2026-01-11T16:02:56.012Z",
  "maxReadBytes": 400000,
  "files": {
    ".agent_baseline.json": {
      "bytes": 103356,
      "content": "{\n  \"createdAt\": \"2026-01-11T15:57:59.202Z\",\n  \"maxReadBytes\": 400000,\n  \"files\": {\n    \".agent_baseline.json\": {\n      \"bytes\": 825450,\n      \"content\": null\n    },\n    \".gitignore\": {\n      \"bytes\": 538,\n      \"content\": \"# =====================\\r\\n# Environment variables\\r\\n# =====================\\r\\n\\r\\n.env\\r\\n.env.*\\r\\n!.env.example\\r\\n\\r\\n# =====================\\r\\n# Node / build artifacts\\r\\n# =====================\\r\\n\\r\\nnode_modules/\\r\\ndist/\\r\\nbuild/\\r\\n\\r\\n# =====================\\r\\n# Logs & agent artifacts\\r\\n# =====================\\r\\n\\r\\nagent.raw.txt\\r\\nagent.diff.txt\\r\\n.agent_baseline.json\\r\\n\\r\\n# =====================\\r\\n# OS / editor junk\\r\\n# =====================\\r\\n\\r\\n.DS_Store\\r\\nThumbs.db\\r\\n\\r\\n# =====================\\r\\n# TypeScript / tooling\\r\\n# =====================\\r\\n\\r\\n*.tsbuildinfo\\r\\n\"\n    },\n    \"README.md\": {\n      \"bytes\": 6444,\n      \"content\": \"# coding-agent\\n\\nMinimalny agent do edycji plików w repozytorium przy użyciu tool-calling (OpenAI). Działa jako CLI, które:\\n- uruchamia pętlę agenta z zestawem narzędzi do pracy na plikach (listowanie, odczyt, zapis, usuwanie, wyszukiwanie),\\n- loguje pełny przebieg do pliku agent.raw.txt,\\n- próbuje zapisać raport zmian git diff do agent.diff.txt (jeśli repo jest repozytorium git).\\n\\n## Wymagania\\n- Node.js >= 18\\n- Klucz API do OpenAI (zmienna środowiskowa OPENAI_API_KEY)\\n\\n## Instalacja\\n1) Zainstaluj zależności:\\n\\n```\\nnpm install\\n```\\n\\n2) Skonfiguruj zmienne środowiskowe. Najprościej skopiować plik przykładowy:\\n\\n```\\ncp .env.example .env\\n```\\n\\nUzupełnij w .env wartość OPENAI_API_KEY. Opcjonalnie możesz ustawić OPENAI_MODEL (domyślnie: \\\"gpt-5\\\").\\n\\n## Użycie CLI\\nSkładnia (zdefiniowana w src/cli.ts):\\n\\n```\\nnpm run dev -- edit  \\\"<OPIS>\\\" --repo <ścieżka>\\n```\\n\\n- OPIS: tekstowe zadanie dla agenta (np. „Dodaj plik README.md w root repo”).\\n- --repo: ścieżka do katalogu repo, w którym agent ma pracować. Jeśli nie podasz, użyty zostanie bieżący katalog.\\n\\nPrzykład:\\n\\n```\\nnpm run dev -- edit \\\"Dodaj plik CONTRIBUTING.md z podstawowymi zasadami\\\" --repo .\\n```\\n\\nPo zakończeniu działania:\\n- agent.raw.txt zawiera surowy log komunikacji i wywołań narzędzi,\\n- agent.diff.txt (jeśli git diff działa) zawiera różnice względem HEAD.\\n\\n## Funkcje i narzędzia agenta\\nAgent działa na podstawie tool-calling i udostępnia następujące narzędzia (patrz src/agent/tools.ts):\\n- list_files: listowanie plików w repo (z pominięciem ścieżek z denylisty),\\n- read_file: odczyt pliku tekstowego,\\n- write_file: zapis/utworzenie pliku (wymaga podania pełnej nowej treści),\\n- delete_file: usunięcie pliku,\\n- search_in_files: proste wyszukiwanie podciągów w plikach,\\n- get_baseline_info: metadane snapshotu stanu początkowego repo (tworzony automatycznie na starcie agenta),\\n- list_changed_files: lista plików added/modified/deleted względem snapshotu,\\n- read_file_original: odczyt oryginalnej wersji pliku ze snapshotu (dla porównań punktowych),\\n- diff_file_against_original: prosty unified diff aktualnej zawartości względem snapshotu,\\n- apply_patch: zastosowanie prostego unified patcha (bez nagłówków hunk) do jednego lub wielu plików.\\n\\nSnapshot zapisywany jest w pliku .agent_baseline.json w katalogu repo i obejmuje zawartości plików nie większych niż maxReadBytes (domyślnie 400 kB). Dla większych plików porównanie odbywa się po rozmiarze.\\n\\n## Sandbox i bezpieczeństwo\\nKonfiguracja sandboxa znajduje się w src/agent/security.ts i jest stosowana m.in. przez RepoTools:\\n- Blokada path traversal: operacje są ograniczone do katalogu repo.\\n- Denylista katalogów: .git, node_modules, dist.\\n- Denylista plików: .env.\\n- Denylista rozszerzeń: .pem, .key.\\n- Limity rozmiaru: odczyt do 400 000 bajtów, zapis do 800 000 bajtów.\\n\\nDodatkowo, po zakończeniu pętli agent próbuje wykonać git diff (jedyna komenda systemowa używana lokalnie) wyłącznie do wygenerowania agent.diff.txt.\\n\\n## Struktura projektu\\n- src/cli.ts – wejściowy CLI, parsowanie argumentów, uruchomienie agenta.\\n- src/openai.ts – inicjalizacja minimalnego klienta OpenAI (wymaga OPENAI_API_KEY).\\n- src/agent/run.ts – pętla agenta, integracja z OpenAI Responses API, logowanie, generowanie diffu.\\n- src/agent/tools.ts – implementacja narzędzi (listowanie/odczyt/zapis/usuwanie/wyszukiwanie plików i narzędzia do review).\\n- src/agent/security.ts – izolacja repo, denylista ścieżek, limity, bezpieczne rozwiązywanie ścieżek.\\n- src/agent/log.ts – prosty logger (agent.raw.txt, agent.diff.txt).\\n- resources/prompts/codeAgentPromt.txt – prompt systemowy używany w roli system przy pierwszym wywołaniu modelu.\\n- .env.example – przykład konfiguracji środowiska (ustaw OPENAI_API_KEY przed użyciem).\\n- package.json – skrypty npm i zależności.\\n- tsconfig.json – konfiguracja TypeScript.\\n\\n## Skrypty\\nZdefiniowane w package.json:\\n- dev: uruchamia CLI w trybie developerskim (tsx src/cli.ts),\\n- test: uruchamia testy (node --import tsx --test).\\n\\n## Uruchamianie testów\\n```\\nnpm test\\n```\\n\\n## Jak robić review zmian (code review z użyciem narzędzi)\\nAgent automatycznie tworzy snapshot bazowy repozytorium na starcie (plik .agent_baseline.json). Na jego podstawie dostępne są narzędzia do przeglądu zmian:\\n- get_baseline_info – sprawdzenie informacji o snapshotcie,\\n- list_changed_files – lista plików added/modified/deleted względem snapshotu,\\n- diff_file_against_original – unified diff oraz podsumowanie (ile linii dodano/usunięto),\\n- read_file_original – odczyt oryginalnej wersji pliku ze snapshotu (dla porównań punktowych).\\n\\nPrzykładowa procedura przeglądu przez agenta:\\n1) Uruchom agenta poleceniem \\\"edit\\\" i poproś o przygotowanie raportu z review. Np.:\\n\\n```\\nnpm run dev -- edit \\\"Zrób code review zmian w repo. Użyj list_changed_files i diff_file_against_original do wygenerowania przeglądu; zapisz czytelne podsumowanie z rekomendacjami do pliku REVIEW.md.\\\" --repo .\\n```\\n\\n2) Agent wykorzysta narzędzia review i zapisze raport (np. REVIEW.md). Dodatkowo w pliku agent.diff.txt znajdziesz wynik git diff względem HEAD.\\n\\nWskazówki do promptu (opcjonalnie):\\n- Ogranicz zakres, np. do ścieżki: „Przejrzyj tylko src/” – agent może użyć list_changed_files z prefix: \\\"src/\\\".\\n- Wymuś czytelny format raportu (sekcje: lista zmian, komentarze, ryzyka, rekomendacje).\\n- Poproś o propozycje konkretnych poprawek wraz ze wskazaniem plików/fragmentów.\\n- Ustal limity, np. maks. 1000 linii diffu na plik (parametr max_lines w diff_file_against_original).\\n\\nOgraniczenia i uwagi dla review:\\n- Pliki większe niż maxReadBytes (domyślnie 400 kB) w snapshotcie nie mają zapisanej treści – porównanie odbywa się po rozmiarze, a diff treści nie będzie dostępny.\\n- Denylista ścieżek (np. .git/, node_modules/, dist/, .env) jest zawsze respektowana – te zasoby nie są analizowane.\\n- Jeśli repozytorium nie jest repozytorium git lub git diff zwróci błąd, agent.diff.txt nie zostanie wygenerowany.\\n\\n## Uwagi\\n- Domyślny model to wartość z OPENAI_MODEL lub \\\"gpt-5\\\". Upewnij się, że wskazany model wspiera tool-calling i Responses API.\\n- Agent minimalizuje zakres zmian i wymaga wywołania read_file przed modyfikacją jakiegokolwiek pliku.\\n- Limit wywołań narzędzi w jednej sesji: domyślnie 50 (możesz zmienić w kodzie wywołania runAgent).\\n\"\n    },\n    \"agent.diff.txt\": {\n      \"bytes\": 4316,\n      \"content\": \"diff --git a/src/agent/security.ts b/src/agent/security.ts\\nindex e8046ff..bb6bd0d 100644\\n--- a/src/agent/security.ts\\n+++ b/src/agent/security.ts\\n@@ -19,20 +19,25 @@ export type SafePathResult = {\\n  * Sprawdza denylistę na ścieżce relatywnej (POSIX).\\n  */\\n export function isDeniedPath(opts: SandboxOptions, relPosixPath: string): boolean {\\n-  const p = relPosixPath.replace(/^\\\\/+/, \\\"\\\"); // bez wiodących /\\n+  const pRaw = relPosixPath.replace(/^\\\\/+/, \\\"\\\"); // bez wiodących /\\n+  const p = pRaw.toLowerCase();\\n+\\n+  const denyFiles = opts.denyFilesExact.map((s) => s.toLowerCase());\\n+  const denyExts = opts.denyExtensions.map((s) => s.toLowerCase());\\n+  const denyDirs = opts.denyDirs.map((s) => s.toLowerCase());\\n \\n   // zablokuj pliki dokładne\\n   const base = path.posix.basename(p);\\n-  if (opts.denyFilesExact.includes(base)) return true;\\n+  if (denyFiles.includes(base)) return true;\\n \\n   // zablokuj rozszerzenia\\n-  const ext = path.posix.extname(base).toLowerCase();\\n-  if (ext && opts.denyExtensions.map((e) => e.toLowerCase()).includes(ext)) return true;\\n+  const ext = path.posix.extname(base);\\n+  if (ext && denyExts.includes(ext)) return true;\\n \\n   // zablokuj katalogi na dowolnym poziomie\\n   const segments = p.split(\\\"/\\\");\\n   for (const seg of segments) {\\n-    if (opts.denyDirs.includes(seg)) return true;\\n+    if (denyDirs.includes(seg)) return true;\\n   }\\n \\n   return false;\\n@@ -43,25 +48,60 @@ export function isDeniedPath(opts: SandboxOptions, relPosixPath: string): boolea\\n  * Zwraca relPath (POSIX) i absPath.\\n  */\\n export function resolveInRepo(opts: SandboxOptions, userPath: string): SafePathResult {\\n-  const repoAbs = path.resolve(opts.repoRoot);\\n-  const candidateAbs = path.resolve(repoAbs, userPath);\\n-\\n-  const relFromRepo = path.relative(repoAbs, candidateAbs);\\n+  if (typeof userPath !== \\\"string\\\") {\\n+    throw new Error(\\\"Invalid path: expected string\\\");\\n+  }\\n+  if (userPath.includes(\\\"\\\\u0000\\\")) {\\n+    throw new Error(\\\"Invalid path: null byte\\\");\\n+  }\\n+  const userPathTrimmed = userPath.trim();\\n+  if (!userPathTrimmed) {\\n+    throw new Error(`Invalid path: \\\"${userPath}\\\"`);\\n+  }\\n \\n-  // Blokada wyjścia poza repo\\n-  const traversal =\\n-    relFromRepo === \\\"\\\" ||\\n-    relFromRepo === \\\".\\\" ||\\n-    relFromRepo === \\\"..\\\" ||\\n-    relFromRepo.startsWith(\\\"..\\\" + path.sep) ||\\n-    relFromRepo.includes(path.sep + \\\"..\\\" + path.sep);\\n+  const realRepoAbs = fs.realpathSync(path.resolve(opts.repoRoot));\\n+  const candidateAbs = path.resolve(realRepoAbs, userPathTrimmed);\\n+\\n+  // Ustal realną ścieżkę kandydata z obsługą nieistniejącego pliku\\n+  let realCandidateAbs: string;\\n+  try {\\n+    realCandidateAbs = fs.realpathSync(candidateAbs);\\n+  } catch {\\n+    const parent = path.dirname(candidateAbs);\\n+    const base = path.basename(candidateAbs);\\n+    let realParent: string;\\n+    try {\\n+      realParent = fs.realpathSync(parent);\\n+    } catch {\\n+      throw new Error(`Invalid path: \\\"${userPath}\\\"`);\\n+    }\\n+    realCandidateAbs = path.join(realParent, base);\\n+  }\\n \\n-  if (traversal) {\\n+  // Warunek bezpieczeństwa: musi zaczynać się od realRepoAbs + path.sep\\n+  const mustStart = realRepoAbs + path.sep;\\n+  if (!realCandidateAbs.startsWith(mustStart)) {\\n     throw new Error(`Path traversal blocked: \\\"${userPath}\\\"`);\\n   }\\n \\n+  // Oblicz relatywną ścieżkę na podstawie realnych ścieżek\\n+  const relFromRepo = path.relative(realRepoAbs, realCandidateAbs);\\n   const relPosix = relFromRepo.replaceAll(path.sep, \\\"/\\\");\\n+\\n   if (!relPosix || relPosix.trim() === \\\"\\\") {\\n+    // root repo lub pusta ścieżka\\n+    throw new Error(`Invalid path: \\\"${userPath}\\\"`);\\n+  }\\n+\\n+  // Zablokuj katalogi – ta funkcja zwraca ścieżki tylko do plików\\n+  try {\\n+    if (fs.existsSync(realCandidateAbs)) {\\n+      const st = fs.lstatSync(realCandidateAbs);\\n+      if (st.isDirectory()) {\\n+        throw new Error(`Invalid path: \\\"${userPath}\\\"`);\\n+      }\\n+    }\\n+  } catch {\\n     throw new Error(`Invalid path: \\\"${userPath}\\\"`);\\n   }\\n \\n@@ -69,7 +109,7 @@ export function resolveInRepo(opts: SandboxOptions, userPath: string): SafePathR\\n     throw new Error(`Access denied by policy: \\\"${relPosix}\\\"`);\\n   }\\n \\n-  return { absPath: candidateAbs, relPath: relPosix };\\n+  return { absPath: realCandidateAbs, relPath: relPosix };\\n }\\n \\n export function ensureParentDirExists(fileAbsPath: string): void {\\n\"\n    },\n    \"agent.raw.txt\": {\n      \"bytes\": 430239,\n      \"content\": null\n    },\n    \"package-lock.json\": {\n      \"bytes\": 34254,\n      \"content\": \"{\\r\\n  \\\"name\\\": \\\"coding-agent\\\",\\r\\n  \\\"version\\\": \\\"1.0.0\\\",\\r\\n  \\\"lockfileVersion\\\": 3,\\r\\n  \\\"requires\\\": true,\\r\\n  \\\"packages\\\": {\\r\\n    \\\"\\\": {\\r\\n      \\\"name\\\": \\\"coding-agent\\\",\\r\\n      \\\"dependencies\\\": {\\r\\n        \\\"dotenv\\\": \\\"^16.4.5\\\",\\r\\n        \\\"openai\\\": \\\"^4.0.0\\\"\\r\\n      },\\r\\n      \\\"devDependencies\\\": {\\r\\n        \\\"tsx\\\": \\\"^4.19.2\\\",\\r\\n        \\\"typescript\\\": \\\"^5.5.4\\\"\\r\\n      },\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/aix-ppc64\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/aix-ppc64/-/aix-ppc64-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-GZMB+a0mOMZs4MpDbj8RJp4cw+w1WV5NYD6xzgvzUJ5Ek2jerwfO2eADyI6ExDSUED+1X8aMbegahsJi+8mgpw==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"ppc64\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"aix\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/android-arm\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/android-arm/-/android-arm-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-DVNI8jlPa7Ujbr1yjU2PfUSRtAUZPG9I1RwW4F4xFB1Imiu2on0ADiI/c3td+KmDtVKNbi+nffGDQMfcIMkwIA==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"arm\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"android\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/android-arm64\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/android-arm64/-/android-arm64-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-pvz8ZZ7ot/RBphf8fv60ljmaoydPU12VuXHImtAs0XhLLw+EXBi2BLe3OYSBslR4rryHvweW5gmkKFwTiFy6KA==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"arm64\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"android\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/android-x64\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/android-x64/-/android-x64-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-z8Ank4Byh4TJJOh4wpz8g2vDy75zFL0TlZlkUkEwYXuPSgX8yzep596n6mT7905kA9uHZsf/o2OJZubl2l3M7A==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"x64\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"android\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/darwin-arm64\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/darwin-arm64/-/darwin-arm64-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-davCD2Zc80nzDVRwXTcQP/28fiJbcOwvdolL0sOiOsbwBa72kegmVU0Wrh1MYrbuCL98Omp5dVhQFWRKR2ZAlg==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"arm64\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"darwin\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/darwin-x64\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/darwin-x64/-/darwin-x64-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-ZxtijOmlQCBWGwbVmwOF/UCzuGIbUkqB1faQRf5akQmxRJ1ujusWsb3CVfk/9iZKr2L5SMU5wPBi1UWbvL+VQA==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"x64\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"darwin\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/freebsd-arm64\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/freebsd-arm64/-/freebsd-arm64-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-lS/9CN+rgqQ9czogxlMcBMGd+l8Q3Nj1MFQwBZJyoEKI50XGxwuzznYdwcav6lpOGv5BqaZXqvBSiB/kJ5op+g==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"arm64\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"freebsd\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/freebsd-x64\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/freebsd-x64/-/freebsd-x64-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-tAfqtNYb4YgPnJlEFu4c212HYjQWSO/w/h/lQaBK7RbwGIkBOuNKQI9tqWzx7Wtp7bTPaGC6MJvWI608P3wXYA==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"x64\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"freebsd\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/linux-arm\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/linux-arm/-/linux-arm-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-vWfq4GaIMP9AIe4yj1ZUW18RDhx6EPQKjwe7n8BbIecFtCQG4CfHGaHuh7fdfq+y3LIA2vGS/o9ZBGVxIDi9hw==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"arm\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"linux\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/linux-arm64\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/linux-arm64/-/linux-arm64-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-hYxN8pr66NsCCiRFkHUAsxylNOcAQaxSSkHMMjcpx0si13t1LHFphxJZUiGwojB1a/Hd5OiPIqDdXONia6bhTw==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"arm64\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"linux\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/linux-ia32\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/linux-ia32/-/linux-ia32-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-MJt5BRRSScPDwG2hLelYhAAKh9imjHK5+NE/tvnRLbIqUWa+0E9N4WNMjmp/kXXPHZGqPLxggwVhz7QP8CTR8w==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"ia32\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"linux\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/linux-loong64\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/linux-loong64/-/linux-loong64-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-lugyF1atnAT463aO6KPshVCJK5NgRnU4yb3FUumyVz+cGvZbontBgzeGFO1nF+dPueHD367a2ZXe1NtUkAjOtg==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"loong64\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"linux\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/linux-mips64el\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/linux-mips64el/-/linux-mips64el-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-nlP2I6ArEBewvJ2gjrrkESEZkB5mIoaTswuqNFRv/WYd+ATtUpe9Y09RnJvgvdag7he0OWgEZWhviS1OTOKixw==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"mips64el\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"linux\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/linux-ppc64\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/linux-ppc64/-/linux-ppc64-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-C92gnpey7tUQONqg1n6dKVbx3vphKtTHJaNG2Ok9lGwbZil6DrfyecMsp9CrmXGQJmZ7iiVXvvZH6Ml5hL6XdQ==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"ppc64\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"linux\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/linux-riscv64\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/linux-riscv64/-/linux-riscv64-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-B5BOmojNtUyN8AXlK0QJyvjEZkWwy/FKvakkTDCziX95AowLZKR6aCDhG7LeF7uMCXEJqwa8Bejz5LTPYm8AvA==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"riscv64\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"linux\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/linux-s390x\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/linux-s390x/-/linux-s390x-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-p4bm9+wsPwup5Z8f4EpfN63qNagQ47Ua2znaqGH6bqLlmJ4bx97Y9JdqxgGZ6Y8xVTixUnEkoKSHcpRlDnNr5w==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"s390x\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"linux\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/linux-x64\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/linux-x64/-/linux-x64-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-uwp2Tip5aPmH+NRUwTcfLb+W32WXjpFejTIOWZFw/v7/KnpCDKG66u4DLcurQpiYTiYwQ9B7KOeMJvLCu/OvbA==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"x64\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"linux\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/netbsd-arm64\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/netbsd-arm64/-/netbsd-arm64-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-Kj6DiBlwXrPsCRDeRvGAUb/LNrBASrfqAIok+xB0LxK8CHqxZ037viF13ugfsIpePH93mX7xfJp97cyDuTZ3cw==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"arm64\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"netbsd\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/netbsd-x64\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/netbsd-x64/-/netbsd-x64-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-HwGDZ0VLVBY3Y+Nw0JexZy9o/nUAWq9MlV7cahpaXKW6TOzfVno3y3/M8Ga8u8Yr7GldLOov27xiCnqRZf0tCA==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"x64\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"netbsd\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/openbsd-arm64\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/openbsd-arm64/-/openbsd-arm64-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-DNIHH2BPQ5551A7oSHD0CKbwIA/Ox7+78/AWkbS5QoRzaqlev2uFayfSxq68EkonB+IKjiuxBFoV8ESJy8bOHA==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"arm64\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"openbsd\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/openbsd-x64\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/openbsd-x64/-/openbsd-x64-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-/it7w9Nb7+0KFIzjalNJVR5bOzA9Vay+yIPLVHfIQYG/j+j9VTH84aNB8ExGKPU4AzfaEvN9/V4HV+F+vo8OEg==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"x64\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"openbsd\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/openharmony-arm64\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/openharmony-arm64/-/openharmony-arm64-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-LRBbCmiU51IXfeXk59csuX/aSaToeG7w48nMwA6049Y4J4+VbWALAuXcs+qcD04rHDuSCSRKdmY63sruDS5qag==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"arm64\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"openharmony\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/sunos-x64\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/sunos-x64/-/sunos-x64-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-kMtx1yqJHTmqaqHPAzKCAkDaKsffmXkPHThSfRwZGyuqyIeBvf08KSsYXl+abf5HDAPMJIPnbBfXvP2ZC2TfHg==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"x64\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"sunos\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/win32-arm64\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/win32-arm64/-/win32-arm64-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-Yaf78O/B3Kkh+nKABUF++bvJv5Ijoy9AN1ww904rOXZFLWVc5OLOfL56W+C8F9xn5JQZa3UX6m+IktJnIb1Jjg==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"arm64\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"win32\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/win32-ia32\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/win32-ia32/-/win32-ia32-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-Iuws0kxo4yusk7sw70Xa2E2imZU5HoixzxfGCdxwBdhiDgt9vX9VUCBhqcwY7/uh//78A1hMkkROMJq9l27oLQ==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"ia32\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"win32\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@esbuild/win32-x64\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@esbuild/win32-x64/-/win32-x64-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-sRdU18mcKf7F+YgheI/zGf5alZatMUTKj/jNS6l744f9u3WFu4v7twcUI9vu4mknF4Y9aDlblIie0IM+5xxaqQ==\\\",\\r\\n      \\\"cpu\\\": [\\r\\n        \\\"x64\\\"\\r\\n      ],\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"win32\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@types/node\\\": {\\r\\n      \\\"version\\\": \\\"18.19.130\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@types/node/-/node-18.19.130.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-GRaXQx6jGfL8sKfaIDD6OupbIHBr9jv7Jnaml9tB7l4v068PAOXqfcujMMo5PhbIs6ggR1XODELqahT2R8v0fg==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"dependencies\\\": {\\r\\n        \\\"undici-types\\\": \\\"~5.26.4\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/@types/node-fetch\\\": {\\r\\n      \\\"version\\\": \\\"2.6.13\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/@types/node-fetch/-/node-fetch-2.6.13.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-QGpRVpzSaUs30JBSGPjOg4Uveu384erbHBoT1zeONvyCfwQxIkUshLAOqN/k9EjGviPRmWTTe6aH2qySWKTVSw==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"dependencies\\\": {\\r\\n        \\\"@types/node\\\": \\\"*\\\",\\r\\n        \\\"form-data\\\": \\\"^4.0.4\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/abort-controller\\\": {\\r\\n      \\\"version\\\": \\\"3.0.0\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/abort-controller/-/abort-controller-3.0.0.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-h8lQ8tacZYnR3vNQTgibj+tODHI5/+l06Au2Pcriv/Gmet0eaj4TwWH41sO9wnHDiQsEj19q0drzdWdeAHtweg==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"dependencies\\\": {\\r\\n        \\\"event-target-shim\\\": \\\"^5.0.0\\\"\\r\\n      },\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=6.5\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/agentkeepalive\\\": {\\r\\n      \\\"version\\\": \\\"4.6.0\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/agentkeepalive/-/agentkeepalive-4.6.0.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-kja8j7PjmncONqaTsB8fQ+wE2mSU2DJ9D4XKoJ5PFWIdRMa6SLSN1ff4mOr4jCbfRSsxR4keIiySJU0N9T5hIQ==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"dependencies\\\": {\\r\\n        \\\"humanize-ms\\\": \\\"^1.2.1\\\"\\r\\n      },\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">= 8.0.0\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/asynckit\\\": {\\r\\n      \\\"version\\\": \\\"0.4.0\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/asynckit/-/asynckit-0.4.0.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-Oei9OH4tRh0YqU3GxhX79dM/mwVgvbZJaSNaRk+bshkj0S5cfHcgYakreBjrHwatXKbz+IoIdYLxrKim2MjW0Q==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\"\\r\\n    },\\r\\n    \\\"node_modules/call-bind-apply-helpers\\\": {\\r\\n      \\\"version\\\": \\\"1.0.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/call-bind-apply-helpers/-/call-bind-apply-helpers-1.0.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-Sp1ablJ0ivDkSzjcaJdxEunN5/XvksFJ2sMBFfq6x0ryhQV/2b/KwFe21cMpmHtPOSij8K99/wSfoEuTObmuMQ==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"dependencies\\\": {\\r\\n        \\\"es-errors\\\": \\\"^1.3.0\\\",\\r\\n        \\\"function-bind\\\": \\\"^1.1.2\\\"\\r\\n      },\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">= 0.4\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/combined-stream\\\": {\\r\\n      \\\"version\\\": \\\"1.0.8\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/combined-stream/-/combined-stream-1.0.8.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-FQN4MRfuJeHf7cBbBMJFXhKSDq+2kAArBlmRBvcvFE5BB1HZKXtSFASDhdlz9zOYwxh8lDdnvmMOe/+5cdoEdg==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"dependencies\\\": {\\r\\n        \\\"delayed-stream\\\": \\\"~1.0.0\\\"\\r\\n      },\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">= 0.8\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/delayed-stream\\\": {\\r\\n      \\\"version\\\": \\\"1.0.0\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/delayed-stream/-/delayed-stream-1.0.0.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-ZySD7Nf91aLB0RxL4KGrKHBXl7Eds1DAmEdcoVawXnLD7SDhpNgtuII2aAkg7a7QS41jxPSZ17p4VdGnMHk3MQ==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=0.4.0\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/dotenv\\\": {\\r\\n      \\\"version\\\": \\\"16.6.1\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/dotenv/-/dotenv-16.6.1.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-uBq4egWHTcTt33a72vpSG0z3HnPuIl6NqYcTrKEg2azoEyl2hpW0zqlxysq2pK9HlDIHyHyakeYaYnSAwd8bow==\\\",\\r\\n      \\\"license\\\": \\\"BSD-2-Clause\\\",\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=12\\\"\\r\\n      },\\r\\n      \\\"funding\\\": {\\r\\n        \\\"url\\\": \\\"https://dotenvx.com\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/dunder-proto\\\": {\\r\\n      \\\"version\\\": \\\"1.0.1\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/dunder-proto/-/dunder-proto-1.0.1.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-KIN/nDJBQRcXw0MLVhZE9iQHmG68qAVIBg9CqmUYjmQIhgij9U5MFvrqkUL5FbtyyzZuOeOt0zdeRe4UY7ct+A==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"dependencies\\\": {\\r\\n        \\\"call-bind-apply-helpers\\\": \\\"^1.0.1\\\",\\r\\n        \\\"es-errors\\\": \\\"^1.3.0\\\",\\r\\n        \\\"gopd\\\": \\\"^1.2.0\\\"\\r\\n      },\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">= 0.4\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/es-define-property\\\": {\\r\\n      \\\"version\\\": \\\"1.0.1\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/es-define-property/-/es-define-property-1.0.1.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-e3nRfgfUZ4rNGL232gUgX06QNyyez04KdjFrF+LTRoOXmrOgFKDg4BCdsjW8EnT69eqdYGmRpJwiPVYNrCaW3g==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">= 0.4\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/es-errors\\\": {\\r\\n      \\\"version\\\": \\\"1.3.0\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/es-errors/-/es-errors-1.3.0.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-Zf5H2Kxt2xjTvbJvP2ZWLEICxA6j+hAmMzIlypy4xcBg1vKVnx89Wy0GbS+kf5cwCVFFzdCFh2XSCFNULS6csw==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">= 0.4\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/es-object-atoms\\\": {\\r\\n      \\\"version\\\": \\\"1.1.1\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/es-object-atoms/-/es-object-atoms-1.1.1.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-FGgH2h8zKNim9ljj7dankFPcICIK9Cp5bm+c2gQSYePhpaG5+esrLODihIorn+Pe6FGJzWhXQotPv73jTaldXA==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"dependencies\\\": {\\r\\n        \\\"es-errors\\\": \\\"^1.3.0\\\"\\r\\n      },\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">= 0.4\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/es-set-tostringtag\\\": {\\r\\n      \\\"version\\\": \\\"2.1.0\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/es-set-tostringtag/-/es-set-tostringtag-2.1.0.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-j6vWzfrGVfyXxge+O0x5sh6cvxAog0a/4Rdd2K36zCMV5eJ+/+tOAngRO8cODMNWbVRdVlmGZQL2YS3yR8bIUA==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"dependencies\\\": {\\r\\n        \\\"es-errors\\\": \\\"^1.3.0\\\",\\r\\n        \\\"get-intrinsic\\\": \\\"^1.2.6\\\",\\r\\n        \\\"has-tostringtag\\\": \\\"^1.0.2\\\",\\r\\n        \\\"hasown\\\": \\\"^2.0.2\\\"\\r\\n      },\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">= 0.4\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/esbuild\\\": {\\r\\n      \\\"version\\\": \\\"0.27.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/esbuild/-/esbuild-0.27.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-HyNQImnsOC7X9PMNaCIeAm4ISCQXs5a5YasTXVliKv4uuBo1dKrG0A+uQS8M5eXjVMnLg3WgXaKvprHlFJQffw==\\\",\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"hasInstallScript\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"bin\\\": {\\r\\n        \\\"esbuild\\\": \\\"bin/esbuild\\\"\\r\\n      },\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18\\\"\\r\\n      },\\r\\n      \\\"optionalDependencies\\\": {\\r\\n        \\\"@esbuild/aix-ppc64\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/android-arm\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/android-arm64\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/android-x64\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/darwin-arm64\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/darwin-x64\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/freebsd-arm64\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/freebsd-x64\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/linux-arm\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/linux-arm64\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/linux-ia32\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/linux-loong64\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/linux-mips64el\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/linux-ppc64\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/linux-riscv64\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/linux-s390x\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/linux-x64\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/netbsd-arm64\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/netbsd-x64\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/openbsd-arm64\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/openbsd-x64\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/openharmony-arm64\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/sunos-x64\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/win32-arm64\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/win32-ia32\\\": \\\"0.27.2\\\",\\r\\n        \\\"@esbuild/win32-x64\\\": \\\"0.27.2\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/event-target-shim\\\": {\\r\\n      \\\"version\\\": \\\"5.0.1\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/event-target-shim/-/event-target-shim-5.0.1.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-i/2XbnSz/uxRCU6+NdVJgKWDTM427+MqYbkQzD321DuCQJUqOuJKIA0IM2+W2xtYHdKOmZ4dR6fExsd4SXL+WQ==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=6\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/form-data\\\": {\\r\\n      \\\"version\\\": \\\"4.0.5\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/form-data/-/form-data-4.0.5.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-8RipRLol37bNs2bhoV67fiTEvdTrbMUYcFTiy3+wuuOnUog2QBHCZWXDRijWQfAkhBj2Uf5UnVaiWwA5vdd82w==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"dependencies\\\": {\\r\\n        \\\"asynckit\\\": \\\"^0.4.0\\\",\\r\\n        \\\"combined-stream\\\": \\\"^1.0.8\\\",\\r\\n        \\\"es-set-tostringtag\\\": \\\"^2.1.0\\\",\\r\\n        \\\"hasown\\\": \\\"^2.0.2\\\",\\r\\n        \\\"mime-types\\\": \\\"^2.1.12\\\"\\r\\n      },\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">= 6\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/form-data-encoder\\\": {\\r\\n      \\\"version\\\": \\\"1.7.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/form-data-encoder/-/form-data-encoder-1.7.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-qfqtYan3rxrnCk1VYaA4H+Ms9xdpPqvLZa6xmMgFvhO32x7/3J/ExcTd6qpxM0vH2GdMI+poehyBZvqfMTto8A==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\"\\r\\n    },\\r\\n    \\\"node_modules/formdata-node\\\": {\\r\\n      \\\"version\\\": \\\"4.4.1\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/formdata-node/-/formdata-node-4.4.1.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-0iirZp3uVDjVGt9p49aTaqjk84TrglENEDuqfdlZQ1roC9CWlPk6Avf8EEnZNcAqPonwkG35x4n3ww/1THYAeQ==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"dependencies\\\": {\\r\\n        \\\"node-domexception\\\": \\\"1.0.0\\\",\\r\\n        \\\"web-streams-polyfill\\\": \\\"4.0.0-beta.3\\\"\\r\\n      },\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">= 12.20\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/fsevents\\\": {\\r\\n      \\\"version\\\": \\\"2.3.3\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/fsevents/-/fsevents-2.3.3.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-5xoDfX+fL7faATnagmWPpbFtwh/R77WmMMqqHGS65C3vvB0YHrgF+B1YmZ3441tMj5n63k0212XNoJwzlhffQw==\\\",\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"hasInstallScript\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"optional\\\": true,\\r\\n      \\\"os\\\": [\\r\\n        \\\"darwin\\\"\\r\\n      ],\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\"^8.16.0 || ^10.6.0 || >=11.0.0\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/function-bind\\\": {\\r\\n      \\\"version\\\": \\\"1.1.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/function-bind/-/function-bind-1.1.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-7XHNxH7qX9xG5mIwxkhumTox/MIRNcOgDrxWsMt2pAr23WHp6MrRlN7FBSFpCpr+oVO0F744iUgR82nJMfG2SA==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"funding\\\": {\\r\\n        \\\"url\\\": \\\"https://github.com/sponsors/ljharb\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/get-intrinsic\\\": {\\r\\n      \\\"version\\\": \\\"1.3.0\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/get-intrinsic/-/get-intrinsic-1.3.0.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-9fSjSaos/fRIVIp+xSJlE6lfwhES7LNtKaCBIamHsjr2na1BiABJPo0mOjjz8GJDURarmCPGqaiVg5mfjb98CQ==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"dependencies\\\": {\\r\\n        \\\"call-bind-apply-helpers\\\": \\\"^1.0.2\\\",\\r\\n        \\\"es-define-property\\\": \\\"^1.0.1\\\",\\r\\n        \\\"es-errors\\\": \\\"^1.3.0\\\",\\r\\n        \\\"es-object-atoms\\\": \\\"^1.1.1\\\",\\r\\n        \\\"function-bind\\\": \\\"^1.1.2\\\",\\r\\n        \\\"get-proto\\\": \\\"^1.0.1\\\",\\r\\n        \\\"gopd\\\": \\\"^1.2.0\\\",\\r\\n        \\\"has-symbols\\\": \\\"^1.1.0\\\",\\r\\n        \\\"hasown\\\": \\\"^2.0.2\\\",\\r\\n        \\\"math-intrinsics\\\": \\\"^1.1.0\\\"\\r\\n      },\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">= 0.4\\\"\\r\\n      },\\r\\n      \\\"funding\\\": {\\r\\n        \\\"url\\\": \\\"https://github.com/sponsors/ljharb\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/get-proto\\\": {\\r\\n      \\\"version\\\": \\\"1.0.1\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/get-proto/-/get-proto-1.0.1.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-sTSfBjoXBp89JvIKIefqw7U2CCebsc74kiY6awiGogKtoSGbgjYE/G/+l9sF3MWFPNc9IcoOC4ODfKHfxFmp0g==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"dependencies\\\": {\\r\\n        \\\"dunder-proto\\\": \\\"^1.0.1\\\",\\r\\n        \\\"es-object-atoms\\\": \\\"^1.0.0\\\"\\r\\n      },\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">= 0.4\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/get-tsconfig\\\": {\\r\\n      \\\"version\\\": \\\"4.13.0\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/get-tsconfig/-/get-tsconfig-4.13.0.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-1VKTZJCwBrvbd+Wn3AOgQP/2Av+TfTCOlE4AcRJE72W1ksZXbAx8PPBR9RzgTeSPzlPMHrbANMH3LbltH73wxQ==\\\",\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"dependencies\\\": {\\r\\n        \\\"resolve-pkg-maps\\\": \\\"^1.0.0\\\"\\r\\n      },\\r\\n      \\\"funding\\\": {\\r\\n        \\\"url\\\": \\\"https://github.com/privatenumber/get-tsconfig?sponsor=1\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/gopd\\\": {\\r\\n      \\\"version\\\": \\\"1.2.0\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/gopd/-/gopd-1.2.0.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-ZUKRh6/kUFoAiTAtTYPZJ3hw9wNxx+BIBOijnlG9PnrJsCcSjs1wyyD6vJpaYtgnzDrKYRSqf3OO6Rfa93xsRg==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">= 0.4\\\"\\r\\n      },\\r\\n      \\\"funding\\\": {\\r\\n        \\\"url\\\": \\\"https://github.com/sponsors/ljharb\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/has-symbols\\\": {\\r\\n      \\\"version\\\": \\\"1.1.0\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/has-symbols/-/has-symbols-1.1.0.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-1cDNdwJ2Jaohmb3sg4OmKaMBwuC48sYni5HUw2DvsC8LjGTLK9h+eb1X6RyuOHe4hT0ULCW68iomhjUoKUqlPQ==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">= 0.4\\\"\\r\\n      },\\r\\n      \\\"funding\\\": {\\r\\n        \\\"url\\\": \\\"https://github.com/sponsors/ljharb\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/has-tostringtag\\\": {\\r\\n      \\\"version\\\": \\\"1.0.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/has-tostringtag/-/has-tostringtag-1.0.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-NqADB8VjPFLM2V0VvHUewwwsw0ZWBaIdgo+ieHtK3hasLz4qeCRjYcqfB6AQrBggRKppKF8L52/VqdVsO47Dlw==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"dependencies\\\": {\\r\\n        \\\"has-symbols\\\": \\\"^1.0.3\\\"\\r\\n      },\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">= 0.4\\\"\\r\\n      },\\r\\n      \\\"funding\\\": {\\r\\n        \\\"url\\\": \\\"https://github.com/sponsors/ljharb\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/hasown\\\": {\\r\\n      \\\"version\\\": \\\"2.0.2\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/hasown/-/hasown-2.0.2.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-0hJU9SCPvmMzIBdZFqNPXWa6dqh7WdH0cII9y+CyS8rG3nL48Bclra9HmKhVVUHyPWNH5Y7xDwAB7bfgSjkUMQ==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"dependencies\\\": {\\r\\n        \\\"function-bind\\\": \\\"^1.1.2\\\"\\r\\n      },\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">= 0.4\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/humanize-ms\\\": {\\r\\n      \\\"version\\\": \\\"1.2.1\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/humanize-ms/-/humanize-ms-1.2.1.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-Fl70vYtsAFb/C06PTS9dZBo7ihau+Tu/DNCk/OyHhea07S+aeMWpFFkUaXRa8fI+ScZbEI8dfSxwY7gxZ9SAVQ==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"dependencies\\\": {\\r\\n        \\\"ms\\\": \\\"^2.0.0\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/math-intrinsics\\\": {\\r\\n      \\\"version\\\": \\\"1.1.0\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/math-intrinsics/-/math-intrinsics-1.1.0.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-/IXtbwEk5HTPyEwyKX6hGkYXxM9nbj64B+ilVJnC/R6B0pH5G4V3b0pVbL7DBj4tkhBAppbQUlf6F6Xl9LHu1g==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">= 0.4\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/mime-db\\\": {\\r\\n      \\\"version\\\": \\\"1.52.0\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/mime-db/-/mime-db-1.52.0.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-sPU4uV7dYlvtWJxwwxHD0PuihVNiE7TyAbQ5SWxDCB9mUYvOgroQOwYQQOKPJ8CIbE+1ETVlOoK1UC2nU3gYvg==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">= 0.6\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/mime-types\\\": {\\r\\n      \\\"version\\\": \\\"2.1.35\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/mime-types/-/mime-types-2.1.35.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-ZDY+bPm5zTTF+YpCrAU9nK0UgICYPT0QtT1NZWFv4s++TNkcgVaT0g6+4R2uI4MjQjzysHB1zxuWL50hzaeXiw==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"dependencies\\\": {\\r\\n        \\\"mime-db\\\": \\\"1.52.0\\\"\\r\\n      },\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">= 0.6\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/ms\\\": {\\r\\n      \\\"version\\\": \\\"2.1.3\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/ms/-/ms-2.1.3.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\"\\r\\n    },\\r\\n    \\\"node_modules/node-domexception\\\": {\\r\\n      \\\"version\\\": \\\"1.0.0\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/node-domexception/-/node-domexception-1.0.0.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-/jKZoMpw0F8GRwl4/eLROPA3cfcXtLApP0QzLmUT/HuPCZWyB7IY9ZrMeKw2O/nFIqPQB3PVM9aYm0F312AXDQ==\\\",\\r\\n      \\\"deprecated\\\": \\\"Use your platform's native DOMException instead\\\",\\r\\n      \\\"funding\\\": [\\r\\n        {\\r\\n          \\\"type\\\": \\\"github\\\",\\r\\n          \\\"url\\\": \\\"https://github.com/sponsors/jimmywarting\\\"\\r\\n        },\\r\\n        {\\r\\n          \\\"type\\\": \\\"github\\\",\\r\\n          \\\"url\\\": \\\"https://paypal.me/jimmywarting\\\"\\r\\n        }\\r\\n      ],\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=10.5.0\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/node-fetch\\\": {\\r\\n      \\\"version\\\": \\\"2.7.0\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/node-fetch/-/node-fetch-2.7.0.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-c4FRfUm/dbcWZ7U+1Wq0AwCyFL+3nt2bEw05wfxSz+DWpWsitgmSgYmy2dQdWyKC1694ELPqMs/YzUSNozLt8A==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"dependencies\\\": {\\r\\n        \\\"whatwg-url\\\": \\\"^5.0.0\\\"\\r\\n      },\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\"4.x || >=6.0.0\\\"\\r\\n      },\\r\\n      \\\"peerDependencies\\\": {\\r\\n        \\\"encoding\\\": \\\"^0.1.0\\\"\\r\\n      },\\r\\n      \\\"peerDependenciesMeta\\\": {\\r\\n        \\\"encoding\\\": {\\r\\n          \\\"optional\\\": true\\r\\n        }\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/openai\\\": {\\r\\n      \\\"version\\\": \\\"4.104.0\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/openai/-/openai-4.104.0.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-p99EFNsA/yX6UhVO93f5kJsDRLAg+CTA2RBqdHK4RtK8u5IJw32Hyb2dTGKbnnFmnuoBv5r7Z2CURI9sGZpSuA==\\\",\\r\\n      \\\"license\\\": \\\"Apache-2.0\\\",\\r\\n      \\\"dependencies\\\": {\\r\\n        \\\"@types/node\\\": \\\"^18.11.18\\\",\\r\\n        \\\"@types/node-fetch\\\": \\\"^2.6.4\\\",\\r\\n        \\\"abort-controller\\\": \\\"^3.0.0\\\",\\r\\n        \\\"agentkeepalive\\\": \\\"^4.2.1\\\",\\r\\n        \\\"form-data-encoder\\\": \\\"1.7.2\\\",\\r\\n        \\\"formdata-node\\\": \\\"^4.3.2\\\",\\r\\n        \\\"node-fetch\\\": \\\"^2.6.7\\\"\\r\\n      },\\r\\n      \\\"bin\\\": {\\r\\n        \\\"openai\\\": \\\"bin/cli\\\"\\r\\n      },\\r\\n      \\\"peerDependencies\\\": {\\r\\n        \\\"ws\\\": \\\"^8.18.0\\\",\\r\\n        \\\"zod\\\": \\\"^3.23.8\\\"\\r\\n      },\\r\\n      \\\"peerDependenciesMeta\\\": {\\r\\n        \\\"ws\\\": {\\r\\n          \\\"optional\\\": true\\r\\n        },\\r\\n        \\\"zod\\\": {\\r\\n          \\\"optional\\\": true\\r\\n        }\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/resolve-pkg-maps\\\": {\\r\\n      \\\"version\\\": \\\"1.0.0\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/resolve-pkg-maps/-/resolve-pkg-maps-1.0.0.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-seS2Tj26TBVOC2NIc2rOe2y2ZO7efxITtLZcGSOnHHNOQ7CkiUBfw0Iw2ck6xkIhPwLhKNLS8BO+hEpngQlqzw==\\\",\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"funding\\\": {\\r\\n        \\\"url\\\": \\\"https://github.com/privatenumber/resolve-pkg-maps?sponsor=1\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/tr46\\\": {\\r\\n      \\\"version\\\": \\\"0.0.3\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/tr46/-/tr46-0.0.3.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-N3WMsuqV66lT30CrXNbEjx4GEwlow3v6rr4mCcv6prnfwhS01rkgyFdjPNBYd9br7LpXV1+Emh01fHnq2Gdgrw==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\"\\r\\n    },\\r\\n    \\\"node_modules/tsx\\\": {\\r\\n      \\\"version\\\": \\\"4.21.0\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/tsx/-/tsx-4.21.0.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-5C1sg4USs1lfG0GFb2RLXsdpXqBSEhAaA/0kPL01wxzpMqLILNxIxIOKiILz+cdg/pLnOUxFYOR5yhHU666wbw==\\\",\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"dependencies\\\": {\\r\\n        \\\"esbuild\\\": \\\"~0.27.0\\\",\\r\\n        \\\"get-tsconfig\\\": \\\"^4.7.5\\\"\\r\\n      },\\r\\n      \\\"bin\\\": {\\r\\n        \\\"tsx\\\": \\\"dist/cli.mjs\\\"\\r\\n      },\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=18.0.0\\\"\\r\\n      },\\r\\n      \\\"optionalDependencies\\\": {\\r\\n        \\\"fsevents\\\": \\\"~2.3.3\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/typescript\\\": {\\r\\n      \\\"version\\\": \\\"5.9.3\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/typescript/-/typescript-5.9.3.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-jl1vZzPDinLr9eUt3J/t7V6FgNEw9QjvBPdysz9KfQDD41fQrC2Y4vKQdiaUpFT4bXlb1RHhLpp8wtm6M5TgSw==\\\",\\r\\n      \\\"dev\\\": true,\\r\\n      \\\"license\\\": \\\"Apache-2.0\\\",\\r\\n      \\\"bin\\\": {\\r\\n        \\\"tsc\\\": \\\"bin/tsc\\\",\\r\\n        \\\"tsserver\\\": \\\"bin/tsserver\\\"\\r\\n      },\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">=14.17\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/undici-types\\\": {\\r\\n      \\\"version\\\": \\\"5.26.5\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/undici-types/-/undici-types-5.26.5.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-JlCMO+ehdEIKqlFxk6IfVoAUVmgz7cU7zD/h9XZ0qzeosSHmUJVOzSQvvYSYWXkFXC+IfLKSIffhv0sVZup6pA==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\"\\r\\n    },\\r\\n    \\\"node_modules/web-streams-polyfill\\\": {\\r\\n      \\\"version\\\": \\\"4.0.0-beta.3\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/web-streams-polyfill/-/web-streams-polyfill-4.0.0-beta.3.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-QW95TCTaHmsYfHDybGMwO5IJIM93I/6vTRk+daHTWFPhwh+C8Cg7j7XyKrwrj8Ib6vYXe0ocYNrmzY4xAAN6ug==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"engines\\\": {\\r\\n        \\\"node\\\": \\\">= 14\\\"\\r\\n      }\\r\\n    },\\r\\n    \\\"node_modules/webidl-conversions\\\": {\\r\\n      \\\"version\\\": \\\"3.0.1\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/webidl-conversions/-/webidl-conversions-3.0.1.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-2JAn3z8AR6rjK8Sm8orRC0h/bcl/DqL7tRPdGZ4I1CjdF+EaMLmYxBHyXuKL849eucPFhvBoxMsflfOb8kxaeQ==\\\",\\r\\n      \\\"license\\\": \\\"BSD-2-Clause\\\"\\r\\n    },\\r\\n    \\\"node_modules/whatwg-url\\\": {\\r\\n      \\\"version\\\": \\\"5.0.0\\\",\\r\\n      \\\"resolved\\\": \\\"https://registry.npmjs.org/whatwg-url/-/whatwg-url-5.0.0.tgz\\\",\\r\\n      \\\"integrity\\\": \\\"sha512-saE57nupxk6v3HY35+jzBwYa0rKSy0XR8JSxZPwgLr7ys0IBzhGviA1/TUGJLmSVqs8pb9AnvICXEuOHLprYTw==\\\",\\r\\n      \\\"license\\\": \\\"MIT\\\",\\r\\n      \\\"dependencies\\\": {\\r\\n        \\\"tr46\\\": \\\"~0.0.3\\\",\\r\\n        \\\"webidl-conversions\\\": \\\"^3.0.0\\\"\\r\\n      }\\r\\n    }\\r\\n  }\\r\\n}\\r\\n\"\n    },\n    \"package.json\": {\n      \"bytes\": 365,\n      \"content\": \"{\\r\\n  \\\"name\\\": \\\"coding-agent\\\",\\r\\n  \\\"private\\\": true,\\r\\n  \\\"type\\\": \\\"module\\\",\\r\\n  \\\"scripts\\\": {\\r\\n    \\\"dev\\\": \\\"tsx src/cli.ts\\\",\\r\\n    \\\"test\\\": \\\"node --import tsx --test\\\"\\r\\n  },\\r\\n  \\\"dependencies\\\": {\\r\\n    \\\"dotenv\\\": \\\"^16.4.5\\\",\\r\\n    \\\"openai\\\": \\\"^4.0.0\\\"\\r\\n  },\\r\\n  \\\"devDependencies\\\": {\\r\\n    \\\"tsx\\\": \\\"^4.19.2\\\",\\r\\n    \\\"typescript\\\": \\\"^5.5.4\\\"\\r\\n  },\\r\\n  \\\"engines\\\": {\\r\\n    \\\"node\\\": \\\">=18\\\"\\r\\n  }\\r\\n}\\r\\n\"\n    },\n    \"resources/prompts/codeAgentPromt.txt\": {\n      \"bytes\": 2845,\n      \"content\": \"Jesteś wyspecjalizowanym agentem do edycji repozytorium kodu, działającym wyłącznie poprzez narzędzia (tool calling).\\r\\n\\r\\nROLA:\\r\\nTwoim zadaniem jest precyzyjna, minimalna i bezpieczna modyfikacja kodu zgodnie z poleceniem użytkownika.\\r\\n\\r\\nZASADY NADRZĘDNE:\\r\\n1. Zawsze używaj read_file przed jakąkolwiek modyfikacją pliku.\\r\\n2. Każda zmiana musi być poprzedzona analizą istniejącego kodu.\\r\\n3. Minimalizuj zakres zmian – nie wykonuj refactorów ani masowego formatowania, jeśli nie jest to wymagane.\\r\\n4. Preferuj edycję patch-based (apply_patch) do drobnych/poprawkowych zmian w plikach. write_file używaj do tworzenia nowych plików lub gdy świadomie podmieniasz cały plik.\\r\\n5. Przy write_file zawsze podawaj pełną, nową zawartość pliku.\\r\\n6. Nie wykonuj poleceń systemowych ani shellowych.\\r\\n7. Do interakcji z repozytorium używaj wyłącznie dostępnych narzędzi.\\r\\n\\r\\nOGRANICZENIA BEZPIECZEŃSTWA:\\r\\n8. Pracujesz wyłącznie w obrębie repozytorium wskazanego przez --repo.\\r\\n9. Path traversal (np. ../) jest zabroniony.\\r\\n10. Nie czytaj ani nie zapisuj następujących ścieżek i plików:\\r\\n    - .git/\\r\\n    - node_modules/\\r\\n    - dist/\\r\\n    - .env\\r\\n    - *.pem\\r\\n    - *.key\\r\\n\\r\\nEDYCJA PATCH-BASED (apply_patch):\\r\\n11. Używaj narzędzia apply_patch, aby stosować zmiany w formie patcha (unified, bez nagłówków hunk). Format patcha musi być zgodny z diff_file_against_original:\\r\\n    - Nagłówki pliku: \\\"--- a/<ścieżka>\\\" i \\\"+++ b/<ścieżka>\\\",\\r\\n    - Linijki treści z prefiksami: \\\" \\\" (bez zmian), \\\"+\\\" (dodaj), \\\"-\\\" (usuń),\\r\\n    - Bez nagłówków hunk (@@ ... @@). Dokładnie taki format generuje diff_file_against_original.\\r\\n12. Przed apply_patch musisz wywołać read_file dla każdego istniejącego pliku, który patch ma zmodyfikować (narzędzie to egzekwuje).\\r\\n13. Patch powinien obejmować tylko niezbędne zmiany. Nie stosuj patchy, które wprowadzają niepowiązane modyfikacje.\\r\\n14. Nie używaj patcha do usuwania plików – do usunięcia służy delete_file. Tworzenie nowych plików przez patch jest dozwolone (sekcja \\\"+\\\" bez bazowej zawartości).\\r\\n\\r\\nZASADY PRACY Z KODEM:\\r\\n15. Jeśli nie znasz struktury repozytorium, użyj list_files.\\r\\n16. Jeśli musisz znaleźć konkretny fragment kodu, użyj search_in_files lub list_files + read_file.\\r\\n17. Zachowuj istniejące konwencje kodu, styl i architekturę.\\r\\n18. Nie wprowadzaj zmian wykraczających poza zakres zadania użytkownika.\\r\\n19. Nie obniżaj bezpieczeństwa ani nie zmieniaj publicznych kontraktów API bez wyraźnego polecenia.\\r\\n\\r\\nSTRATEGIA DZIAŁANIA:\\r\\n20. Działaj sekwencyjnie: analiza → minimalna zmiana → zapis.\\r\\n21. Każda modyfikacja musi mieć jednoznaczne uzasadnienie w kontekście zadania.\\r\\n\\r\\nCEL:\\r\\nZrealizuj polecenie użytkownika w sposób precyzyjny, minimalnie inwazyjny, bezpieczny i w pełni kontrolowany przez narzędzia.\\r\\n\"\n    },\n    \"src/agent/log.ts\": {\n      \"bytes\": 2320,\n      \"content\": \"import fs from \\\"node:fs\\\";\\r\\nimport path from \\\"node:path\\\";\\r\\n\\r\\nfunction redactString(input: string): string {\\r\\n  if (!input) return input;\\r\\n  let s = input;\\r\\n  // Mask key=value and key: value patterns for common secret keys\\r\\n  const keyPattern = /(api_key|apikey|token|secret|password|client_secret|private_key)\\\\s*([:=])\\\\s*([^\\\\s,;\\\"']+)/gi;\\r\\n  s = s.replace(keyPattern, (_m, k: string, sep: string) => `${k}${sep} ****`);\\r\\n  // Mask Authorization: Bearer xxx and Bearer xxx\\r\\n  s = s.replace(/authorization\\\\s*:\\\\s*bearer\\\\s+[^\\\\s]+/gi, \\\"Authorization: Bearer ****\\\");\\r\\n  s = s.replace(/bearer\\\\s+[^\\\\s]+/gi, \\\"Bearer ****\\\");\\r\\n  return s;\\r\\n}\\r\\n\\r\\nfunction redactValue(val: any): any {\\r\\n  if (typeof val === \\\"string\\\") return redactString(val);\\r\\n  if (Array.isArray(val)) return val.map((v) => redactValue(v));\\r\\n  if (val && typeof val === \\\"object\\\") {\\r\\n    const out: Record<string, any> = {};\\r\\n    for (const [k, v] of Object.entries(val)) out[k] = redactValue(v);\\r\\n    return out;\\r\\n  }\\r\\n  return val;\\r\\n}\\r\\n\\r\\nexport class AgentLogger {\\r\\n  private readonly rawPath: string;\\r\\n\\r\\n  constructor(private readonly repoRoot: string) {\\r\\n    // Ensure repo root exists for logs/outputs\\r\\n    try {\\r\\n      fs.mkdirSync(repoRoot, { recursive: true });\\r\\n    } catch (e: any) {\\r\\n      console.error(\\r\\n        \\\"[agent] ERROR: Nie można utworzyć katalogu repoRoot:\\\",\\r\\n        repoRoot,\\r\\n        \\\"\\\\nPowód:\\\",\\r\\n        e?.message ?? String(e)\\r\\n      );\\r\\n      process.exitCode = 1;\\r\\n      // Twarde zakończenie aby uniknąć kolejnych błędów zapisu logów/plików wyjściowych\\r\\n      process.exit(1);\\r\\n    }\\r\\n    this.rawPath = path.join(repoRoot, \\\"agent.raw.txt\\\");\\r\\n  }\\r\\n\\r\\n  initNewRun(meta: { task: string; model: string; startedAt: string }) {\\r\\n    this.appendLine(\\\"=== AGENT RUN START ===\\\");\\r\\n    this.appendJSON({ type: \\\"meta\\\", ...meta });\\r\\n  }\\r\\n\\r\\n  appendLine(line: string) {\\r\\n    const safe = redactString(line ?? \\\"\\\");\\r\\n    fs.appendFileSync(this.rawPath, safe + \\\"\\\\n\\\", \\\"utf8\\\");\\r\\n  }\\r\\n\\r\\n  appendJSON(obj: any) {\\r\\n    const redacted = redactValue(obj);\\r\\n    const line = JSON.stringify(redacted);\\r\\n    fs.appendFileSync(this.rawPath, line + \\\"\\\\n\\\", \\\"utf8\\\");\\r\\n  }\\r\\n\\r\\n  saveDiffText(diffText: string) {\\r\\n    const outPath = path.join(this.repoRoot, \\\"agent.diff.txt\\\");\\r\\n    fs.writeFileSync(outPath, diffText, \\\"utf8\\\");\\r\\n    return outPath;\\r\\n  }\\r\\n}\\r\\n\"\n    },\n    \"src/agent/run.ts\": {\n      \"bytes\": 7300,\n      \"content\": \"import path from \\\"node:path\\\";\\r\\nimport fs from \\\"node:fs\\\";\\r\\nimport { spawnSync } from \\\"node:child_process\\\";\\r\\n\\r\\nimport { openai } from \\\"../openai.ts\\\";\\r\\nimport { AgentLogger } from \\\"./log.ts\\\";\\r\\nimport { RepoTools } from \\\"./tools.ts\\\";\\r\\nimport { SandboxOptions, listFilesRecursive } from \\\"./security.ts\\\";\\r\\n\\r\\n/**\\r\\n * Konfiguracja bezpieczeństwa repo sandbox.\\r\\n */\\r\\nexport function defaultSandboxOptions(repoRoot: string): SandboxOptions {\\r\\n  return {\\r\\n    repoRoot,\\r\\n    denyDirs: [\\\".git\\\", \\\"node_modules\\\", \\\"dist\\\"],\\r\\n    denyFilesExact: [\\\".env\\\"],\\r\\n    denyExtensions: [\\\".pem\\\", \\\".key\\\"],\\r\\n    maxReadBytes: 400_000,\\r\\n    maxWriteBytes: 800_000,\\r\\n  };\\r\\n}\\r\\n\\r\\nexport type AgentRunOptions = {\\r\\n  repoRoot: string;\\r\\n  task: string;\\r\\n  model?: string; // np. \\\"gpt-5\\\"\\r\\n  maxToolCalls?: number; // domyślnie 50\\r\\n};\\r\\n\\r\\nfunction nowIso() {\\r\\n  return new Date().toISOString();\\r\\n}\\r\\n\\r\\nfunction safeGitDiff(repoRoot: string): { ok: boolean; diff?: string; error?: string } {\\r\\n  // Jedyna komenda systemowa” jaką wykonujemy: git diff\\r\\n  const res = spawnSync(\\\"git\\\", [\\\"diff\\\"], {\\r\\n    cwd: repoRoot,\\r\\n    shell: false,\\r\\n    encoding: \\\"utf8\\\",\\r\\n  });\\r\\n\\r\\n  if (res.status !== 0) {\\r\\n    return { ok: false, error: `${res.stdout}\\\\n${res.stderr}`.trim() };\\r\\n  }\\r\\n  return { ok: true, diff: res.stdout ?? \\\"\\\" };\\r\\n}\\r\\n\\r\\nfunction buildSystemPrompt(repoRoot: string) {\\r\\n  // Zawsze wczytuj prompt z pliku: resources/prompts/codeAgentPromt.txt (relatywnie do repoRoot)\\r\\n  const promptPath = path.join(repoRoot, \\\"resources\\\", \\\"prompts\\\", \\\"codeAgentPromt.txt\\\");\\r\\n  if (!fs.existsSync(promptPath)) {\\r\\n    throw new Error(`Brak pliku promptu: ${promptPath}`);\\r\\n  }\\r\\n  const content = fs.readFileSync(promptPath, \\\"utf8\\\");\\r\\n  const normalized = (content ?? \\\"\\\").replace(/\\\\r\\\\n/g, \\\"\\\\n\\\").trim();\\r\\n  if (!normalized) {\\r\\n    throw new Error(`Plik promptu jest pusty: ${promptPath}`);\\r\\n  }\\r\\n  return normalized;\\r\\n}\\r\\n\\r\\n/**\\r\\n * Tworzy snapshot bazowy repozytorium na potrzeby review.\\r\\n * Zapisuje .agent_baseline.json w katalogu głównym repo.\\r\\n */\\r\\nfunction createBaseline(opts: SandboxOptions): { path: string; files: number } {\\r\\n  const repoRoot = path.resolve(opts.repoRoot);\\r\\n  const baselinePath = path.join(repoRoot, \\\".agent_baseline.json\\\");\\r\\n\\r\\n  const files = listFilesRecursive(opts, 5000);\\r\\n  const data: any = {\\r\\n    createdAt: nowIso(),\\r\\n    maxReadBytes: opts.maxReadBytes,\\r\\n    files: {} as Record<string, { bytes: number; content: string | null }>,\\r\\n  };\\r\\n\\r\\n  for (const rel of files) {\\r\\n    try {\\r\\n      const abs = path.join(repoRoot, rel.replaceAll(\\\"/\\\", path.sep));\\r\\n      const st = fs.statSync(abs);\\r\\n      if (!st.isFile()) continue;\\r\\n      if (st.size <= opts.maxReadBytes) {\\r\\n        const content = fs.readFileSync(abs, \\\"utf8\\\");\\r\\n        data.files[rel] = { bytes: st.size, content };\\r\\n      } else {\\r\\n        data.files[rel] = { bytes: st.size, content: null };\\r\\n      }\\r\\n    } catch {\\r\\n      // pomiń pliki, których nie da się odczytać\\r\\n    }\\r\\n  }\\r\\n\\r\\n  fs.writeFileSync(baselinePath, JSON.stringify(data, null, 2), \\\"utf8\\\");\\r\\n  return { path: baselinePath, files: Object.keys(data.files).length };\\r\\n}\\r\\n\\r\\n/**\\r\\n * Agent loop z tool calling.\\r\\n *\\r\\n * WAŻNE:\\r\\n * - Używamy previous_response_id, więc NIE odsyłamy function_call itemów z powrotem w input,\\r\\n *   bo mają id (fc_...) i API zwraca 400 Duplicate item found.\\r\\n * - Odsyłamy tylko function_call_output z call_id.\\r\\n */\\r\\nexport async function runAgent(opts: AgentRunOptions): Promise<void> {\\r\\n  const repoRoot = path.resolve(opts.repoRoot);\\r\\n  const task = opts.task.trim();\\r\\n  const model = opts.model ?? \\\"gpt-5\\\";\\r\\n  const maxToolCalls = Math.max(1, Math.min(opts.maxToolCalls ?? 50, 50));\\r\\n\\r\\n  const logger = new AgentLogger(repoRoot);\\r\\n  logger.initNewRun({ task, model, startedAt: nowIso() });\\r\\n\\r\\n  const sandbox = defaultSandboxOptions(repoRoot);\\r\\n\\r\\n  // Utwórz snapshot bazowy dla funkcji review\\r\\n  try {\\r\\n    const b = createBaseline(sandbox);\\r\\n    logger.appendJSON({ type: \\\"baseline_created\\\", at: nowIso(), path: b.path, files: b.files });\\r\\n  } catch (e: any) {\\r\\n    logger.appendJSON({ type: \\\"baseline_error\\\", at: nowIso(), error: e?.message ?? String(e) });\\r\\n  }\\r\\n\\r\\n  const tools = new RepoTools(sandbox);\\r\\n\\r\\n  logger.appendJSON({ type: \\\"model_request\\\", at: nowIso(), model, phase: \\\"initial\\\" });\\r\\n\\r\\n  // Pierwsze wywołanie: system + user\\r\\n  let response = await openai.responses.create({\\r\\n    model,\\r\\n    tools: tools.getToolSpecs() as any,\\r\\n    input: [\\r\\n      { role: \\\"system\\\", content: buildSystemPrompt(repoRoot) },\\r\\n      { role: \\\"user\\\", content: task },\\r\\n    ],\\r\\n  });\\r\\n\\r\\n  let toolCallsUsed = 0;\\r\\n\\r\\n  while (true) {\\r\\n    const outputItems: any[] = (response as any).output ?? [];\\r\\n\\r\\n    logger.appendJSON({\\r\\n      type: \\\"model_response\\\",\\r\\n      at: nowIso(),\\r\\n      id: (response as any).id,\\r\\n      output_text: (response as any).output_text ?? \\\"\\\",\\r\\n      output: outputItems,\\r\\n    });\\r\\n\\r\\n    const functionCalls = outputItems.filter((it) => it?.type === \\\"function_call\\\");\\r\\n\\r\\n    // Jeśli model nie woła narzędzi, kończymy\\r\\n    if (functionCalls.length === 0) break;\\r\\n\\r\\n    const nextInput: any[] = [];\\r\\n\\r\\n    for (const item of functionCalls) {\\r\\n      toolCallsUsed++;\\r\\n      if (toolCallsUsed > maxToolCalls) {\\r\\n        throw new Error(`Tool call limit exceeded (${maxToolCalls}).`);\\r\\n      }\\r\\n\\r\\n      const name = item.name as any;\\r\\n      const callId = item.call_id;\\r\\n      const argsRaw = item.arguments ?? \\\"{}\\\";\\r\\n\\r\\n      logger.appendJSON({\\r\\n        type: \\\"tool_call\\\",\\r\\n        at: nowIso(),\\r\\n        call_id: callId,\\r\\n        name,\\r\\n        arguments: argsRaw,\\r\\n      });\\r\\n\\r\\n      let args: any = {};\\r\\n      try {\\r\\n        args = typeof argsRaw === \\\"string\\\" ? JSON.parse(argsRaw) : argsRaw;\\r\\n      } catch {\\r\\n        args = {};\\r\\n      }\\r\\n\\r\\n      const result = await tools.dispatch({ name, arguments: args } as any);\\r\\n\\r\\n      logger.appendJSON({\\r\\n        type: \\\"tool_result\\\",\\r\\n        at: nowIso(),\\r\\n        call_id: callId,\\r\\n        name,\\r\\n        ok: result.ok,\\r\\n        error: result.error,\\r\\n        result_preview:\\r\\n          result.result && typeof result.result === \\\"object\\\"\\r\\n            ? JSON.stringify(result.result).slice(0, 5000)\\r\\n            : String(result.result ?? \\\"\\\").slice(0, 5000),\\r\\n      });\\r\\n\\r\\n      // Odsyłamy TYLKO output narzędzia\\r\\n      nextInput.push({\\r\\n        type: \\\"function_call_output\\\",\\r\\n        call_id: callId,\\r\\n        output: JSON.stringify(result),\\r\\n      });\\r\\n    }\\r\\n\\r\\n    logger.appendJSON({\\r\\n      type: \\\"model_request\\\",\\r\\n      at: nowIso(),\\r\\n      model,\\r\\n      phase: \\\"followup\\\",\\r\\n      tool_calls_used: toolCallsUsed,\\r\\n      followup_items: nextInput.length,\\r\\n    });\\r\\n\\r\\n    response = await openai.responses.create({\\r\\n      model,\\r\\n      tools: tools.getToolSpecs() as any,\\r\\n      previous_response_id: (response as any).id,\\r\\n      input: nextInput,\\r\\n    });\\r\\n  }\\r\\n\\r\\n  // Po zakończeniu agent loop: generujemy lokalnie agent.diff.txt (bez udziału modelu)\\r\\n  const diffRes = safeGitDiff(repoRoot);\\r\\n  if (diffRes.ok) {\\r\\n    const out = logger.saveDiffText(diffRes.diff ?? \\\"\\\");\\r\\n    logger.appendLine(`=== SAVED DIFF: ${out} ===`);\\r\\n  } else {\\r\\n    logger.appendLine(\\\"=== WARNING: git diff failed (repo may not be git). Diff omitted. ===\\\");\\r\\n    logger.appendJSON({ type: \\\"git_diff_error\\\", at: nowIso(), error: diffRes.error });\\r\\n  }\\r\\n\\r\\n  logger.appendLine(\\\"=== AGENT RUN END ===\\\");\\r\\n}\\r\\n\"\n    },\n    \"src/agent/security.ts\": {\n      \"bytes\": 4586,\n      \"content\": \"import path from \\\"node:path\\\";\\nimport fs from \\\"node:fs\\\";\\n\\nexport type SandboxOptions = {\\n  repoRoot: string;\\n  denyDirs: string[]; // np. [\\\".git\\\", \\\"node_modules\\\", \\\"dist\\\"]\\n  denyFilesExact: string[]; // np. [\\\".env\\\"]\\n  denyExtensions: string[]; // np. [\\\".pem\\\", \\\".key\\\"]\\n  maxReadBytes: number; // np. 400_000\\n  maxWriteBytes: number; // np. 800_000\\n};\\n\\nexport type SafePathResult = {\\n  absPath: string;\\n  relPath: string; // zawsze POSIX (\\\"/\\\")\\n};\\n\\n/**\\n * Sprawdza denylistę na ścieżce relatywnej (POSIX).\\n */\\nexport function isDeniedPath(opts: SandboxOptions, relPosixPath: string): boolean {\\n  const pRaw = relPosixPath.replace(/^\\\\/+/, \\\"\\\"); // bez wiodących /\\n  const p = pRaw.toLowerCase();\\n\\n  const denyFiles = opts.denyFilesExact.map((s) => s.toLowerCase());\\n  const denyExts = opts.denyExtensions.map((s) => s.toLowerCase());\\n  const denyDirs = opts.denyDirs.map((s) => s.toLowerCase());\\n\\n  // zablokuj pliki dokładne\\n  const base = path.posix.basename(p);\\n  if (denyFiles.includes(base)) return true;\\n\\n  // zablokuj rozszerzenia\\n  const ext = path.posix.extname(base);\\n  if (ext && denyExts.includes(ext)) return true;\\n\\n  // zablokuj katalogi na dowolnym poziomie\\n  const segments = p.split(\\\"/\\\");\\n  for (const seg of segments) {\\n    if (denyDirs.includes(seg)) return true;\\n  }\\n\\n  return false;\\n}\\n\\n/**\\n * Normalizuje ścieżkę i blokuje path traversal.\\n * Zwraca relPath (POSIX) i absPath.\\n */\\nexport function resolveInRepo(opts: SandboxOptions, userPath: string): SafePathResult {\\n  if (typeof userPath !== \\\"string\\\") {\\n    throw new Error(\\\"Invalid path: expected string\\\");\\n  }\\n  if (userPath.includes(\\\"\\\\u0000\\\")) {\\n    throw new Error(\\\"Invalid path: null byte\\\");\\n  }\\n  const userPathTrimmed = userPath.trim();\\n  if (!userPathTrimmed) {\\n    throw new Error(`Invalid path: \\\"${userPath}\\\"`);\\n  }\\n\\n  const realRepoAbs = fs.realpathSync(path.resolve(opts.repoRoot));\\n  const candidateAbs = path.resolve(realRepoAbs, userPathTrimmed);\\n\\n  // Ustal realną ścieżkę kandydata z obsługą nieistniejącego pliku\\n  let realCandidateAbs: string;\\n  try {\\n    realCandidateAbs = fs.realpathSync(candidateAbs);\\n  } catch {\\n    const parent = path.dirname(candidateAbs);\\n    const base = path.basename(candidateAbs);\\n    let realParent: string;\\n    try {\\n      realParent = fs.realpathSync(parent);\\n    } catch {\\n      throw new Error(`Invalid path: \\\"${userPath}\\\"`);\\n    }\\n    realCandidateAbs = path.join(realParent, base);\\n  }\\n\\n  // Warunek bezpieczeństwa: musi zaczynać się od realRepoAbs + path.sep\\n  const mustStart = realRepoAbs + path.sep;\\n  if (!realCandidateAbs.startsWith(mustStart)) {\\n    throw new Error(`Path traversal blocked: \\\"${userPath}\\\"`);\\n  }\\n\\n  // Oblicz relatywną ścieżkę na podstawie realnych ścieżek\\n  const relFromRepo = path.relative(realRepoAbs, realCandidateAbs);\\n  const relPosix = relFromRepo.replaceAll(path.sep, \\\"/\\\");\\n\\n  if (!relPosix || relPosix.trim() === \\\"\\\") {\\n    // root repo lub pusta ścieżka\\n    throw new Error(`Invalid path: \\\"${userPath}\\\"`);\\n  }\\n\\n  // Zablokuj katalogi – ta funkcja zwraca ścieżki tylko do plików\\n  try {\\n    if (fs.existsSync(realCandidateAbs)) {\\n      const st = fs.lstatSync(realCandidateAbs);\\n      if (st.isDirectory()) {\\n        throw new Error(`Invalid path: \\\"${userPath}\\\"`);\\n      }\\n    }\\n  } catch {\\n    throw new Error(`Invalid path: \\\"${userPath}\\\"`);\\n  }\\n\\n  if (isDeniedPath(opts, relPosix)) {\\n    throw new Error(`Access denied by policy: \\\"${relPosix}\\\"`);\\n  }\\n\\n  return { absPath: realCandidateAbs, relPath: relPosix };\\n}\\n\\nexport function ensureParentDirExists(fileAbsPath: string): void {\\n  const dir = path.dirname(fileAbsPath);\\n  fs.mkdirSync(dir, { recursive: true });\\n}\\n\\n/**\\n * Bezpieczne listowanie plików w repo (z ignorowaniem denylist).\\n * Zwraca relatywne ścieżki POSIX.\\n */\\nexport function listFilesRecursive(opts: SandboxOptions, maxFiles = 5000): string[] {\\n  const repoAbs = path.resolve(opts.repoRoot);\\n  const results: string[] = [];\\n\\n  function walk(dirAbs: string) {\\n    if (results.length >= maxFiles) return;\\n\\n    let entries: fs.Dirent[];\\n    try {\\n      entries = fs.readdirSync(dirAbs, { withFileTypes: true });\\n    } catch {\\n      return;\\n    }\\n\\n    for (const e of entries) {\\n      if (results.length >= maxFiles) return;\\n\\n      const childAbs = path.join(dirAbs, e.name);\\n      const rel = path.relative(repoAbs, childAbs).replaceAll(path.sep, \\\"/\\\");\\n\\n      if (!rel || isDeniedPath(opts, rel)) continue;\\n\\n      if (e.isDirectory()) {\\n        walk(childAbs);\\n      } else if (e.isFile()) {\\n        results.push(rel);\\n      }\\n    }\\n  }\\n\\n  walk(repoAbs);\\n  return results.sort();\\n}\\n\"\n    },\n    \"src/agent/tools.ts\": {\n      \"bytes\": 25817,\n      \"content\": \"import fs from \\\"node:fs\\\";\\nimport path from \\\"node:path\\\";\\nimport crypto from \\\"node:crypto\\\";\\nimport {\\n  SandboxOptions,\\n  listFilesRecursive,\\n  resolveInRepo,\\n  ensureParentDirExists,\\n} from \\\"./security.ts\\\";\\n\\nexport type ToolName =\\n  | \\\"list_files\\\"\\n  | \\\"read_file\\\"\\n  | \\\"write_file\\\"\\n  | \\\"delete_file\\\"\\n  | \\\"search_in_files\\\"\\n  | \\\"get_baseline_info\\\"\\n  | \\\"list_changed_files\\\"\\n  | \\\"read_file_original\\\"\\n  | \\\"diff_file_against_original\\\"\\n  | \\\"apply_patch\\\";\\n\\nexport type ToolCall = {\\n  name: ToolName;\\n  arguments: any;\\n};\\n\\nexport type ToolResult = {\\n  ok: boolean;\\n  result?: any;\\n  error?: string;\\n};\\n\\nconst BASELINE_FILENAME = \\\".agent_baseline.json\\\";\\nconst LCS_MAX_TOTAL_LINES = 10000; // hard limit for LCS-based diff\\n\\nexport class RepoTools {\\n  private readonly readFilesThisRun = new Set<string>();\\n\\n  constructor(private readonly opts: SandboxOptions) {}\\n\\n  /**\\n   * Specyfikacje narzędzi dla modelu (function calling).\\n   */\\n  getToolSpecs() {\\n    return [\\n      {\\n        type: \\\"function\\\",\\n        name: \\\"list_files\\\",\\n        description:\\n          \\\"List files in the repository. Returns relative POSIX paths. Denylisted dirs/files are excluded.\\\",\\n        parameters: {\\n          type: \\\"object\\\",\\n          additionalProperties: false,\\n          properties: {\\n            prefix: {\\n              type: \\\"string\\\",\\n              description: \\\"Optional prefix filter (POSIX, e.g. 'src/' ).\\\",\\n            },\\n            limit: {\\n              type: \\\"integer\\\",\\n              description: \\\"Max number of files to return (default 2000).\\\",\\n              minimum: 1,\\n              maximum: 5000,\\n            },\\n          },\\n        },\\n      },\\n      {\\n        type: \\\"function\\\",\\n        name: \\\"read_file\\\",\\n        description:\\n          \\\"Read a text file from repo. MUST be called before modifying a file. Denylist and size limit apply.\\\",\\n        parameters: {\\n          type: \\\"object\\\",\\n          additionalProperties: false,\\n          properties: {\\n            path: { type: \\\"string\\\", description: \\\"Relative path inside repo.\\\" },\\n          },\\n          required: [\\\"path\\\"],\\n        },\\n      },\\n      {\\n        type: \\\"function\\\",\\n        name: \\\"write_file\\\",\\n        description:\\n          \\\"Write (create/overwrite) a text file inside repo. Provide full new file content. Denylist and size limit apply.\\\",\\n        parameters: {\\n          type: \\\"object\\\",\\n          additionalProperties: false,\\n          properties: {\\n            path: { type: \\\"string\\\", description: \\\"Relative path inside repo.\\\" },\\n            content: { type: \\\"string\\\", description: \\\"Full new file content.\\\" },\\n          },\\n          required: [\\\"path\\\", \\\"content\\\"],\\n        },\\n      },\\n      {\\n        type: \\\"function\\\",\\n        name: \\\"delete_file\\\",\\n        description:\\n          \\\"Delete a file inside repo. Use only when explicitly needed. Denylist applies.\\\",\\n        parameters: {\\n          type: \\\"object\\\",\\n          additionalProperties: false,\\n          properties: {\\n            path: { type: \\\"string\\\", description: \\\"Relative path inside repo.\\\" },\\n          },\\n          required: [\\\"path\\\"],\\n        },\\n      },\\n      {\\n        type: \\\"function\\\",\\n        name: \\\"search_in_files\\\",\\n        description:\\n          \\\"Search for a substring in text files (simple contains). Returns matches with file and line numbers. Denylist and max file size apply.\\\",\\n        parameters: {\\n          type: \\\"object\\\",\\n          additionalProperties: false,\\n          properties: {\\n            query: { type: \\\"string\\\", description: \\\"Substring to search for.\\\" },\\n            prefix: { type: \\\"string\\\", description: \\\"Optional path prefix filter, e.g. 'src/'.\\\" },\\n            limit_files: { type: \\\"integer\\\", minimum: 1, maximum: 2000 },\\n            limit_matches: { type: \\\"integer\\\", minimum: 1, maximum: 2000 },\\n          },\\n          required: [\\\"query\\\"],\\n        },\\n      },\\n      {\\n        type: \\\"function\\\",\\n        name: \\\"get_baseline_info\\\",\\n        description:\\n          \\\"Get metadata about the initial repository snapshot used for review (created at agent start).\\\",\\n        parameters: { type: \\\"object\\\", additionalProperties: false, properties: {} },\\n      },\\n      {\\n        type: \\\"function\\\",\\n        name: \\\"list_changed_files\\\",\\n        description:\\n          \\\"List added/modified/deleted files compared to the baseline snapshot (created at agent start).\\\",\\n        parameters: {\\n          type: \\\"object\\\",\\n          additionalProperties: false,\\n          properties: {\\n            prefix: { type: \\\"string\\\", description: \\\"Optional path prefix filter, e.g. 'src/'.\\\" },\\n            limit: { type: \\\"integer\\\", minimum: 1, maximum: 5000 },\\n          },\\n        },\\n      },\\n      {\\n        type: \\\"function\\\",\\n        name: \\\"read_file_original\\\",\\n        description:\\n          \\\"Read file content from the baseline snapshot (original version at agent start).\\\",\\n        parameters: {\\n          type: \\\"object\\\",\\n          additionalProperties: false,\\n          properties: {\\n            path: { type: \\\"string\\\", description: \\\"Relative path inside repo.\\\" },\\n          },\\n          required: [\\\"path\\\"],\\n        },\\n      },\\n      {\\n        type: \\\"function\\\",\\n        name: \\\"diff_file_against_original\\\",\\n        description:\\n          \\\"Compute a simple unified diff between current file content and the baseline (original). Returns summary and diff text.\\\",\\n        parameters: {\\n          type: \\\"object\\\",\\n          additionalProperties: false,\\n          properties: {\\n            path: { type: \\\"string\\\", description: \\\"Relative path inside repo.\\\" },\\n            max_lines: { type: \\\"integer\\\", description: \\\"Max diff lines to include in output (default 2000).\\\", minimum: 1, maximum: 10000 },\\n          },\\n          required: [\\\"path\\\"],\\n        },\\n      },\\n      {\\n        type: \\\"function\\\",\\n        name: \\\"apply_patch\\\",\\n        description:\\n          \\\"Apply a simple unified patch (without hunk headers) to one or more files. The format must match output of diff_file_against_original (lines starting with '--- a/', '+++ b/' followed by lines prefixed with space, '+' or '-'). Requires prior read_file for every existing file being modified.\\\",\\n        parameters: {\\n          type: \\\"object\\\",\\n          additionalProperties: false,\\n          properties: {\\n            patch: { type: \\\"string\\\", description: \\\"Unified patch text for one or more files.\\\" },\\n          },\\n          required: [\\\"patch\\\"],\\n        },\\n      },\\n    ] as const;\\n  }\\n\\n  async dispatch(call: ToolCall): Promise<ToolResult> {\\n    try {\\n      switch (call.name) {\\n        case \\\"list_files\\\":\\n          return { ok: true, result: this.listFiles(call.arguments) };\\n        case \\\"read_file\\\":\\n          return { ok: true, result: this.readFile(call.arguments) };\\n        case \\\"write_file\\\":\\n          return { ok: true, result: this.writeFile(call.arguments) };\\n        case \\\"delete_file\\\":\\n          return { ok: true, result: this.deleteFile(call.arguments) };\\n        case \\\"search_in_files\\\":\\n          return { ok: true, result: this.searchInFiles(call.arguments) };\\n        case \\\"get_baseline_info\\\":\\n          return { ok: true, result: this.getBaselineInfo() };\\n        case \\\"list_changed_files\\\":\\n          return { ok: true, result: this.listChangedFiles(call.arguments) };\\n        case \\\"read_file_original\\\":\\n          return { ok: true, result: this.readFileOriginal(call.arguments) };\\n        case \\\"diff_file_against_original\\\":\\n          return { ok: true, result: this.diffFileAgainstOriginal(call.arguments) };\\n        case \\\"apply_patch\\\":\\n          return { ok: true, result: this.applyPatch(call.arguments) };\\n        default:\\n          return { ok: false, error: `Unknown tool: ${(call as any).name}` };\\n      }\\n    } catch (e: any) {\\n      return { ok: false, error: e?.message ?? String(e) };\\n    }\\n  }\\n\\n  private listFiles(args: { prefix?: string; limit?: number }) {\\n    const all = listFilesRecursive(this.opts, 5000);\\n    const prefix = (args.prefix ?? \\\"\\\").trim();\\n    let out = all;\\n    if (prefix) out = out.filter((p) => p.startsWith(prefix));\\n    const limit = Math.min(Math.max(args.limit ?? 2000, 1), 5000);\\n    return { files: out.slice(0, limit), total: out.length };\\n  }\\n\\n  private readFile(args: { path: string }) {\\n    const { absPath, relPath } = resolveInRepo(this.opts, args.path);\\n\\n    const st = fs.statSync(absPath);\\n    if (!st.isFile()) throw new Error(`Not a file: ${relPath}`);\\n\\n    if (st.size > this.opts.maxReadBytes) {\\n      throw new Error(\\n        `File too large for read_file (${st.size} bytes > ${this.opts.maxReadBytes}): ${relPath}`\\n      );\\n    }\\n\\n    const content = fs.readFileSync(absPath, \\\"utf8\\\");\\n    this.readFilesThisRun.add(relPath);\\n    return { path: relPath, bytes: st.size, content };\\n  }\\n\\n  private writeFile(args: { path: string; content: string }) {\\n    const { absPath, relPath } = resolveInRepo(this.opts, args.path);\\n\\n    const content = args.content ?? \\\"\\\";\\n    const bytes = Buffer.byteLength(content, \\\"utf8\\\");\\n    if (bytes > this.opts.maxWriteBytes) {\\n      throw new Error(\\n        `Content too large for write_file (${bytes} bytes > ${this.opts.maxWriteBytes}): ${relPath}`\\n      );\\n    }\\n\\n    // Enforce read_file before write for existing files\\n    const exists = fs.existsSync(absPath);\\n    if (exists && !this.readFilesThisRun.has(relPath)) {\\n      throw new Error(`MUST read_file before write_file for existing file: ${relPath}`);\\n    }\\n\\n    ensureParentDirExists(absPath);\\n    fs.writeFileSync(absPath, content, \\\"utf8\\\");\\n    return { path: relPath, bytes };\\n  }\\n\\n  private deleteFile(args: { path: string }) {\\n    const { absPath, relPath } = resolveInRepo(this.opts, args.path);\\n\\n    if (!fs.existsSync(absPath)) {\\n      return { path: relPath, deleted: false, reason: \\\"not_found\\\" as const };\\n    }\\n    const st = fs.statSync(absPath);\\n    if (!st.isFile()) throw new Error(`Not a file: ${relPath}`);\\n\\n    fs.unlinkSync(absPath);\\n    return { path: relPath, deleted: true };\\n  }\\n\\n  private searchInFiles(args: {\\n    query: string;\\n    prefix?: string;\\n    limit_files?: number;\\n    limit_matches?: number;\\n  }) {\\n    const query = (args.query ?? \\\"\\\").toString();\\n    if (!query) throw new Error(\\\"query is required\\\");\\n\\n    const prefix = (args.prefix ?? \\\"\\\").trim();\\n    const limitFiles = Math.min(Math.max(args.limit_files ?? 800, 1), 2000);\\n    const limitMatches = Math.min(Math.max(args.limit_matches ?? 200, 1), 2000);\\n\\n    const all = listFilesRecursive(this.opts, 5000)\\n      .filter((p) => (prefix ? p.startsWith(prefix) : true))\\n      .slice(0, limitFiles);\\n\\n    const matches: Array<{ path: string; line: number; text: string }> = [];\\n\\n    for (const rel of all) {\\n      if (matches.length >= limitMatches) break;\\n\\n      const abs = path.resolve(this.opts.repoRoot, rel.replaceAll(\\\"/\\\", path.sep));\\n      let st: fs.Stats;\\n      try {\\n        st = fs.statSync(abs);\\n      } catch {\\n        continue;\\n      }\\n      if (!st.isFile()) continue;\\n      if (st.size > this.opts.maxReadBytes) continue;\\n\\n      const content = fs.readFileSync(abs, \\\"utf8\\\");\\n      if (!content.includes(query)) continue;\\n\\n      const lines = content.split(/\\\\r?\\\\n/);\\n      for (let i = 0; i < lines.length; i++) {\\n        if (matches.length >= limitMatches) break;\\n        if (lines[i].includes(query)) {\\n          matches.push({ path: rel, line: i + 1, text: lines[i].slice(0, 400) });\\n        }\\n      }\\n    }\\n\\n    return { query, matches, scanned_files: all.length };\\n  }\\n\\n  private baselinePath(): string {\\n    return path.join(this.opts.repoRoot, BASELINE_FILENAME);\\n  }\\n\\n  private loadBaseline(): {\\n    createdAt: string;\\n    maxReadBytes: number;\\n    files: Record<string, { bytes: number; content: string | null }>;\\n  } {\\n    const p = this.baselinePath();\\n    if (!fs.existsSync(p)) {\\n      throw new Error(\\\"Baseline snapshot not found. It should be created automatically at agent start.\\\");\\n    }\\n    const raw = fs.readFileSync(p, \\\"utf8\\\");\\n    let json: any;\\n    try {\\n      json = JSON.parse(raw);\\n    } catch {\\n      throw new Error(\\\"Invalid baseline file JSON.\\\");\\n    }\\n    if (!json || typeof json !== \\\"object\\\" || !json.files) {\\n      throw new Error(\\\"Invalid baseline format.\\\");\\n    }\\n    return json;\\n  }\\n\\n  private getBaselineInfo() {\\n    const b = this.loadBaseline();\\n    const count = Object.keys(b.files).length;\\n    return { created_at: b.createdAt, files: count, maxReadBytes: b.maxReadBytes };\\n  }\\n\\n  private listChangedFiles(args: { prefix?: string; limit?: number }) {\\n    const b = this.loadBaseline();\\n    const baselineFiles = Object.keys(b.files);\\n    const currentFiles = listFilesRecursive(this.opts, 5000);\\n\\n    const prefix = (args.prefix ?? \\\"\\\").trim();\\n    const filt = (p: string) => (prefix ? p.startsWith(prefix) : true);\\n\\n    const baselineSet = new Set(baselineFiles);\\n    const currentSet = new Set(currentFiles);\\n\\n    const added = currentFiles.filter((p) => !baselineSet.has(p) && filt(p));\\n    const deleted = baselineFiles.filter((p) => !currentSet.has(p) && filt(p));\\n\\n    const modified: string[] = [];\\n    for (const p of currentFiles) {\\n      if (!baselineSet.has(p)) continue;\\n      if (!filt(p)) continue;\\n      const abs = path.resolve(this.opts.repoRoot, p.replaceAll(\\\"/\\\", path.sep));\\n      let st: fs.Stats;\\n      try {\\n        st = fs.statSync(abs);\\n      } catch {\\n        continue;\\n      }\\n      const base = b.files[p];\\n      if (!base) continue;\\n      if (st.size !== base.bytes) {\\n        modified.push(p);\\n      } else if (base.content != null && st.size <= this.opts.maxReadBytes) {\\n        try {\\n          const currentContent = fs.readFileSync(abs, \\\"utf8\\\");\\n          if (currentContent !== base.content) modified.push(p);\\n        } catch {}\\n      }\\n    }\\n\\n    const limit = Math.min(Math.max(args.limit ?? 2000, 1), 5000);\\n    return {\\n      baseline_files: baselineFiles.length,\\n      current_files: currentFiles.length,\\n      added: added.slice(0, limit),\\n      deleted: deleted.slice(0, limit),\\n      modified: modified.slice(0, limit),\\n    };\\n  }\\n\\n  private readFileOriginal(args: { path: string }) {\\n    const { relPath } = resolveInRepo(this.opts, args.path);\\n    const b = this.loadBaseline();\\n    const base = b.files[relPath];\\n    if (!base) {\\n      return { path: relPath, existed: false };\\n    }\\n    return { path: relPath, existed: true, bytes: base.bytes, content: base.content };\\n  }\\n\\n  private diffFileAgainstOriginal(args: { path: string; max_lines?: number }) {\\n    const { absPath, relPath } = resolveInRepo(this.opts, args.path);\\n    const b = this.loadBaseline();\\n    const base = b.files[relPath];\\n\\n    let currentExists = fs.existsSync(absPath) && fs.statSync(absPath).isFile();\\n\\n    if (!base && !currentExists) {\\n      return {\\n        path: relPath,\\n        status: \\\"unchanged\\\",\\n        summary: { before_bytes: 0, after_bytes: 0, added_lines: 0, removed_lines: 0 },\\n        note: \\\"File did not exist in baseline and still does not exist.\\\",\\n      };\\n    }\\n\\n    const maxLines = Math.min(Math.max(args.max_lines ?? 2000, 1), 10000);\\n\\n    if (!base && currentExists) {\\n      const content = this.safeRead(absPath, this.opts.maxReadBytes);\\n      const lines = content.split(/\\\\r?\\\\n/);\\n      const diff = this.buildUnifiedDiff(relPath, [], lines, maxLines);\\n      return {\\n        path: relPath,\\n        status: \\\"added\\\",\\n        summary: { before_bytes: 0, after_bytes: Buffer.byteLength(content, \\\"utf8\\\"), added_lines: lines.length, removed_lines: 0 },\\n        diff_text: diff,\\n      };\\n    }\\n\\n    if (base && !currentExists) {\\n      const baseLines = (base.content ?? \\\"\\\").split(/\\\\r?\\\\n/);\\n      const diff = this.buildUnifiedDiff(relPath, baseLines, [], maxLines);\\n      return {\\n        path: relPath,\\n        status: \\\"deleted\\\",\\n        summary: { before_bytes: base.bytes, after_bytes: 0, added_lines: 0, removed_lines: baseLines.length },\\n        diff_text: diff,\\n      };\\n    }\\n\\n    // both exist\\n    const baseContent = base!.content;\\n    if (baseContent == null) {\\n      const st = fs.statSync(absPath);\\n      const changed = st.size !== base!.bytes;\\n      return {\\n        path: relPath,\\n        status: changed ? \\\"modified\\\" : \\\"unchanged\\\",\\n        summary: { before_bytes: base!.bytes, after_bytes: st.size, added_lines: 0, removed_lines: 0 },\\n        note: \\\"Original file too large for content diff; compared by size only.\\\",\\n      };\\n    }\\n\\n    // We have baseline content; decide whether to run LCS or fallback\\n    const curStat = fs.statSync(absPath);\\n    const afterBytes = curStat.size;\\n    const canReadCurrent = afterBytes <= this.opts.maxReadBytes;\\n\\n    if (!canReadCurrent) {\\n      // Fallback: compare by size only, and include hash for baseline\\n      const beforeBytes = Buffer.byteLength(baseContent, \\\"utf8\\\");\\n      const baseHash = crypto.createHash(\\\"sha256\\\").update(baseContent, \\\"utf8\\\").digest(\\\"hex\\\");\\n      const status = beforeBytes === afterBytes ? \\\"unchanged\\\" : \\\"modified\\\";\\n      const header = [`--- a/${relPath}`, `+++ b/${relPath}`, `@@ DIFF OMITTED: file too large for content read @@`].join(\\\"\\\\n\\\");\\n      return {\\n        path: relPath,\\n        status,\\n        summary: { before_bytes: beforeBytes, after_bytes: afterBytes, added_lines: 0, removed_lines: 0 },\\n        note: `Diff omitted due to size limit. before_bytes=${beforeBytes}, after_bytes=${afterBytes}, before_sha256=${baseHash}, after_sha256=unavailable` ,\\n        diff_text: header,\\n      };\\n    }\\n\\n    const currentContent = fs.readFileSync(absPath, \\\"utf8\\\");\\n    const baseLines = baseContent.split(/\\\\r?\\\\n/);\\n    const curLines = currentContent.split(/\\\\r?\\\\n/);\\n\\n    if (baseLines.length + curLines.length > LCS_MAX_TOTAL_LINES) {\\n      // Fallback: fast compare using sizes and hashes\\n      const beforeBytes = Buffer.byteLength(baseContent, \\\"utf8\\\");\\n      const afterBytes2 = Buffer.byteLength(currentContent, \\\"utf8\\\");\\n      const baseHash = crypto.createHash(\\\"sha256\\\").update(baseContent, \\\"utf8\\\").digest(\\\"hex\\\");\\n      const curHash = crypto.createHash(\\\"sha256\\\").update(currentContent, \\\"utf8\\\").digest(\\\"hex\\\");\\n      const modified = beforeBytes !== afterBytes2 || baseHash !== curHash;\\n      const header = [`--- a/${relPath}`, `+++ b/${relPath}`, `@@ DIFF OMITTED: total line limit exceeded (${baseLines.length + curLines.length} > ${LCS_MAX_TOTAL_LINES}) @@`].join(\\\"\\\\n\\\");\\n      return {\\n        path: relPath,\\n        status: modified ? \\\"modified\\\" : \\\"unchanged\\\",\\n        summary: { before_bytes: beforeBytes, after_bytes: afterBytes2, added_lines: 0, removed_lines: 0 },\\n        note: `Diff omitted due to line limit. before_bytes=${beforeBytes}, after_bytes=${afterBytes2}, before_sha256=${baseHash}, after_sha256=${curHash}`,\\n        diff_text: header,\\n      };\\n    }\\n\\n    const ops = this.diffLines(baseLines, curLines);\\n    let added = 0;\\n    let removed = 0;\\n    for (const op of ops) {\\n      if (op.type === \\\"add\\\") added += op.lines.length;\\n      if (op.type === \\\"remove\\\") removed += op.lines.length;\\n    }\\n    const diff = this.buildUnifiedDiff(relPath, baseLines, curLines, maxLines, ops);\\n\\n    return {\\n      path: relPath,\\n      status: added === 0 && removed === 0 ? \\\"unchanged\\\" : \\\"modified\\\",\\n      summary: {\\n        before_bytes: Buffer.byteLength(baseContent, \\\"utf8\\\"),\\n        after_bytes: Buffer.byteLength(currentContent, \\\"utf8\\\"),\\n        added_lines: added,\\n        removed_lines: removed,\\n      },\\n      diff_text: diff,\\n    };\\n  }\\n\\n  private safeRead(absPath: string, limit: number): string {\\n    const st = fs.statSync(absPath);\\n    if (st.size > limit) {\\n      throw new Error(`File too large for diff (${st.size} bytes > ${limit}): ${absPath}`);\\n    }\\n    return fs.readFileSync(absPath, \\\"utf8\\\");\\n  }\\n\\n  // Prosty LCS diff linii\\n  private diffLines(a: string[], b: string[]): Array<{ type: \\\"equal\\\" | \\\"add\\\" | \\\"remove\\\"; lines: string[] }> {\\n    const m = a.length;\\n    const n = b.length;\\n    const dp: number[][] = Array.from({ length: m + 1 }, () => Array(n + 1).fill(0));\\n    for (let i = m - 1; i >= 0; i--) {\\n      for (let j = n - 1; j >= 0; j--) {\\n        if (a[i] === b[j]) dp[i][j] = dp[i + 1][j + 1] + 1;\\n        else dp[i][j] = Math.max(dp[i + 1][j], dp[i][j + 1]);\\n      }\\n    }\\n    const ops: Array<{ type: \\\"equal\\\" | \\\"add\\\" | \\\"remove\\\"; lines: string[] }> = [];\\n    let i = 0,\\n      j = 0;\\n    while (i < m && j < n) {\\n      if (a[i] === b[j]) {\\n        this.pushOp(ops, \\\"equal\\\", a[i]);\\n        i++;\\n        j++;\\n      } else if (dp[i + 1][j] >= dp[i][j + 1]) {\\n        this.pushOp(ops, \\\"remove\\\", a[i]);\\n        i++;\\n      } else {\\n        this.pushOp(ops, \\\"add\\\", b[j]);\\n        j++;\\n      }\\n    }\\n    while (i < m) {\\n      this.pushOp(ops, \\\"remove\\\", a[i++]);\\n    }\\n    while (j < n) {\\n      this.pushOp(ops, \\\"add\\\", b[j++]);\\n    }\\n    return ops;\\n  }\\n\\n  private pushOp(\\n    ops: Array<{ type: \\\"equal\\\" | \\\"add\\\" | \\\"remove\\\"; lines: string[] }>,\\n    type: \\\"equal\\\" | \\\"add\\\" | \\\"remove\\\",\\n    line: string\\n  ) {\\n    const last = ops[ops.length - 1];\\n    if (last && last.type === type) {\\n      last.lines.push(line);\\n    } else {\\n      ops.push({ type, lines: [line] });\\n    }\\n  }\\n\\n  private buildUnifiedDiff(\\n    relPath: string,\\n    a: string[],\\n    b: string[],\\n    maxLines: number,\\n    precomputedOps?: Array<{ type: \\\"equal\\\" | \\\"add\\\" | \\\"remove\\\"; lines: string[] }>\\n  ): string {\\n    const ops = precomputedOps ?? this.diffLines(a, b);\\n    const header = [`--- a/${relPath}`, `+++ b/${relPath}`];\\n    const body: string[] = [];\\n    for (const op of ops) {\\n      for (const line of op.lines) {\\n        if (body.length >= maxLines) break;\\n        if (op.type === \\\"equal\\\") body.push(\\\" \\\" + line);\\n        else if (op.type === \\\"add\\\") body.push(\\\"+\\\" + line);\\n        else body.push(\\\"-\\\" + line);\\n      }\\n      if (body.length >= maxLines) break;\\n    }\\n    return header.concat(body).join(\\\"\\\\n\\\");\\n  }\\n\\n  private applyPatch(args: { patch: string }) {\\n    const patch = (args.patch ?? \\\"\\\").toString();\\n    if (!patch.trim()) throw new Error(\\\"patch is required\\\");\\n\\n    type FilePatch = { relPath: string; lines: string[] };\\n    const sections: FilePatch[] = [];\\n    const lines = patch.replace(/\\\\r\\\\n/g, \\\"\\\\n\\\").split(\\\"\\\\n\\\");\\n\\n    let i = 0;\\n    while (i < lines.length) {\\n      const line = lines[i];\\n      if (line?.startsWith(\\\"--- a/\\\")) {\\n        const next = lines[i + 1] ?? \\\"\\\";\\n        if (!next.startsWith(\\\"+++ b/\\\")) {\\n          throw new Error(\\\"Invalid patch format: expected '+++ b/...' after '--- a/...'\\\");\\n        }\\n        const pathA = line.slice(6).trim(); // after '--- a/'\\n        const pathB = next.slice(6).trim(); // after '+++ b/'\\n        if (!pathA || !pathB) throw new Error(\\\"Invalid patch headers: empty path\\\");\\n        // Use B path as target\\n        const targetRel = pathB;\\n        i += 2;\\n        const body: string[] = [];\\n        while (i < lines.length && !lines[i].startsWith(\\\"--- a/\\\")) {\\n          const bLine = lines[i];\\n          if (bLine.startsWith(\\\" \\\") || bLine.startsWith(\\\"+\\\") || bLine.startsWith(\\\"-\\\")) {\\n            body.push(bLine);\\n          }\\n          i++;\\n        }\\n        sections.push({ relPath: targetRel, lines: body });\\n      } else {\\n        i++;\\n      }\\n    }\\n\\n    if (sections.length === 0) {\\n      throw new Error(\\\"No file sections found in patch\\\");\\n    }\\n\\n    // First pass: validate and compute new contents without writing\\n    const plannedWrites: Array<{\\n      relPath: string;\\n      absPath: string;\\n      existedBefore: boolean;\\n      beforeBytes: number;\\n      afterBytes: number;\\n      newContent: string;\\n    }> = [];\\n\\n    for (const sec of sections) {\\n      const { absPath, relPath } = resolveInRepo(this.opts, sec.relPath);\\n\\n      const exists = fs.existsSync(absPath) && fs.statSync(absPath).isFile();\\n      const beforeContent = exists ? fs.readFileSync(absPath, \\\"utf8\\\") : \\\"\\\";\\n      const beforeLines = beforeContent.split(/\\\\r?\\\\n/);\\n\\n      // Build base and after from patch body\\n      const baseFromPatch: string[] = [];\\n      const afterFromPatch: string[] = [];\\n      for (const l of sec.lines) {\\n        if (l.startsWith(\\\" \\\")) {\\n          const t = l.slice(1);\\n          baseFromPatch.push(t);\\n          afterFromPatch.push(t);\\n        } else if (l.startsWith(\\\"-\\\")) {\\n          baseFromPatch.push(l.slice(1));\\n        } else if (l.startsWith(\\\"+\\\")) {\\n          afterFromPatch.push(l.slice(1));\\n        }\\n      }\\n\\n      if (exists) {\\n        if (!this.readFilesThisRun.has(relPath)) {\\n          throw new Error(`MUST read_file before apply_patch for existing file: ${relPath}`);\\n        }\\n        // Validate base matches current file\\n        if (beforeLines.join(\\\"\\\\n\\\") !== baseFromPatch.join(\\\"\\\\n\\\")) {\\n          throw new Error(\\n            `Patch base does not match current content for ${relPath}. Read the file and regenerate patch.`\\n          );\\n        }\\n      } else {\\n        // For new files, base must be empty\\n        if (baseFromPatch.length > 0 && baseFromPatch.join(\\\"\\\\n\\\").trim() !== \\\"\\\") {\\n          throw new Error(\\n            `Patch for ${relPath} implies non-empty base, but file does not exist. Create file with write_file or provide correct patch.`\\n          );\\n        }\\n      }\\n\\n      const newContent = afterFromPatch.join(\\\"\\\\n\\\");\\n      const afterBytes = Buffer.byteLength(newContent, \\\"utf8\\\");\\n      if (afterBytes > this.opts.maxWriteBytes) {\\n        throw new Error(\\n          `Resulting content too large for apply_patch (${afterBytes} bytes > ${this.opts.maxWriteBytes}): ${relPath}`\\n        );\\n      }\\n\\n      plannedWrites.push({\\n        relPath,\\n        absPath,\\n        existedBefore: exists,\\n        beforeBytes: Buffer.byteLength(beforeContent, \\\"utf8\\\"),\\n        afterBytes,\\n        newContent,\\n      });\\n    }\\n\\n    // Second pass: perform writes\\n    for (const w of plannedWrites) {\\n      ensureParentDirExists(w.absPath);\\n      fs.writeFileSync(w.absPath, w.newContent, \\\"utf8\\\");\\n    }\\n\\n    return {\\n      files: plannedWrites.map((w) => ({\\n        path: w.relPath,\\n        existed_before: w.existedBefore,\\n        before_bytes: w.beforeBytes,\\n        after_bytes: w.afterBytes,\\n        status: w.existedBefore ? (w.beforeBytes === w.afterBytes ? \\\"unchanged\\\" : \\\"modified\\\") : \\\"created\\\",\\n      })),\\n    };\\n  }\\n}\\n\"\n    },\n    \"src/cli.ts\": {\n      \"bytes\": 2425,\n      \"content\": \"import \\\"dotenv/config\\\";\\nimport path from \\\"node:path\\\";\\n\\nimport { runAgent } from \\\"./agent/run.ts\\\";\\n\\nfunction getArgValue(argv: string[], name: string): string | undefined {\\n  const idx = argv.indexOf(name);\\n  return idx === -1 ? undefined : argv[idx + 1];\\n}\\n\\nfunction usage() {\\n  console.log(`\\nUżycie:\\n  npm run dev -- edit \\\"<OPIS>\\\" --repo <ścieżka>\\n\\nOpis:\\n  edit uruchamia agentową pętlę tool-calling.\\n  Agent modyfikuje pliki bezpośrednio (write_file) lub przez patch-based edycję (apply_patch),\\n  loguje przebieg do agent.raw.txt oraz zapisuje raport git diff do agent.diff.txt (jeśli możliwe).\\n\\nWymagania:\\n  Wymaga skonfigurowanego klucza OPENAI_API_KEY (plik .env lub zmienna środowiskowa). Przykład w .env.example.\\n`);\\n}\\n\\nasync function main() {\\n  const cmd = process.argv[2];\\n\\n  if (!cmd) {\\n    usage();\\n    process.exitCode = 1;\\n    return;\\n  }\\n\\n  const normalizedCmd = cmd.toLowerCase();\\n  const isEdit = normalizedCmd === \\\"edit\\\";\\n\\n  if (!isEdit) {\\n    usage();\\n    process.exitCode = 1;\\n    return;\\n  }\\n\\n  // Walidacja argumentu --repo pod kątem placeholderów\\n  const rawRepoArg = getArgValue(process.argv, \\\"--repo\\\");\\n  if (rawRepoArg && /[<>]/.test(rawRepoArg)) {\\n    console.error(\\n      \\\"[agent] ERROR: Wykryto placeholder w argumencie --repo. Podaj prawdziwą ścieżkę do repozytorium.\\\\n\\\",\\n    );\\n    console.error(\\\"Przykład: --repo .    lub    --repo /pełna/ścieżka/do/repo\\\");\\n    process.exitCode = 1;\\n    return;\\n  }\\n\\n  const repoRoot = path.resolve(rawRepoArg ?? process.cwd());\\n\\n  // Task to wszystko pomiędzy komendą a --repo\\n  const repoIdx = process.argv.indexOf(\\\"--repo\\\");\\n  const taskParts = repoIdx === -1 ? process.argv.slice(3) : process.argv.slice(3, repoIdx);\\n  const task = taskParts.join(\\\" \\\").trim();\\n\\n  if (!task) {\\n    console.error(\\\"[agent] ERROR: Brak opisu zadania.\\\");\\n    usage();\\n    process.exitCode = 1;\\n    return;\\n  }\\n\\n  console.log(\\\"[agent] Working (tool-calling loop)...\\\");\\n  await runAgent({ repoRoot, task, model: process.env.OPENAI_MODEL ?? \\\"gpt-5\\\", maxToolCalls: 50 });\\n\\n  console.log(\\\"[agent] Done.\\\");\\n  console.log(`- Log: ${path.join(repoRoot, \\\"agent.raw.txt\\\")}`);\\n  console.log(`- Diff: ${path.join(repoRoot, \\\"agent.diff.txt\\\")} (jeśli git diff działa)`);\\n  console.log(\\\"Przejrzyj zmiany w VS Code → Source Control.\\\");\\n}\\n\\nmain().catch((e: any) => {\\n  console.error(\\\"[agent] ERROR:\\\", e?.stack ?? e?.message ?? String(e));\\n  process.exitCode = 1;\\n});\\n\"\n    },\n    \"src/openai.ts\": {\n      \"bytes\": 385,\n      \"content\": \"import OpenAI from \\\"openai\\\";\\r\\n\\r\\n/**\\r\\n * Minimalny klient OpenAI.\\r\\n * Wymaga zmiennej OPENAI_API_KEY.\\r\\n */\\r\\nconst apiKey = process.env.OPENAI_API_KEY;\\r\\nif (!apiKey || !apiKey.trim()) {\\r\\n  throw new Error(\\r\\n    \\\"[agent] Brak OPENAI_API_KEY. Ustaw zmienną środowiskową lub wpisz klucz w pliku .env (patrz .env.example).\\\"\\r\\n  );\\r\\n}\\r\\n\\r\\nexport const openai = new OpenAI({\\r\\n  apiKey,\\r\\n});\\r\\n\"\n    },\n    \"tests/security.test.ts\": {\n      \"bytes\": 2594,\n      \"content\": \"import path from \\\"node:path\\\";\\nimport fs from \\\"node:fs\\\";\\nimport os from \\\"node:os\\\";\\nimport { test } from \\\"node:test\\\";\\nimport assert from \\\"node:assert/strict\\\";\\nimport { fileURLToPath } from \\\"node:url\\\";\\nimport { resolveInRepo, isDeniedPath, type SandboxOptions } from \\\"../src/agent/security.ts\\\";\\n\\nfunction defaultOpts(repoRoot: string): SandboxOptions {\\n  return {\\n    repoRoot,\\n    denyDirs: [\\\".git\\\", \\\"node_modules\\\", \\\"dist\\\"],\\n    denyFilesExact: [\\\".env\\\"],\\n    denyExtensions: [\\\".pem\\\", \\\".key\\\"],\\n    maxReadBytes: 400_000,\\n    maxWriteBytes: 800_000,\\n  };\\n}\\n\\nfunction repoRootFromTests(): string {\\n  // tests/ -> repo root\\n  const __filename = fileURLToPath(import.meta.url);\\n  const __dirname = path.dirname(__filename);\\n  return path.resolve(__dirname, \\\"..\\\");\\n}\\n\\ntest(\\\"resolveInRepo: poprawna ścieżka src/cli.ts\\\", () => {\\n  const repoRoot = repoRootFromTests();\\n  const opts = defaultOpts(repoRoot);\\n  const res = resolveInRepo(opts, \\\"src/cli.ts\\\");\\n  assert.equal(res.relPath, \\\"src/cli.ts\\\");\\n  assert.ok(fs.existsSync(res.absPath), \\\"absPath powinien istnieć\\\");\\n  const st = fs.statSync(res.absPath);\\n  assert.ok(st.isFile(), \\\"powinien być plikiem\\\");\\n});\\n\\ntest(\\\"resolveInRepo: blokada ../x (path traversal)\\\", () => {\\n  const repoRoot = repoRootFromTests();\\n  const opts = defaultOpts(repoRoot);\\n  assert.throws(() => resolveInRepo(opts, \\\"../x\\\"), /Path traversal blocked/);\\n});\\n\\ntest(\\\"resolveInRepo: blokada ucieczki przez symlink poza repo\\\", () => {\\n  const base = fs.mkdtempSync(path.join(os.tmpdir(), \\\"repo-sec-\\\"));\\n  const repoDir = path.join(base, \\\"repo\\\");\\n  fs.mkdirSync(repoDir);\\n\\n  // plik poza repo\\n  const outsideFile = path.join(base, \\\"outside.txt\\\");\\n  fs.writeFileSync(outsideFile, \\\"outside\\\");\\n\\n  // symlink w repo wskazujący poza repo\\n  const linkPath = path.join(repoDir, \\\"link-out.txt\\\");\\n  try {\\n    fs.symlinkSync(outsideFile, linkPath);\\n  } catch (e) {\\n    // Na niektórych systemach tworzenie symlinków może wymagać uprawnień.\\n    // Jeśli nie można utworzyć symlinka, pomiń test.\\n    console.warn(\\\"[test] pominięto tworzenie symlinków:\\\", (e as any)?.message ?? e);\\n    return;\\n  }\\n\\n  const opts = defaultOpts(repoDir);\\n  assert.throws(() => resolveInRepo(opts, \\\"link-out.txt\\\"), /Path traversal blocked/);\\n});\\n\\ntest(\\\"denylist: case-insensitive .Git\\\", () => {\\n  const repoRoot = repoRootFromTests();\\n  const opts = defaultOpts(repoRoot);\\n\\n  // isDeniedPath bezpośrednio\\n  assert.equal(isDeniedPath(opts, \\\".Git/config\\\"), true);\\n\\n  // resolveInRepo powinno zablokować dostęp\\n  assert.throws(() => resolveInRepo(opts, \\\".Git/config\\\"), /Access denied by policy/);\\n});\\n\"\n    },\n    \"tsconfig.json\": {\n      \"bytes\": 286,\n      \"content\": \"{\\r\\n  \\\"compilerOptions\\\": {\\r\\n    \\\"target\\\": \\\"ES2022\\\",\\r\\n    \\\"module\\\": \\\"ES2022\\\",\\r\\n    \\\"moduleResolution\\\": \\\"Bundler\\\",\\r\\n    \\\"allowImportingTsExtensions\\\": true,\\r\\n    \\\"strict\\\": true,\\r\\n    \\\"skipLibCheck\\\": true,\\r\\n    \\\"noEmit\\\": true,\\r\\n    \\\"types\\\": [\\\"node\\\"]\\r\\n  },\\r\\n  \\\"include\\\": [\\\"src\\\", \\\"tests\\\"]\\r\\n}\\r\\n\"\n    }\n  }\n}"
    },
    ".gitignore": {
      "bytes": 538,
      "content": "# =====================\r\n# Environment variables\r\n# =====================\r\n\r\n.env\r\n.env.*\r\n!.env.example\r\n\r\n# =====================\r\n# Node / build artifacts\r\n# =====================\r\n\r\nnode_modules/\r\ndist/\r\nbuild/\r\n\r\n# =====================\r\n# Logs & agent artifacts\r\n# =====================\r\n\r\nagent.raw.txt\r\nagent.diff.txt\r\n.agent_baseline.json\r\n\r\n# =====================\r\n# OS / editor junk\r\n# =====================\r\n\r\n.DS_Store\r\nThumbs.db\r\n\r\n# =====================\r\n# TypeScript / tooling\r\n# =====================\r\n\r\n*.tsbuildinfo\r\n"
    },
    "README.md": {
      "bytes": 6444,
      "content": "# coding-agent\n\nMinimalny agent do edycji plików w repozytorium przy użyciu tool-calling (OpenAI). Działa jako CLI, które:\n- uruchamia pętlę agenta z zestawem narzędzi do pracy na plikach (listowanie, odczyt, zapis, usuwanie, wyszukiwanie),\n- loguje pełny przebieg do pliku agent.raw.txt,\n- próbuje zapisać raport zmian git diff do agent.diff.txt (jeśli repo jest repozytorium git).\n\n## Wymagania\n- Node.js >= 18\n- Klucz API do OpenAI (zmienna środowiskowa OPENAI_API_KEY)\n\n## Instalacja\n1) Zainstaluj zależności:\n\n```\nnpm install\n```\n\n2) Skonfiguruj zmienne środowiskowe. Najprościej skopiować plik przykładowy:\n\n```\ncp .env.example .env\n```\n\nUzupełnij w .env wartość OPENAI_API_KEY. Opcjonalnie możesz ustawić OPENAI_MODEL (domyślnie: \"gpt-5\").\n\n## Użycie CLI\nSkładnia (zdefiniowana w src/cli.ts):\n\n```\nnpm run dev -- edit  \"<OPIS>\" --repo <ścieżka>\n```\n\n- OPIS: tekstowe zadanie dla agenta (np. „Dodaj plik README.md w root repo”).\n- --repo: ścieżka do katalogu repo, w którym agent ma pracować. Jeśli nie podasz, użyty zostanie bieżący katalog.\n\nPrzykład:\n\n```\nnpm run dev -- edit \"Dodaj plik CONTRIBUTING.md z podstawowymi zasadami\" --repo .\n```\n\nPo zakończeniu działania:\n- agent.raw.txt zawiera surowy log komunikacji i wywołań narzędzi,\n- agent.diff.txt (jeśli git diff działa) zawiera różnice względem HEAD.\n\n## Funkcje i narzędzia agenta\nAgent działa na podstawie tool-calling i udostępnia następujące narzędzia (patrz src/agent/tools.ts):\n- list_files: listowanie plików w repo (z pominięciem ścieżek z denylisty),\n- read_file: odczyt pliku tekstowego,\n- write_file: zapis/utworzenie pliku (wymaga podania pełnej nowej treści),\n- delete_file: usunięcie pliku,\n- search_in_files: proste wyszukiwanie podciągów w plikach,\n- get_baseline_info: metadane snapshotu stanu początkowego repo (tworzony automatycznie na starcie agenta),\n- list_changed_files: lista plików added/modified/deleted względem snapshotu,\n- read_file_original: odczyt oryginalnej wersji pliku ze snapshotu (dla porównań punktowych),\n- diff_file_against_original: prosty unified diff aktualnej zawartości względem snapshotu,\n- apply_patch: zastosowanie prostego unified patcha (bez nagłówków hunk) do jednego lub wielu plików.\n\nSnapshot zapisywany jest w pliku .agent_baseline.json w katalogu repo i obejmuje zawartości plików nie większych niż maxReadBytes (domyślnie 400 kB). Dla większych plików porównanie odbywa się po rozmiarze.\n\n## Sandbox i bezpieczeństwo\nKonfiguracja sandboxa znajduje się w src/agent/security.ts i jest stosowana m.in. przez RepoTools:\n- Blokada path traversal: operacje są ograniczone do katalogu repo.\n- Denylista katalogów: .git, node_modules, dist.\n- Denylista plików: .env.\n- Denylista rozszerzeń: .pem, .key.\n- Limity rozmiaru: odczyt do 400 000 bajtów, zapis do 800 000 bajtów.\n\nDodatkowo, po zakończeniu pętli agent próbuje wykonać git diff (jedyna komenda systemowa używana lokalnie) wyłącznie do wygenerowania agent.diff.txt.\n\n## Struktura projektu\n- src/cli.ts – wejściowy CLI, parsowanie argumentów, uruchomienie agenta.\n- src/openai.ts – inicjalizacja minimalnego klienta OpenAI (wymaga OPENAI_API_KEY).\n- src/agent/run.ts – pętla agenta, integracja z OpenAI Responses API, logowanie, generowanie diffu.\n- src/agent/tools.ts – implementacja narzędzi (listowanie/odczyt/zapis/usuwanie/wyszukiwanie plików i narzędzia do review).\n- src/agent/security.ts – izolacja repo, denylista ścieżek, limity, bezpieczne rozwiązywanie ścieżek.\n- src/agent/log.ts – prosty logger (agent.raw.txt, agent.diff.txt).\n- resources/prompts/codeAgentPromt.txt – prompt systemowy używany w roli system przy pierwszym wywołaniu modelu.\n- .env.example – przykład konfiguracji środowiska (ustaw OPENAI_API_KEY przed użyciem).\n- package.json – skrypty npm i zależności.\n- tsconfig.json – konfiguracja TypeScript.\n\n## Skrypty\nZdefiniowane w package.json:\n- dev: uruchamia CLI w trybie developerskim (tsx src/cli.ts),\n- test: uruchamia testy (node --import tsx --test).\n\n## Uruchamianie testów\n```\nnpm test\n```\n\n## Jak robić review zmian (code review z użyciem narzędzi)\nAgent automatycznie tworzy snapshot bazowy repozytorium na starcie (plik .agent_baseline.json). Na jego podstawie dostępne są narzędzia do przeglądu zmian:\n- get_baseline_info – sprawdzenie informacji o snapshotcie,\n- list_changed_files – lista plików added/modified/deleted względem snapshotu,\n- diff_file_against_original – unified diff oraz podsumowanie (ile linii dodano/usunięto),\n- read_file_original – odczyt oryginalnej wersji pliku ze snapshotu (dla porównań punktowych).\n\nPrzykładowa procedura przeglądu przez agenta:\n1) Uruchom agenta poleceniem \"edit\" i poproś o przygotowanie raportu z review. Np.:\n\n```\nnpm run dev -- edit \"Zrób code review zmian w repo. Użyj list_changed_files i diff_file_against_original do wygenerowania przeglądu; zapisz czytelne podsumowanie z rekomendacjami do pliku REVIEW.md.\" --repo .\n```\n\n2) Agent wykorzysta narzędzia review i zapisze raport (np. REVIEW.md). Dodatkowo w pliku agent.diff.txt znajdziesz wynik git diff względem HEAD.\n\nWskazówki do promptu (opcjonalnie):\n- Ogranicz zakres, np. do ścieżki: „Przejrzyj tylko src/” – agent może użyć list_changed_files z prefix: \"src/\".\n- Wymuś czytelny format raportu (sekcje: lista zmian, komentarze, ryzyka, rekomendacje).\n- Poproś o propozycje konkretnych poprawek wraz ze wskazaniem plików/fragmentów.\n- Ustal limity, np. maks. 1000 linii diffu na plik (parametr max_lines w diff_file_against_original).\n\nOgraniczenia i uwagi dla review:\n- Pliki większe niż maxReadBytes (domyślnie 400 kB) w snapshotcie nie mają zapisanej treści – porównanie odbywa się po rozmiarze, a diff treści nie będzie dostępny.\n- Denylista ścieżek (np. .git/, node_modules/, dist/, .env) jest zawsze respektowana – te zasoby nie są analizowane.\n- Jeśli repozytorium nie jest repozytorium git lub git diff zwróci błąd, agent.diff.txt nie zostanie wygenerowany.\n\n## Uwagi\n- Domyślny model to wartość z OPENAI_MODEL lub \"gpt-5\". Upewnij się, że wskazany model wspiera tool-calling i Responses API.\n- Agent minimalizuje zakres zmian i wymaga wywołania read_file przed modyfikacją jakiegokolwiek pliku.\n- Limit wywołań narzędzi w jednej sesji: domyślnie 50 (możesz zmienić w kodzie wywołania runAgent).\n"
    },
    "agent.diff.txt": {
      "bytes": 1484,
      "content": "diff --git a/src/agent/tools.ts b/src/agent/tools.ts\nindex 6176af1..ccf9e22 100644\n--- a/src/agent/tools.ts\n+++ b/src/agent/tools.ts\n@@ -307,24 +307,35 @@ export class RepoTools {\n     for (const rel of all) {\n       if (matches.length >= limitMatches) break;\n \n-      const abs = path.resolve(this.opts.repoRoot, rel.replaceAll(\"/\", path.sep));\n+      // Resolve safely within the repo (guards against symlink escape)\n+      let absPath: string;\n+      let relPath: string;\n+      try {\n+        const r = resolveInRepo(this.opts, rel);\n+        absPath = r.absPath;\n+        relPath = r.relPath;\n+      } catch {\n+        // Skip files that cannot be safely resolved\n+        continue;\n+      }\n+\n       let st: fs.Stats;\n       try {\n-        st = fs.statSync(abs);\n+        st = fs.statSync(absPath);\n       } catch {\n         continue;\n       }\n       if (!st.isFile()) continue;\n       if (st.size > this.opts.maxReadBytes) continue;\n \n-      const content = fs.readFileSync(abs, \"utf8\");\n+      const content = fs.readFileSync(absPath, \"utf8\");\n       if (!content.includes(query)) continue;\n \n       const lines = content.split(/\\r?\\n/);\n       for (let i = 0; i < lines.length; i++) {\n         if (matches.length >= limitMatches) break;\n         if (lines[i].includes(query)) {\n-          matches.push({ path: rel, line: i + 1, text: lines[i].slice(0, 400) });\n+          matches.push({ path: relPath, line: i + 1, text: lines[i].slice(0, 400) });\n         }\n       }\n     }\n"
    },
    "agent.raw.txt": {
      "bytes": 544672,
      "content": null
    },
    "package-lock.json": {
      "bytes": 34254,
      "content": "{\r\n  \"name\": \"coding-agent\",\r\n  \"version\": \"1.0.0\",\r\n  \"lockfileVersion\": 3,\r\n  \"requires\": true,\r\n  \"packages\": {\r\n    \"\": {\r\n      \"name\": \"coding-agent\",\r\n      \"dependencies\": {\r\n        \"dotenv\": \"^16.4.5\",\r\n        \"openai\": \"^4.0.0\"\r\n      },\r\n      \"devDependencies\": {\r\n        \"tsx\": \"^4.19.2\",\r\n        \"typescript\": \"^5.5.4\"\r\n      },\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/aix-ppc64\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/aix-ppc64/-/aix-ppc64-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-GZMB+a0mOMZs4MpDbj8RJp4cw+w1WV5NYD6xzgvzUJ5Ek2jerwfO2eADyI6ExDSUED+1X8aMbegahsJi+8mgpw==\",\r\n      \"cpu\": [\r\n        \"ppc64\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"aix\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/android-arm\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/android-arm/-/android-arm-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-DVNI8jlPa7Ujbr1yjU2PfUSRtAUZPG9I1RwW4F4xFB1Imiu2on0ADiI/c3td+KmDtVKNbi+nffGDQMfcIMkwIA==\",\r\n      \"cpu\": [\r\n        \"arm\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"android\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/android-arm64\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/android-arm64/-/android-arm64-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-pvz8ZZ7ot/RBphf8fv60ljmaoydPU12VuXHImtAs0XhLLw+EXBi2BLe3OYSBslR4rryHvweW5gmkKFwTiFy6KA==\",\r\n      \"cpu\": [\r\n        \"arm64\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"android\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/android-x64\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/android-x64/-/android-x64-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-z8Ank4Byh4TJJOh4wpz8g2vDy75zFL0TlZlkUkEwYXuPSgX8yzep596n6mT7905kA9uHZsf/o2OJZubl2l3M7A==\",\r\n      \"cpu\": [\r\n        \"x64\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"android\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/darwin-arm64\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/darwin-arm64/-/darwin-arm64-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-davCD2Zc80nzDVRwXTcQP/28fiJbcOwvdolL0sOiOsbwBa72kegmVU0Wrh1MYrbuCL98Omp5dVhQFWRKR2ZAlg==\",\r\n      \"cpu\": [\r\n        \"arm64\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"darwin\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/darwin-x64\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/darwin-x64/-/darwin-x64-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-ZxtijOmlQCBWGwbVmwOF/UCzuGIbUkqB1faQRf5akQmxRJ1ujusWsb3CVfk/9iZKr2L5SMU5wPBi1UWbvL+VQA==\",\r\n      \"cpu\": [\r\n        \"x64\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"darwin\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/freebsd-arm64\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/freebsd-arm64/-/freebsd-arm64-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-lS/9CN+rgqQ9czogxlMcBMGd+l8Q3Nj1MFQwBZJyoEKI50XGxwuzznYdwcav6lpOGv5BqaZXqvBSiB/kJ5op+g==\",\r\n      \"cpu\": [\r\n        \"arm64\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"freebsd\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/freebsd-x64\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/freebsd-x64/-/freebsd-x64-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-tAfqtNYb4YgPnJlEFu4c212HYjQWSO/w/h/lQaBK7RbwGIkBOuNKQI9tqWzx7Wtp7bTPaGC6MJvWI608P3wXYA==\",\r\n      \"cpu\": [\r\n        \"x64\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"freebsd\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/linux-arm\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/linux-arm/-/linux-arm-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-vWfq4GaIMP9AIe4yj1ZUW18RDhx6EPQKjwe7n8BbIecFtCQG4CfHGaHuh7fdfq+y3LIA2vGS/o9ZBGVxIDi9hw==\",\r\n      \"cpu\": [\r\n        \"arm\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"linux\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/linux-arm64\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/linux-arm64/-/linux-arm64-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-hYxN8pr66NsCCiRFkHUAsxylNOcAQaxSSkHMMjcpx0si13t1LHFphxJZUiGwojB1a/Hd5OiPIqDdXONia6bhTw==\",\r\n      \"cpu\": [\r\n        \"arm64\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"linux\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/linux-ia32\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/linux-ia32/-/linux-ia32-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-MJt5BRRSScPDwG2hLelYhAAKh9imjHK5+NE/tvnRLbIqUWa+0E9N4WNMjmp/kXXPHZGqPLxggwVhz7QP8CTR8w==\",\r\n      \"cpu\": [\r\n        \"ia32\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"linux\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/linux-loong64\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/linux-loong64/-/linux-loong64-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-lugyF1atnAT463aO6KPshVCJK5NgRnU4yb3FUumyVz+cGvZbontBgzeGFO1nF+dPueHD367a2ZXe1NtUkAjOtg==\",\r\n      \"cpu\": [\r\n        \"loong64\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"linux\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/linux-mips64el\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/linux-mips64el/-/linux-mips64el-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-nlP2I6ArEBewvJ2gjrrkESEZkB5mIoaTswuqNFRv/WYd+ATtUpe9Y09RnJvgvdag7he0OWgEZWhviS1OTOKixw==\",\r\n      \"cpu\": [\r\n        \"mips64el\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"linux\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/linux-ppc64\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/linux-ppc64/-/linux-ppc64-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-C92gnpey7tUQONqg1n6dKVbx3vphKtTHJaNG2Ok9lGwbZil6DrfyecMsp9CrmXGQJmZ7iiVXvvZH6Ml5hL6XdQ==\",\r\n      \"cpu\": [\r\n        \"ppc64\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"linux\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/linux-riscv64\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/linux-riscv64/-/linux-riscv64-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-B5BOmojNtUyN8AXlK0QJyvjEZkWwy/FKvakkTDCziX95AowLZKR6aCDhG7LeF7uMCXEJqwa8Bejz5LTPYm8AvA==\",\r\n      \"cpu\": [\r\n        \"riscv64\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"linux\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/linux-s390x\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/linux-s390x/-/linux-s390x-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-p4bm9+wsPwup5Z8f4EpfN63qNagQ47Ua2znaqGH6bqLlmJ4bx97Y9JdqxgGZ6Y8xVTixUnEkoKSHcpRlDnNr5w==\",\r\n      \"cpu\": [\r\n        \"s390x\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"linux\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/linux-x64\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/linux-x64/-/linux-x64-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-uwp2Tip5aPmH+NRUwTcfLb+W32WXjpFejTIOWZFw/v7/KnpCDKG66u4DLcurQpiYTiYwQ9B7KOeMJvLCu/OvbA==\",\r\n      \"cpu\": [\r\n        \"x64\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"linux\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/netbsd-arm64\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/netbsd-arm64/-/netbsd-arm64-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-Kj6DiBlwXrPsCRDeRvGAUb/LNrBASrfqAIok+xB0LxK8CHqxZ037viF13ugfsIpePH93mX7xfJp97cyDuTZ3cw==\",\r\n      \"cpu\": [\r\n        \"arm64\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"netbsd\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/netbsd-x64\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/netbsd-x64/-/netbsd-x64-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-HwGDZ0VLVBY3Y+Nw0JexZy9o/nUAWq9MlV7cahpaXKW6TOzfVno3y3/M8Ga8u8Yr7GldLOov27xiCnqRZf0tCA==\",\r\n      \"cpu\": [\r\n        \"x64\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"netbsd\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/openbsd-arm64\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/openbsd-arm64/-/openbsd-arm64-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-DNIHH2BPQ5551A7oSHD0CKbwIA/Ox7+78/AWkbS5QoRzaqlev2uFayfSxq68EkonB+IKjiuxBFoV8ESJy8bOHA==\",\r\n      \"cpu\": [\r\n        \"arm64\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"openbsd\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/openbsd-x64\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/openbsd-x64/-/openbsd-x64-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-/it7w9Nb7+0KFIzjalNJVR5bOzA9Vay+yIPLVHfIQYG/j+j9VTH84aNB8ExGKPU4AzfaEvN9/V4HV+F+vo8OEg==\",\r\n      \"cpu\": [\r\n        \"x64\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"openbsd\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/openharmony-arm64\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/openharmony-arm64/-/openharmony-arm64-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-LRBbCmiU51IXfeXk59csuX/aSaToeG7w48nMwA6049Y4J4+VbWALAuXcs+qcD04rHDuSCSRKdmY63sruDS5qag==\",\r\n      \"cpu\": [\r\n        \"arm64\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"openharmony\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/sunos-x64\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/sunos-x64/-/sunos-x64-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-kMtx1yqJHTmqaqHPAzKCAkDaKsffmXkPHThSfRwZGyuqyIeBvf08KSsYXl+abf5HDAPMJIPnbBfXvP2ZC2TfHg==\",\r\n      \"cpu\": [\r\n        \"x64\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"sunos\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/win32-arm64\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/win32-arm64/-/win32-arm64-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-Yaf78O/B3Kkh+nKABUF++bvJv5Ijoy9AN1ww904rOXZFLWVc5OLOfL56W+C8F9xn5JQZa3UX6m+IktJnIb1Jjg==\",\r\n      \"cpu\": [\r\n        \"arm64\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"win32\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/win32-ia32\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/win32-ia32/-/win32-ia32-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-Iuws0kxo4yusk7sw70Xa2E2imZU5HoixzxfGCdxwBdhiDgt9vX9VUCBhqcwY7/uh//78A1hMkkROMJq9l27oLQ==\",\r\n      \"cpu\": [\r\n        \"ia32\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"win32\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@esbuild/win32-x64\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/@esbuild/win32-x64/-/win32-x64-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-sRdU18mcKf7F+YgheI/zGf5alZatMUTKj/jNS6l744f9u3WFu4v7twcUI9vu4mknF4Y9aDlblIie0IM+5xxaqQ==\",\r\n      \"cpu\": [\r\n        \"x64\"\r\n      ],\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"win32\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      }\r\n    },\r\n    \"node_modules/@types/node\": {\r\n      \"version\": \"18.19.130\",\r\n      \"resolved\": \"https://registry.npmjs.org/@types/node/-/node-18.19.130.tgz\",\r\n      \"integrity\": \"sha512-GRaXQx6jGfL8sKfaIDD6OupbIHBr9jv7Jnaml9tB7l4v068PAOXqfcujMMo5PhbIs6ggR1XODELqahT2R8v0fg==\",\r\n      \"license\": \"MIT\",\r\n      \"dependencies\": {\r\n        \"undici-types\": \"~5.26.4\"\r\n      }\r\n    },\r\n    \"node_modules/@types/node-fetch\": {\r\n      \"version\": \"2.6.13\",\r\n      \"resolved\": \"https://registry.npmjs.org/@types/node-fetch/-/node-fetch-2.6.13.tgz\",\r\n      \"integrity\": \"sha512-QGpRVpzSaUs30JBSGPjOg4Uveu384erbHBoT1zeONvyCfwQxIkUshLAOqN/k9EjGviPRmWTTe6aH2qySWKTVSw==\",\r\n      \"license\": \"MIT\",\r\n      \"dependencies\": {\r\n        \"@types/node\": \"*\",\r\n        \"form-data\": \"^4.0.4\"\r\n      }\r\n    },\r\n    \"node_modules/abort-controller\": {\r\n      \"version\": \"3.0.0\",\r\n      \"resolved\": \"https://registry.npmjs.org/abort-controller/-/abort-controller-3.0.0.tgz\",\r\n      \"integrity\": \"sha512-h8lQ8tacZYnR3vNQTgibj+tODHI5/+l06Au2Pcriv/Gmet0eaj4TwWH41sO9wnHDiQsEj19q0drzdWdeAHtweg==\",\r\n      \"license\": \"MIT\",\r\n      \"dependencies\": {\r\n        \"event-target-shim\": \"^5.0.0\"\r\n      },\r\n      \"engines\": {\r\n        \"node\": \">=6.5\"\r\n      }\r\n    },\r\n    \"node_modules/agentkeepalive\": {\r\n      \"version\": \"4.6.0\",\r\n      \"resolved\": \"https://registry.npmjs.org/agentkeepalive/-/agentkeepalive-4.6.0.tgz\",\r\n      \"integrity\": \"sha512-kja8j7PjmncONqaTsB8fQ+wE2mSU2DJ9D4XKoJ5PFWIdRMa6SLSN1ff4mOr4jCbfRSsxR4keIiySJU0N9T5hIQ==\",\r\n      \"license\": \"MIT\",\r\n      \"dependencies\": {\r\n        \"humanize-ms\": \"^1.2.1\"\r\n      },\r\n      \"engines\": {\r\n        \"node\": \">= 8.0.0\"\r\n      }\r\n    },\r\n    \"node_modules/asynckit\": {\r\n      \"version\": \"0.4.0\",\r\n      \"resolved\": \"https://registry.npmjs.org/asynckit/-/asynckit-0.4.0.tgz\",\r\n      \"integrity\": \"sha512-Oei9OH4tRh0YqU3GxhX79dM/mwVgvbZJaSNaRk+bshkj0S5cfHcgYakreBjrHwatXKbz+IoIdYLxrKim2MjW0Q==\",\r\n      \"license\": \"MIT\"\r\n    },\r\n    \"node_modules/call-bind-apply-helpers\": {\r\n      \"version\": \"1.0.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/call-bind-apply-helpers/-/call-bind-apply-helpers-1.0.2.tgz\",\r\n      \"integrity\": \"sha512-Sp1ablJ0ivDkSzjcaJdxEunN5/XvksFJ2sMBFfq6x0ryhQV/2b/KwFe21cMpmHtPOSij8K99/wSfoEuTObmuMQ==\",\r\n      \"license\": \"MIT\",\r\n      \"dependencies\": {\r\n        \"es-errors\": \"^1.3.0\",\r\n        \"function-bind\": \"^1.1.2\"\r\n      },\r\n      \"engines\": {\r\n        \"node\": \">= 0.4\"\r\n      }\r\n    },\r\n    \"node_modules/combined-stream\": {\r\n      \"version\": \"1.0.8\",\r\n      \"resolved\": \"https://registry.npmjs.org/combined-stream/-/combined-stream-1.0.8.tgz\",\r\n      \"integrity\": \"sha512-FQN4MRfuJeHf7cBbBMJFXhKSDq+2kAArBlmRBvcvFE5BB1HZKXtSFASDhdlz9zOYwxh8lDdnvmMOe/+5cdoEdg==\",\r\n      \"license\": \"MIT\",\r\n      \"dependencies\": {\r\n        \"delayed-stream\": \"~1.0.0\"\r\n      },\r\n      \"engines\": {\r\n        \"node\": \">= 0.8\"\r\n      }\r\n    },\r\n    \"node_modules/delayed-stream\": {\r\n      \"version\": \"1.0.0\",\r\n      \"resolved\": \"https://registry.npmjs.org/delayed-stream/-/delayed-stream-1.0.0.tgz\",\r\n      \"integrity\": \"sha512-ZySD7Nf91aLB0RxL4KGrKHBXl7Eds1DAmEdcoVawXnLD7SDhpNgtuII2aAkg7a7QS41jxPSZ17p4VdGnMHk3MQ==\",\r\n      \"license\": \"MIT\",\r\n      \"engines\": {\r\n        \"node\": \">=0.4.0\"\r\n      }\r\n    },\r\n    \"node_modules/dotenv\": {\r\n      \"version\": \"16.6.1\",\r\n      \"resolved\": \"https://registry.npmjs.org/dotenv/-/dotenv-16.6.1.tgz\",\r\n      \"integrity\": \"sha512-uBq4egWHTcTt33a72vpSG0z3HnPuIl6NqYcTrKEg2azoEyl2hpW0zqlxysq2pK9HlDIHyHyakeYaYnSAwd8bow==\",\r\n      \"license\": \"BSD-2-Clause\",\r\n      \"engines\": {\r\n        \"node\": \">=12\"\r\n      },\r\n      \"funding\": {\r\n        \"url\": \"https://dotenvx.com\"\r\n      }\r\n    },\r\n    \"node_modules/dunder-proto\": {\r\n      \"version\": \"1.0.1\",\r\n      \"resolved\": \"https://registry.npmjs.org/dunder-proto/-/dunder-proto-1.0.1.tgz\",\r\n      \"integrity\": \"sha512-KIN/nDJBQRcXw0MLVhZE9iQHmG68qAVIBg9CqmUYjmQIhgij9U5MFvrqkUL5FbtyyzZuOeOt0zdeRe4UY7ct+A==\",\r\n      \"license\": \"MIT\",\r\n      \"dependencies\": {\r\n        \"call-bind-apply-helpers\": \"^1.0.1\",\r\n        \"es-errors\": \"^1.3.0\",\r\n        \"gopd\": \"^1.2.0\"\r\n      },\r\n      \"engines\": {\r\n        \"node\": \">= 0.4\"\r\n      }\r\n    },\r\n    \"node_modules/es-define-property\": {\r\n      \"version\": \"1.0.1\",\r\n      \"resolved\": \"https://registry.npmjs.org/es-define-property/-/es-define-property-1.0.1.tgz\",\r\n      \"integrity\": \"sha512-e3nRfgfUZ4rNGL232gUgX06QNyyez04KdjFrF+LTRoOXmrOgFKDg4BCdsjW8EnT69eqdYGmRpJwiPVYNrCaW3g==\",\r\n      \"license\": \"MIT\",\r\n      \"engines\": {\r\n        \"node\": \">= 0.4\"\r\n      }\r\n    },\r\n    \"node_modules/es-errors\": {\r\n      \"version\": \"1.3.0\",\r\n      \"resolved\": \"https://registry.npmjs.org/es-errors/-/es-errors-1.3.0.tgz\",\r\n      \"integrity\": \"sha512-Zf5H2Kxt2xjTvbJvP2ZWLEICxA6j+hAmMzIlypy4xcBg1vKVnx89Wy0GbS+kf5cwCVFFzdCFh2XSCFNULS6csw==\",\r\n      \"license\": \"MIT\",\r\n      \"engines\": {\r\n        \"node\": \">= 0.4\"\r\n      }\r\n    },\r\n    \"node_modules/es-object-atoms\": {\r\n      \"version\": \"1.1.1\",\r\n      \"resolved\": \"https://registry.npmjs.org/es-object-atoms/-/es-object-atoms-1.1.1.tgz\",\r\n      \"integrity\": \"sha512-FGgH2h8zKNim9ljj7dankFPcICIK9Cp5bm+c2gQSYePhpaG5+esrLODihIorn+Pe6FGJzWhXQotPv73jTaldXA==\",\r\n      \"license\": \"MIT\",\r\n      \"dependencies\": {\r\n        \"es-errors\": \"^1.3.0\"\r\n      },\r\n      \"engines\": {\r\n        \"node\": \">= 0.4\"\r\n      }\r\n    },\r\n    \"node_modules/es-set-tostringtag\": {\r\n      \"version\": \"2.1.0\",\r\n      \"resolved\": \"https://registry.npmjs.org/es-set-tostringtag/-/es-set-tostringtag-2.1.0.tgz\",\r\n      \"integrity\": \"sha512-j6vWzfrGVfyXxge+O0x5sh6cvxAog0a/4Rdd2K36zCMV5eJ+/+tOAngRO8cODMNWbVRdVlmGZQL2YS3yR8bIUA==\",\r\n      \"license\": \"MIT\",\r\n      \"dependencies\": {\r\n        \"es-errors\": \"^1.3.0\",\r\n        \"get-intrinsic\": \"^1.2.6\",\r\n        \"has-tostringtag\": \"^1.0.2\",\r\n        \"hasown\": \"^2.0.2\"\r\n      },\r\n      \"engines\": {\r\n        \"node\": \">= 0.4\"\r\n      }\r\n    },\r\n    \"node_modules/esbuild\": {\r\n      \"version\": \"0.27.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/esbuild/-/esbuild-0.27.2.tgz\",\r\n      \"integrity\": \"sha512-HyNQImnsOC7X9PMNaCIeAm4ISCQXs5a5YasTXVliKv4uuBo1dKrG0A+uQS8M5eXjVMnLg3WgXaKvprHlFJQffw==\",\r\n      \"dev\": true,\r\n      \"hasInstallScript\": true,\r\n      \"license\": \"MIT\",\r\n      \"bin\": {\r\n        \"esbuild\": \"bin/esbuild\"\r\n      },\r\n      \"engines\": {\r\n        \"node\": \">=18\"\r\n      },\r\n      \"optionalDependencies\": {\r\n        \"@esbuild/aix-ppc64\": \"0.27.2\",\r\n        \"@esbuild/android-arm\": \"0.27.2\",\r\n        \"@esbuild/android-arm64\": \"0.27.2\",\r\n        \"@esbuild/android-x64\": \"0.27.2\",\r\n        \"@esbuild/darwin-arm64\": \"0.27.2\",\r\n        \"@esbuild/darwin-x64\": \"0.27.2\",\r\n        \"@esbuild/freebsd-arm64\": \"0.27.2\",\r\n        \"@esbuild/freebsd-x64\": \"0.27.2\",\r\n        \"@esbuild/linux-arm\": \"0.27.2\",\r\n        \"@esbuild/linux-arm64\": \"0.27.2\",\r\n        \"@esbuild/linux-ia32\": \"0.27.2\",\r\n        \"@esbuild/linux-loong64\": \"0.27.2\",\r\n        \"@esbuild/linux-mips64el\": \"0.27.2\",\r\n        \"@esbuild/linux-ppc64\": \"0.27.2\",\r\n        \"@esbuild/linux-riscv64\": \"0.27.2\",\r\n        \"@esbuild/linux-s390x\": \"0.27.2\",\r\n        \"@esbuild/linux-x64\": \"0.27.2\",\r\n        \"@esbuild/netbsd-arm64\": \"0.27.2\",\r\n        \"@esbuild/netbsd-x64\": \"0.27.2\",\r\n        \"@esbuild/openbsd-arm64\": \"0.27.2\",\r\n        \"@esbuild/openbsd-x64\": \"0.27.2\",\r\n        \"@esbuild/openharmony-arm64\": \"0.27.2\",\r\n        \"@esbuild/sunos-x64\": \"0.27.2\",\r\n        \"@esbuild/win32-arm64\": \"0.27.2\",\r\n        \"@esbuild/win32-ia32\": \"0.27.2\",\r\n        \"@esbuild/win32-x64\": \"0.27.2\"\r\n      }\r\n    },\r\n    \"node_modules/event-target-shim\": {\r\n      \"version\": \"5.0.1\",\r\n      \"resolved\": \"https://registry.npmjs.org/event-target-shim/-/event-target-shim-5.0.1.tgz\",\r\n      \"integrity\": \"sha512-i/2XbnSz/uxRCU6+NdVJgKWDTM427+MqYbkQzD321DuCQJUqOuJKIA0IM2+W2xtYHdKOmZ4dR6fExsd4SXL+WQ==\",\r\n      \"license\": \"MIT\",\r\n      \"engines\": {\r\n        \"node\": \">=6\"\r\n      }\r\n    },\r\n    \"node_modules/form-data\": {\r\n      \"version\": \"4.0.5\",\r\n      \"resolved\": \"https://registry.npmjs.org/form-data/-/form-data-4.0.5.tgz\",\r\n      \"integrity\": \"sha512-8RipRLol37bNs2bhoV67fiTEvdTrbMUYcFTiy3+wuuOnUog2QBHCZWXDRijWQfAkhBj2Uf5UnVaiWwA5vdd82w==\",\r\n      \"license\": \"MIT\",\r\n      \"dependencies\": {\r\n        \"asynckit\": \"^0.4.0\",\r\n        \"combined-stream\": \"^1.0.8\",\r\n        \"es-set-tostringtag\": \"^2.1.0\",\r\n        \"hasown\": \"^2.0.2\",\r\n        \"mime-types\": \"^2.1.12\"\r\n      },\r\n      \"engines\": {\r\n        \"node\": \">= 6\"\r\n      }\r\n    },\r\n    \"node_modules/form-data-encoder\": {\r\n      \"version\": \"1.7.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/form-data-encoder/-/form-data-encoder-1.7.2.tgz\",\r\n      \"integrity\": \"sha512-qfqtYan3rxrnCk1VYaA4H+Ms9xdpPqvLZa6xmMgFvhO32x7/3J/ExcTd6qpxM0vH2GdMI+poehyBZvqfMTto8A==\",\r\n      \"license\": \"MIT\"\r\n    },\r\n    \"node_modules/formdata-node\": {\r\n      \"version\": \"4.4.1\",\r\n      \"resolved\": \"https://registry.npmjs.org/formdata-node/-/formdata-node-4.4.1.tgz\",\r\n      \"integrity\": \"sha512-0iirZp3uVDjVGt9p49aTaqjk84TrglENEDuqfdlZQ1roC9CWlPk6Avf8EEnZNcAqPonwkG35x4n3ww/1THYAeQ==\",\r\n      \"license\": \"MIT\",\r\n      \"dependencies\": {\r\n        \"node-domexception\": \"1.0.0\",\r\n        \"web-streams-polyfill\": \"4.0.0-beta.3\"\r\n      },\r\n      \"engines\": {\r\n        \"node\": \">= 12.20\"\r\n      }\r\n    },\r\n    \"node_modules/fsevents\": {\r\n      \"version\": \"2.3.3\",\r\n      \"resolved\": \"https://registry.npmjs.org/fsevents/-/fsevents-2.3.3.tgz\",\r\n      \"integrity\": \"sha512-5xoDfX+fL7faATnagmWPpbFtwh/R77WmMMqqHGS65C3vvB0YHrgF+B1YmZ3441tMj5n63k0212XNoJwzlhffQw==\",\r\n      \"dev\": true,\r\n      \"hasInstallScript\": true,\r\n      \"license\": \"MIT\",\r\n      \"optional\": true,\r\n      \"os\": [\r\n        \"darwin\"\r\n      ],\r\n      \"engines\": {\r\n        \"node\": \"^8.16.0 || ^10.6.0 || >=11.0.0\"\r\n      }\r\n    },\r\n    \"node_modules/function-bind\": {\r\n      \"version\": \"1.1.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/function-bind/-/function-bind-1.1.2.tgz\",\r\n      \"integrity\": \"sha512-7XHNxH7qX9xG5mIwxkhumTox/MIRNcOgDrxWsMt2pAr23WHp6MrRlN7FBSFpCpr+oVO0F744iUgR82nJMfG2SA==\",\r\n      \"license\": \"MIT\",\r\n      \"funding\": {\r\n        \"url\": \"https://github.com/sponsors/ljharb\"\r\n      }\r\n    },\r\n    \"node_modules/get-intrinsic\": {\r\n      \"version\": \"1.3.0\",\r\n      \"resolved\": \"https://registry.npmjs.org/get-intrinsic/-/get-intrinsic-1.3.0.tgz\",\r\n      \"integrity\": \"sha512-9fSjSaos/fRIVIp+xSJlE6lfwhES7LNtKaCBIamHsjr2na1BiABJPo0mOjjz8GJDURarmCPGqaiVg5mfjb98CQ==\",\r\n      \"license\": \"MIT\",\r\n      \"dependencies\": {\r\n        \"call-bind-apply-helpers\": \"^1.0.2\",\r\n        \"es-define-property\": \"^1.0.1\",\r\n        \"es-errors\": \"^1.3.0\",\r\n        \"es-object-atoms\": \"^1.1.1\",\r\n        \"function-bind\": \"^1.1.2\",\r\n        \"get-proto\": \"^1.0.1\",\r\n        \"gopd\": \"^1.2.0\",\r\n        \"has-symbols\": \"^1.1.0\",\r\n        \"hasown\": \"^2.0.2\",\r\n        \"math-intrinsics\": \"^1.1.0\"\r\n      },\r\n      \"engines\": {\r\n        \"node\": \">= 0.4\"\r\n      },\r\n      \"funding\": {\r\n        \"url\": \"https://github.com/sponsors/ljharb\"\r\n      }\r\n    },\r\n    \"node_modules/get-proto\": {\r\n      \"version\": \"1.0.1\",\r\n      \"resolved\": \"https://registry.npmjs.org/get-proto/-/get-proto-1.0.1.tgz\",\r\n      \"integrity\": \"sha512-sTSfBjoXBp89JvIKIefqw7U2CCebsc74kiY6awiGogKtoSGbgjYE/G/+l9sF3MWFPNc9IcoOC4ODfKHfxFmp0g==\",\r\n      \"license\": \"MIT\",\r\n      \"dependencies\": {\r\n        \"dunder-proto\": \"^1.0.1\",\r\n        \"es-object-atoms\": \"^1.0.0\"\r\n      },\r\n      \"engines\": {\r\n        \"node\": \">= 0.4\"\r\n      }\r\n    },\r\n    \"node_modules/get-tsconfig\": {\r\n      \"version\": \"4.13.0\",\r\n      \"resolved\": \"https://registry.npmjs.org/get-tsconfig/-/get-tsconfig-4.13.0.tgz\",\r\n      \"integrity\": \"sha512-1VKTZJCwBrvbd+Wn3AOgQP/2Av+TfTCOlE4AcRJE72W1ksZXbAx8PPBR9RzgTeSPzlPMHrbANMH3LbltH73wxQ==\",\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"dependencies\": {\r\n        \"resolve-pkg-maps\": \"^1.0.0\"\r\n      },\r\n      \"funding\": {\r\n        \"url\": \"https://github.com/privatenumber/get-tsconfig?sponsor=1\"\r\n      }\r\n    },\r\n    \"node_modules/gopd\": {\r\n      \"version\": \"1.2.0\",\r\n      \"resolved\": \"https://registry.npmjs.org/gopd/-/gopd-1.2.0.tgz\",\r\n      \"integrity\": \"sha512-ZUKRh6/kUFoAiTAtTYPZJ3hw9wNxx+BIBOijnlG9PnrJsCcSjs1wyyD6vJpaYtgnzDrKYRSqf3OO6Rfa93xsRg==\",\r\n      \"license\": \"MIT\",\r\n      \"engines\": {\r\n        \"node\": \">= 0.4\"\r\n      },\r\n      \"funding\": {\r\n        \"url\": \"https://github.com/sponsors/ljharb\"\r\n      }\r\n    },\r\n    \"node_modules/has-symbols\": {\r\n      \"version\": \"1.1.0\",\r\n      \"resolved\": \"https://registry.npmjs.org/has-symbols/-/has-symbols-1.1.0.tgz\",\r\n      \"integrity\": \"sha512-1cDNdwJ2Jaohmb3sg4OmKaMBwuC48sYni5HUw2DvsC8LjGTLK9h+eb1X6RyuOHe4hT0ULCW68iomhjUoKUqlPQ==\",\r\n      \"license\": \"MIT\",\r\n      \"engines\": {\r\n        \"node\": \">= 0.4\"\r\n      },\r\n      \"funding\": {\r\n        \"url\": \"https://github.com/sponsors/ljharb\"\r\n      }\r\n    },\r\n    \"node_modules/has-tostringtag\": {\r\n      \"version\": \"1.0.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/has-tostringtag/-/has-tostringtag-1.0.2.tgz\",\r\n      \"integrity\": \"sha512-NqADB8VjPFLM2V0VvHUewwwsw0ZWBaIdgo+ieHtK3hasLz4qeCRjYcqfB6AQrBggRKppKF8L52/VqdVsO47Dlw==\",\r\n      \"license\": \"MIT\",\r\n      \"dependencies\": {\r\n        \"has-symbols\": \"^1.0.3\"\r\n      },\r\n      \"engines\": {\r\n        \"node\": \">= 0.4\"\r\n      },\r\n      \"funding\": {\r\n        \"url\": \"https://github.com/sponsors/ljharb\"\r\n      }\r\n    },\r\n    \"node_modules/hasown\": {\r\n      \"version\": \"2.0.2\",\r\n      \"resolved\": \"https://registry.npmjs.org/hasown/-/hasown-2.0.2.tgz\",\r\n      \"integrity\": \"sha512-0hJU9SCPvmMzIBdZFqNPXWa6dqh7WdH0cII9y+CyS8rG3nL48Bclra9HmKhVVUHyPWNH5Y7xDwAB7bfgSjkUMQ==\",\r\n      \"license\": \"MIT\",\r\n      \"dependencies\": {\r\n        \"function-bind\": \"^1.1.2\"\r\n      },\r\n      \"engines\": {\r\n        \"node\": \">= 0.4\"\r\n      }\r\n    },\r\n    \"node_modules/humanize-ms\": {\r\n      \"version\": \"1.2.1\",\r\n      \"resolved\": \"https://registry.npmjs.org/humanize-ms/-/humanize-ms-1.2.1.tgz\",\r\n      \"integrity\": \"sha512-Fl70vYtsAFb/C06PTS9dZBo7ihau+Tu/DNCk/OyHhea07S+aeMWpFFkUaXRa8fI+ScZbEI8dfSxwY7gxZ9SAVQ==\",\r\n      \"license\": \"MIT\",\r\n      \"dependencies\": {\r\n        \"ms\": \"^2.0.0\"\r\n      }\r\n    },\r\n    \"node_modules/math-intrinsics\": {\r\n      \"version\": \"1.1.0\",\r\n      \"resolved\": \"https://registry.npmjs.org/math-intrinsics/-/math-intrinsics-1.1.0.tgz\",\r\n      \"integrity\": \"sha512-/IXtbwEk5HTPyEwyKX6hGkYXxM9nbj64B+ilVJnC/R6B0pH5G4V3b0pVbL7DBj4tkhBAppbQUlf6F6Xl9LHu1g==\",\r\n      \"license\": \"MIT\",\r\n      \"engines\": {\r\n        \"node\": \">= 0.4\"\r\n      }\r\n    },\r\n    \"node_modules/mime-db\": {\r\n      \"version\": \"1.52.0\",\r\n      \"resolved\": \"https://registry.npmjs.org/mime-db/-/mime-db-1.52.0.tgz\",\r\n      \"integrity\": \"sha512-sPU4uV7dYlvtWJxwwxHD0PuihVNiE7TyAbQ5SWxDCB9mUYvOgroQOwYQQOKPJ8CIbE+1ETVlOoK1UC2nU3gYvg==\",\r\n      \"license\": \"MIT\",\r\n      \"engines\": {\r\n        \"node\": \">= 0.6\"\r\n      }\r\n    },\r\n    \"node_modules/mime-types\": {\r\n      \"version\": \"2.1.35\",\r\n      \"resolved\": \"https://registry.npmjs.org/mime-types/-/mime-types-2.1.35.tgz\",\r\n      \"integrity\": \"sha512-ZDY+bPm5zTTF+YpCrAU9nK0UgICYPT0QtT1NZWFv4s++TNkcgVaT0g6+4R2uI4MjQjzysHB1zxuWL50hzaeXiw==\",\r\n      \"license\": \"MIT\",\r\n      \"dependencies\": {\r\n        \"mime-db\": \"1.52.0\"\r\n      },\r\n      \"engines\": {\r\n        \"node\": \">= 0.6\"\r\n      }\r\n    },\r\n    \"node_modules/ms\": {\r\n      \"version\": \"2.1.3\",\r\n      \"resolved\": \"https://registry.npmjs.org/ms/-/ms-2.1.3.tgz\",\r\n      \"integrity\": \"sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==\",\r\n      \"license\": \"MIT\"\r\n    },\r\n    \"node_modules/node-domexception\": {\r\n      \"version\": \"1.0.0\",\r\n      \"resolved\": \"https://registry.npmjs.org/node-domexception/-/node-domexception-1.0.0.tgz\",\r\n      \"integrity\": \"sha512-/jKZoMpw0F8GRwl4/eLROPA3cfcXtLApP0QzLmUT/HuPCZWyB7IY9ZrMeKw2O/nFIqPQB3PVM9aYm0F312AXDQ==\",\r\n      \"deprecated\": \"Use your platform's native DOMException instead\",\r\n      \"funding\": [\r\n        {\r\n          \"type\": \"github\",\r\n          \"url\": \"https://github.com/sponsors/jimmywarting\"\r\n        },\r\n        {\r\n          \"type\": \"github\",\r\n          \"url\": \"https://paypal.me/jimmywarting\"\r\n        }\r\n      ],\r\n      \"license\": \"MIT\",\r\n      \"engines\": {\r\n        \"node\": \">=10.5.0\"\r\n      }\r\n    },\r\n    \"node_modules/node-fetch\": {\r\n      \"version\": \"2.7.0\",\r\n      \"resolved\": \"https://registry.npmjs.org/node-fetch/-/node-fetch-2.7.0.tgz\",\r\n      \"integrity\": \"sha512-c4FRfUm/dbcWZ7U+1Wq0AwCyFL+3nt2bEw05wfxSz+DWpWsitgmSgYmy2dQdWyKC1694ELPqMs/YzUSNozLt8A==\",\r\n      \"license\": \"MIT\",\r\n      \"dependencies\": {\r\n        \"whatwg-url\": \"^5.0.0\"\r\n      },\r\n      \"engines\": {\r\n        \"node\": \"4.x || >=6.0.0\"\r\n      },\r\n      \"peerDependencies\": {\r\n        \"encoding\": \"^0.1.0\"\r\n      },\r\n      \"peerDependenciesMeta\": {\r\n        \"encoding\": {\r\n          \"optional\": true\r\n        }\r\n      }\r\n    },\r\n    \"node_modules/openai\": {\r\n      \"version\": \"4.104.0\",\r\n      \"resolved\": \"https://registry.npmjs.org/openai/-/openai-4.104.0.tgz\",\r\n      \"integrity\": \"sha512-p99EFNsA/yX6UhVO93f5kJsDRLAg+CTA2RBqdHK4RtK8u5IJw32Hyb2dTGKbnnFmnuoBv5r7Z2CURI9sGZpSuA==\",\r\n      \"license\": \"Apache-2.0\",\r\n      \"dependencies\": {\r\n        \"@types/node\": \"^18.11.18\",\r\n        \"@types/node-fetch\": \"^2.6.4\",\r\n        \"abort-controller\": \"^3.0.0\",\r\n        \"agentkeepalive\": \"^4.2.1\",\r\n        \"form-data-encoder\": \"1.7.2\",\r\n        \"formdata-node\": \"^4.3.2\",\r\n        \"node-fetch\": \"^2.6.7\"\r\n      },\r\n      \"bin\": {\r\n        \"openai\": \"bin/cli\"\r\n      },\r\n      \"peerDependencies\": {\r\n        \"ws\": \"^8.18.0\",\r\n        \"zod\": \"^3.23.8\"\r\n      },\r\n      \"peerDependenciesMeta\": {\r\n        \"ws\": {\r\n          \"optional\": true\r\n        },\r\n        \"zod\": {\r\n          \"optional\": true\r\n        }\r\n      }\r\n    },\r\n    \"node_modules/resolve-pkg-maps\": {\r\n      \"version\": \"1.0.0\",\r\n      \"resolved\": \"https://registry.npmjs.org/resolve-pkg-maps/-/resolve-pkg-maps-1.0.0.tgz\",\r\n      \"integrity\": \"sha512-seS2Tj26TBVOC2NIc2rOe2y2ZO7efxITtLZcGSOnHHNOQ7CkiUBfw0Iw2ck6xkIhPwLhKNLS8BO+hEpngQlqzw==\",\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"funding\": {\r\n        \"url\": \"https://github.com/privatenumber/resolve-pkg-maps?sponsor=1\"\r\n      }\r\n    },\r\n    \"node_modules/tr46\": {\r\n      \"version\": \"0.0.3\",\r\n      \"resolved\": \"https://registry.npmjs.org/tr46/-/tr46-0.0.3.tgz\",\r\n      \"integrity\": \"sha512-N3WMsuqV66lT30CrXNbEjx4GEwlow3v6rr4mCcv6prnfwhS01rkgyFdjPNBYd9br7LpXV1+Emh01fHnq2Gdgrw==\",\r\n      \"license\": \"MIT\"\r\n    },\r\n    \"node_modules/tsx\": {\r\n      \"version\": \"4.21.0\",\r\n      \"resolved\": \"https://registry.npmjs.org/tsx/-/tsx-4.21.0.tgz\",\r\n      \"integrity\": \"sha512-5C1sg4USs1lfG0GFb2RLXsdpXqBSEhAaA/0kPL01wxzpMqLILNxIxIOKiILz+cdg/pLnOUxFYOR5yhHU666wbw==\",\r\n      \"dev\": true,\r\n      \"license\": \"MIT\",\r\n      \"dependencies\": {\r\n        \"esbuild\": \"~0.27.0\",\r\n        \"get-tsconfig\": \"^4.7.5\"\r\n      },\r\n      \"bin\": {\r\n        \"tsx\": \"dist/cli.mjs\"\r\n      },\r\n      \"engines\": {\r\n        \"node\": \">=18.0.0\"\r\n      },\r\n      \"optionalDependencies\": {\r\n        \"fsevents\": \"~2.3.3\"\r\n      }\r\n    },\r\n    \"node_modules/typescript\": {\r\n      \"version\": \"5.9.3\",\r\n      \"resolved\": \"https://registry.npmjs.org/typescript/-/typescript-5.9.3.tgz\",\r\n      \"integrity\": \"sha512-jl1vZzPDinLr9eUt3J/t7V6FgNEw9QjvBPdysz9KfQDD41fQrC2Y4vKQdiaUpFT4bXlb1RHhLpp8wtm6M5TgSw==\",\r\n      \"dev\": true,\r\n      \"license\": \"Apache-2.0\",\r\n      \"bin\": {\r\n        \"tsc\": \"bin/tsc\",\r\n        \"tsserver\": \"bin/tsserver\"\r\n      },\r\n      \"engines\": {\r\n        \"node\": \">=14.17\"\r\n      }\r\n    },\r\n    \"node_modules/undici-types\": {\r\n      \"version\": \"5.26.5\",\r\n      \"resolved\": \"https://registry.npmjs.org/undici-types/-/undici-types-5.26.5.tgz\",\r\n      \"integrity\": \"sha512-JlCMO+ehdEIKqlFxk6IfVoAUVmgz7cU7zD/h9XZ0qzeosSHmUJVOzSQvvYSYWXkFXC+IfLKSIffhv0sVZup6pA==\",\r\n      \"license\": \"MIT\"\r\n    },\r\n    \"node_modules/web-streams-polyfill\": {\r\n      \"version\": \"4.0.0-beta.3\",\r\n      \"resolved\": \"https://registry.npmjs.org/web-streams-polyfill/-/web-streams-polyfill-4.0.0-beta.3.tgz\",\r\n      \"integrity\": \"sha512-QW95TCTaHmsYfHDybGMwO5IJIM93I/6vTRk+daHTWFPhwh+C8Cg7j7XyKrwrj8Ib6vYXe0ocYNrmzY4xAAN6ug==\",\r\n      \"license\": \"MIT\",\r\n      \"engines\": {\r\n        \"node\": \">= 14\"\r\n      }\r\n    },\r\n    \"node_modules/webidl-conversions\": {\r\n      \"version\": \"3.0.1\",\r\n      \"resolved\": \"https://registry.npmjs.org/webidl-conversions/-/webidl-conversions-3.0.1.tgz\",\r\n      \"integrity\": \"sha512-2JAn3z8AR6rjK8Sm8orRC0h/bcl/DqL7tRPdGZ4I1CjdF+EaMLmYxBHyXuKL849eucPFhvBoxMsflfOb8kxaeQ==\",\r\n      \"license\": \"BSD-2-Clause\"\r\n    },\r\n    \"node_modules/whatwg-url\": {\r\n      \"version\": \"5.0.0\",\r\n      \"resolved\": \"https://registry.npmjs.org/whatwg-url/-/whatwg-url-5.0.0.tgz\",\r\n      \"integrity\": \"sha512-saE57nupxk6v3HY35+jzBwYa0rKSy0XR8JSxZPwgLr7ys0IBzhGviA1/TUGJLmSVqs8pb9AnvICXEuOHLprYTw==\",\r\n      \"license\": \"MIT\",\r\n      \"dependencies\": {\r\n        \"tr46\": \"~0.0.3\",\r\n        \"webidl-conversions\": \"^3.0.0\"\r\n      }\r\n    }\r\n  }\r\n}\r\n"
    },
    "package.json": {
      "bytes": 365,
      "content": "{\r\n  \"name\": \"coding-agent\",\r\n  \"private\": true,\r\n  \"type\": \"module\",\r\n  \"scripts\": {\r\n    \"dev\": \"tsx src/cli.ts\",\r\n    \"test\": \"node --import tsx --test\"\r\n  },\r\n  \"dependencies\": {\r\n    \"dotenv\": \"^16.4.5\",\r\n    \"openai\": \"^4.0.0\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"tsx\": \"^4.19.2\",\r\n    \"typescript\": \"^5.5.4\"\r\n  },\r\n  \"engines\": {\r\n    \"node\": \">=18\"\r\n  }\r\n}\r\n"
    },
    "resources/prompts/codeAgentPromt.txt": {
      "bytes": 2845,
      "content": "Jesteś wyspecjalizowanym agentem do edycji repozytorium kodu, działającym wyłącznie poprzez narzędzia (tool calling).\r\n\r\nROLA:\r\nTwoim zadaniem jest precyzyjna, minimalna i bezpieczna modyfikacja kodu zgodnie z poleceniem użytkownika.\r\n\r\nZASADY NADRZĘDNE:\r\n1. Zawsze używaj read_file przed jakąkolwiek modyfikacją pliku.\r\n2. Każda zmiana musi być poprzedzona analizą istniejącego kodu.\r\n3. Minimalizuj zakres zmian – nie wykonuj refactorów ani masowego formatowania, jeśli nie jest to wymagane.\r\n4. Preferuj edycję patch-based (apply_patch) do drobnych/poprawkowych zmian w plikach. write_file używaj do tworzenia nowych plików lub gdy świadomie podmieniasz cały plik.\r\n5. Przy write_file zawsze podawaj pełną, nową zawartość pliku.\r\n6. Nie wykonuj poleceń systemowych ani shellowych.\r\n7. Do interakcji z repozytorium używaj wyłącznie dostępnych narzędzi.\r\n\r\nOGRANICZENIA BEZPIECZEŃSTWA:\r\n8. Pracujesz wyłącznie w obrębie repozytorium wskazanego przez --repo.\r\n9. Path traversal (np. ../) jest zabroniony.\r\n10. Nie czytaj ani nie zapisuj następujących ścieżek i plików:\r\n    - .git/\r\n    - node_modules/\r\n    - dist/\r\n    - .env\r\n    - *.pem\r\n    - *.key\r\n\r\nEDYCJA PATCH-BASED (apply_patch):\r\n11. Używaj narzędzia apply_patch, aby stosować zmiany w formie patcha (unified, bez nagłówków hunk). Format patcha musi być zgodny z diff_file_against_original:\r\n    - Nagłówki pliku: \"--- a/<ścieżka>\" i \"+++ b/<ścieżka>\",\r\n    - Linijki treści z prefiksami: \" \" (bez zmian), \"+\" (dodaj), \"-\" (usuń),\r\n    - Bez nagłówków hunk (@@ ... @@). Dokładnie taki format generuje diff_file_against_original.\r\n12. Przed apply_patch musisz wywołać read_file dla każdego istniejącego pliku, który patch ma zmodyfikować (narzędzie to egzekwuje).\r\n13. Patch powinien obejmować tylko niezbędne zmiany. Nie stosuj patchy, które wprowadzają niepowiązane modyfikacje.\r\n14. Nie używaj patcha do usuwania plików – do usunięcia służy delete_file. Tworzenie nowych plików przez patch jest dozwolone (sekcja \"+\" bez bazowej zawartości).\r\n\r\nZASADY PRACY Z KODEM:\r\n15. Jeśli nie znasz struktury repozytorium, użyj list_files.\r\n16. Jeśli musisz znaleźć konkretny fragment kodu, użyj search_in_files lub list_files + read_file.\r\n17. Zachowuj istniejące konwencje kodu, styl i architekturę.\r\n18. Nie wprowadzaj zmian wykraczających poza zakres zadania użytkownika.\r\n19. Nie obniżaj bezpieczeństwa ani nie zmieniaj publicznych kontraktów API bez wyraźnego polecenia.\r\n\r\nSTRATEGIA DZIAŁANIA:\r\n20. Działaj sekwencyjnie: analiza → minimalna zmiana → zapis.\r\n21. Każda modyfikacja musi mieć jednoznaczne uzasadnienie w kontekście zadania.\r\n\r\nCEL:\r\nZrealizuj polecenie użytkownika w sposób precyzyjny, minimalnie inwazyjny, bezpieczny i w pełni kontrolowany przez narzędzia.\r\n"
    },
    "src/agent/log.ts": {
      "bytes": 2320,
      "content": "import fs from \"node:fs\";\r\nimport path from \"node:path\";\r\n\r\nfunction redactString(input: string): string {\r\n  if (!input) return input;\r\n  let s = input;\r\n  // Mask key=value and key: value patterns for common secret keys\r\n  const keyPattern = /(api_key|apikey|token|secret|password|client_secret|private_key)\\s*([:=])\\s*([^\\s,;\"']+)/gi;\r\n  s = s.replace(keyPattern, (_m, k: string, sep: string) => `${k}${sep} ****`);\r\n  // Mask Authorization: Bearer xxx and Bearer xxx\r\n  s = s.replace(/authorization\\s*:\\s*bearer\\s+[^\\s]+/gi, \"Authorization: Bearer ****\");\r\n  s = s.replace(/bearer\\s+[^\\s]+/gi, \"Bearer ****\");\r\n  return s;\r\n}\r\n\r\nfunction redactValue(val: any): any {\r\n  if (typeof val === \"string\") return redactString(val);\r\n  if (Array.isArray(val)) return val.map((v) => redactValue(v));\r\n  if (val && typeof val === \"object\") {\r\n    const out: Record<string, any> = {};\r\n    for (const [k, v] of Object.entries(val)) out[k] = redactValue(v);\r\n    return out;\r\n  }\r\n  return val;\r\n}\r\n\r\nexport class AgentLogger {\r\n  private readonly rawPath: string;\r\n\r\n  constructor(private readonly repoRoot: string) {\r\n    // Ensure repo root exists for logs/outputs\r\n    try {\r\n      fs.mkdirSync(repoRoot, { recursive: true });\r\n    } catch (e: any) {\r\n      console.error(\r\n        \"[agent] ERROR: Nie można utworzyć katalogu repoRoot:\",\r\n        repoRoot,\r\n        \"\\nPowód:\",\r\n        e?.message ?? String(e)\r\n      );\r\n      process.exitCode = 1;\r\n      // Twarde zakończenie aby uniknąć kolejnych błędów zapisu logów/plików wyjściowych\r\n      process.exit(1);\r\n    }\r\n    this.rawPath = path.join(repoRoot, \"agent.raw.txt\");\r\n  }\r\n\r\n  initNewRun(meta: { task: string; model: string; startedAt: string }) {\r\n    this.appendLine(\"=== AGENT RUN START ===\");\r\n    this.appendJSON({ type: \"meta\", ...meta });\r\n  }\r\n\r\n  appendLine(line: string) {\r\n    const safe = redactString(line ?? \"\");\r\n    fs.appendFileSync(this.rawPath, safe + \"\\n\", \"utf8\");\r\n  }\r\n\r\n  appendJSON(obj: any) {\r\n    const redacted = redactValue(obj);\r\n    const line = JSON.stringify(redacted);\r\n    fs.appendFileSync(this.rawPath, line + \"\\n\", \"utf8\");\r\n  }\r\n\r\n  saveDiffText(diffText: string) {\r\n    const outPath = path.join(this.repoRoot, \"agent.diff.txt\");\r\n    fs.writeFileSync(outPath, diffText, \"utf8\");\r\n    return outPath;\r\n  }\r\n}\r\n"
    },
    "src/agent/run.ts": {
      "bytes": 7300,
      "content": "import path from \"node:path\";\r\nimport fs from \"node:fs\";\r\nimport { spawnSync } from \"node:child_process\";\r\n\r\nimport { openai } from \"../openai.ts\";\r\nimport { AgentLogger } from \"./log.ts\";\r\nimport { RepoTools } from \"./tools.ts\";\r\nimport { SandboxOptions, listFilesRecursive } from \"./security.ts\";\r\n\r\n/**\r\n * Konfiguracja bezpieczeństwa repo sandbox.\r\n */\r\nexport function defaultSandboxOptions(repoRoot: string): SandboxOptions {\r\n  return {\r\n    repoRoot,\r\n    denyDirs: [\".git\", \"node_modules\", \"dist\"],\r\n    denyFilesExact: [\".env\"],\r\n    denyExtensions: [\".pem\", \".key\"],\r\n    maxReadBytes: 400_000,\r\n    maxWriteBytes: 800_000,\r\n  };\r\n}\r\n\r\nexport type AgentRunOptions = {\r\n  repoRoot: string;\r\n  task: string;\r\n  model?: string; // np. \"gpt-5\"\r\n  maxToolCalls?: number; // domyślnie 50\r\n};\r\n\r\nfunction nowIso() {\r\n  return new Date().toISOString();\r\n}\r\n\r\nfunction safeGitDiff(repoRoot: string): { ok: boolean; diff?: string; error?: string } {\r\n  // Jedyna komenda systemowa” jaką wykonujemy: git diff\r\n  const res = spawnSync(\"git\", [\"diff\"], {\r\n    cwd: repoRoot,\r\n    shell: false,\r\n    encoding: \"utf8\",\r\n  });\r\n\r\n  if (res.status !== 0) {\r\n    return { ok: false, error: `${res.stdout}\\n${res.stderr}`.trim() };\r\n  }\r\n  return { ok: true, diff: res.stdout ?? \"\" };\r\n}\r\n\r\nfunction buildSystemPrompt(repoRoot: string) {\r\n  // Zawsze wczytuj prompt z pliku: resources/prompts/codeAgentPromt.txt (relatywnie do repoRoot)\r\n  const promptPath = path.join(repoRoot, \"resources\", \"prompts\", \"codeAgentPromt.txt\");\r\n  if (!fs.existsSync(promptPath)) {\r\n    throw new Error(`Brak pliku promptu: ${promptPath}`);\r\n  }\r\n  const content = fs.readFileSync(promptPath, \"utf8\");\r\n  const normalized = (content ?? \"\").replace(/\\r\\n/g, \"\\n\").trim();\r\n  if (!normalized) {\r\n    throw new Error(`Plik promptu jest pusty: ${promptPath}`);\r\n  }\r\n  return normalized;\r\n}\r\n\r\n/**\r\n * Tworzy snapshot bazowy repozytorium na potrzeby review.\r\n * Zapisuje .agent_baseline.json w katalogu głównym repo.\r\n */\r\nfunction createBaseline(opts: SandboxOptions): { path: string; files: number } {\r\n  const repoRoot = path.resolve(opts.repoRoot);\r\n  const baselinePath = path.join(repoRoot, \".agent_baseline.json\");\r\n\r\n  const files = listFilesRecursive(opts, 5000);\r\n  const data: any = {\r\n    createdAt: nowIso(),\r\n    maxReadBytes: opts.maxReadBytes,\r\n    files: {} as Record<string, { bytes: number; content: string | null }>,\r\n  };\r\n\r\n  for (const rel of files) {\r\n    try {\r\n      const abs = path.join(repoRoot, rel.replaceAll(\"/\", path.sep));\r\n      const st = fs.statSync(abs);\r\n      if (!st.isFile()) continue;\r\n      if (st.size <= opts.maxReadBytes) {\r\n        const content = fs.readFileSync(abs, \"utf8\");\r\n        data.files[rel] = { bytes: st.size, content };\r\n      } else {\r\n        data.files[rel] = { bytes: st.size, content: null };\r\n      }\r\n    } catch {\r\n      // pomiń pliki, których nie da się odczytać\r\n    }\r\n  }\r\n\r\n  fs.writeFileSync(baselinePath, JSON.stringify(data, null, 2), \"utf8\");\r\n  return { path: baselinePath, files: Object.keys(data.files).length };\r\n}\r\n\r\n/**\r\n * Agent loop z tool calling.\r\n *\r\n * WAŻNE:\r\n * - Używamy previous_response_id, więc NIE odsyłamy function_call itemów z powrotem w input,\r\n *   bo mają id (fc_...) i API zwraca 400 Duplicate item found.\r\n * - Odsyłamy tylko function_call_output z call_id.\r\n */\r\nexport async function runAgent(opts: AgentRunOptions): Promise<void> {\r\n  const repoRoot = path.resolve(opts.repoRoot);\r\n  const task = opts.task.trim();\r\n  const model = opts.model ?? \"gpt-5\";\r\n  const maxToolCalls = Math.max(1, Math.min(opts.maxToolCalls ?? 50, 50));\r\n\r\n  const logger = new AgentLogger(repoRoot);\r\n  logger.initNewRun({ task, model, startedAt: nowIso() });\r\n\r\n  const sandbox = defaultSandboxOptions(repoRoot);\r\n\r\n  // Utwórz snapshot bazowy dla funkcji review\r\n  try {\r\n    const b = createBaseline(sandbox);\r\n    logger.appendJSON({ type: \"baseline_created\", at: nowIso(), path: b.path, files: b.files });\r\n  } catch (e: any) {\r\n    logger.appendJSON({ type: \"baseline_error\", at: nowIso(), error: e?.message ?? String(e) });\r\n  }\r\n\r\n  const tools = new RepoTools(sandbox);\r\n\r\n  logger.appendJSON({ type: \"model_request\", at: nowIso(), model, phase: \"initial\" });\r\n\r\n  // Pierwsze wywołanie: system + user\r\n  let response = await openai.responses.create({\r\n    model,\r\n    tools: tools.getToolSpecs() as any,\r\n    input: [\r\n      { role: \"system\", content: buildSystemPrompt(repoRoot) },\r\n      { role: \"user\", content: task },\r\n    ],\r\n  });\r\n\r\n  let toolCallsUsed = 0;\r\n\r\n  while (true) {\r\n    const outputItems: any[] = (response as any).output ?? [];\r\n\r\n    logger.appendJSON({\r\n      type: \"model_response\",\r\n      at: nowIso(),\r\n      id: (response as any).id,\r\n      output_text: (response as any).output_text ?? \"\",\r\n      output: outputItems,\r\n    });\r\n\r\n    const functionCalls = outputItems.filter((it) => it?.type === \"function_call\");\r\n\r\n    // Jeśli model nie woła narzędzi, kończymy\r\n    if (functionCalls.length === 0) break;\r\n\r\n    const nextInput: any[] = [];\r\n\r\n    for (const item of functionCalls) {\r\n      toolCallsUsed++;\r\n      if (toolCallsUsed > maxToolCalls) {\r\n        throw new Error(`Tool call limit exceeded (${maxToolCalls}).`);\r\n      }\r\n\r\n      const name = item.name as any;\r\n      const callId = item.call_id;\r\n      const argsRaw = item.arguments ?? \"{}\";\r\n\r\n      logger.appendJSON({\r\n        type: \"tool_call\",\r\n        at: nowIso(),\r\n        call_id: callId,\r\n        name,\r\n        arguments: argsRaw,\r\n      });\r\n\r\n      let args: any = {};\r\n      try {\r\n        args = typeof argsRaw === \"string\" ? JSON.parse(argsRaw) : argsRaw;\r\n      } catch {\r\n        args = {};\r\n      }\r\n\r\n      const result = await tools.dispatch({ name, arguments: args } as any);\r\n\r\n      logger.appendJSON({\r\n        type: \"tool_result\",\r\n        at: nowIso(),\r\n        call_id: callId,\r\n        name,\r\n        ok: result.ok,\r\n        error: result.error,\r\n        result_preview:\r\n          result.result && typeof result.result === \"object\"\r\n            ? JSON.stringify(result.result).slice(0, 5000)\r\n            : String(result.result ?? \"\").slice(0, 5000),\r\n      });\r\n\r\n      // Odsyłamy TYLKO output narzędzia\r\n      nextInput.push({\r\n        type: \"function_call_output\",\r\n        call_id: callId,\r\n        output: JSON.stringify(result),\r\n      });\r\n    }\r\n\r\n    logger.appendJSON({\r\n      type: \"model_request\",\r\n      at: nowIso(),\r\n      model,\r\n      phase: \"followup\",\r\n      tool_calls_used: toolCallsUsed,\r\n      followup_items: nextInput.length,\r\n    });\r\n\r\n    response = await openai.responses.create({\r\n      model,\r\n      tools: tools.getToolSpecs() as any,\r\n      previous_response_id: (response as any).id,\r\n      input: nextInput,\r\n    });\r\n  }\r\n\r\n  // Po zakończeniu agent loop: generujemy lokalnie agent.diff.txt (bez udziału modelu)\r\n  const diffRes = safeGitDiff(repoRoot);\r\n  if (diffRes.ok) {\r\n    const out = logger.saveDiffText(diffRes.diff ?? \"\");\r\n    logger.appendLine(`=== SAVED DIFF: ${out} ===`);\r\n  } else {\r\n    logger.appendLine(\"=== WARNING: git diff failed (repo may not be git). Diff omitted. ===\");\r\n    logger.appendJSON({ type: \"git_diff_error\", at: nowIso(), error: diffRes.error });\r\n  }\r\n\r\n  logger.appendLine(\"=== AGENT RUN END ===\");\r\n}\r\n"
    },
    "src/agent/security.ts": {
      "bytes": 4586,
      "content": "import path from \"node:path\";\nimport fs from \"node:fs\";\n\nexport type SandboxOptions = {\n  repoRoot: string;\n  denyDirs: string[]; // np. [\".git\", \"node_modules\", \"dist\"]\n  denyFilesExact: string[]; // np. [\".env\"]\n  denyExtensions: string[]; // np. [\".pem\", \".key\"]\n  maxReadBytes: number; // np. 400_000\n  maxWriteBytes: number; // np. 800_000\n};\n\nexport type SafePathResult = {\n  absPath: string;\n  relPath: string; // zawsze POSIX (\"/\")\n};\n\n/**\n * Sprawdza denylistę na ścieżce relatywnej (POSIX).\n */\nexport function isDeniedPath(opts: SandboxOptions, relPosixPath: string): boolean {\n  const pRaw = relPosixPath.replace(/^\\/+/, \"\"); // bez wiodących /\n  const p = pRaw.toLowerCase();\n\n  const denyFiles = opts.denyFilesExact.map((s) => s.toLowerCase());\n  const denyExts = opts.denyExtensions.map((s) => s.toLowerCase());\n  const denyDirs = opts.denyDirs.map((s) => s.toLowerCase());\n\n  // zablokuj pliki dokładne\n  const base = path.posix.basename(p);\n  if (denyFiles.includes(base)) return true;\n\n  // zablokuj rozszerzenia\n  const ext = path.posix.extname(base);\n  if (ext && denyExts.includes(ext)) return true;\n\n  // zablokuj katalogi na dowolnym poziomie\n  const segments = p.split(\"/\");\n  for (const seg of segments) {\n    if (denyDirs.includes(seg)) return true;\n  }\n\n  return false;\n}\n\n/**\n * Normalizuje ścieżkę i blokuje path traversal.\n * Zwraca relPath (POSIX) i absPath.\n */\nexport function resolveInRepo(opts: SandboxOptions, userPath: string): SafePathResult {\n  if (typeof userPath !== \"string\") {\n    throw new Error(\"Invalid path: expected string\");\n  }\n  if (userPath.includes(\"\\u0000\")) {\n    throw new Error(\"Invalid path: null byte\");\n  }\n  const userPathTrimmed = userPath.trim();\n  if (!userPathTrimmed) {\n    throw new Error(`Invalid path: \"${userPath}\"`);\n  }\n\n  const realRepoAbs = fs.realpathSync(path.resolve(opts.repoRoot));\n  const candidateAbs = path.resolve(realRepoAbs, userPathTrimmed);\n\n  // Ustal realną ścieżkę kandydata z obsługą nieistniejącego pliku\n  let realCandidateAbs: string;\n  try {\n    realCandidateAbs = fs.realpathSync(candidateAbs);\n  } catch {\n    const parent = path.dirname(candidateAbs);\n    const base = path.basename(candidateAbs);\n    let realParent: string;\n    try {\n      realParent = fs.realpathSync(parent);\n    } catch {\n      throw new Error(`Invalid path: \"${userPath}\"`);\n    }\n    realCandidateAbs = path.join(realParent, base);\n  }\n\n  // Warunek bezpieczeństwa: musi zaczynać się od realRepoAbs + path.sep\n  const mustStart = realRepoAbs + path.sep;\n  if (!realCandidateAbs.startsWith(mustStart)) {\n    throw new Error(`Path traversal blocked: \"${userPath}\"`);\n  }\n\n  // Oblicz relatywną ścieżkę na podstawie realnych ścieżek\n  const relFromRepo = path.relative(realRepoAbs, realCandidateAbs);\n  const relPosix = relFromRepo.replaceAll(path.sep, \"/\");\n\n  if (!relPosix || relPosix.trim() === \"\") {\n    // root repo lub pusta ścieżka\n    throw new Error(`Invalid path: \"${userPath}\"`);\n  }\n\n  // Zablokuj katalogi – ta funkcja zwraca ścieżki tylko do plików\n  try {\n    if (fs.existsSync(realCandidateAbs)) {\n      const st = fs.lstatSync(realCandidateAbs);\n      if (st.isDirectory()) {\n        throw new Error(`Invalid path: \"${userPath}\"`);\n      }\n    }\n  } catch {\n    throw new Error(`Invalid path: \"${userPath}\"`);\n  }\n\n  if (isDeniedPath(opts, relPosix)) {\n    throw new Error(`Access denied by policy: \"${relPosix}\"`);\n  }\n\n  return { absPath: realCandidateAbs, relPath: relPosix };\n}\n\nexport function ensureParentDirExists(fileAbsPath: string): void {\n  const dir = path.dirname(fileAbsPath);\n  fs.mkdirSync(dir, { recursive: true });\n}\n\n/**\n * Bezpieczne listowanie plików w repo (z ignorowaniem denylist).\n * Zwraca relatywne ścieżki POSIX.\n */\nexport function listFilesRecursive(opts: SandboxOptions, maxFiles = 5000): string[] {\n  const repoAbs = path.resolve(opts.repoRoot);\n  const results: string[] = [];\n\n  function walk(dirAbs: string) {\n    if (results.length >= maxFiles) return;\n\n    let entries: fs.Dirent[];\n    try {\n      entries = fs.readdirSync(dirAbs, { withFileTypes: true });\n    } catch {\n      return;\n    }\n\n    for (const e of entries) {\n      if (results.length >= maxFiles) return;\n\n      const childAbs = path.join(dirAbs, e.name);\n      const rel = path.relative(repoAbs, childAbs).replaceAll(path.sep, \"/\");\n\n      if (!rel || isDeniedPath(opts, rel)) continue;\n\n      if (e.isDirectory()) {\n        walk(childAbs);\n      } else if (e.isFile()) {\n        results.push(rel);\n      }\n    }\n  }\n\n  walk(repoAbs);\n  return results.sort();\n}\n"
    },
    "src/agent/tools.ts": {
      "bytes": 26087,
      "content": "import fs from \"node:fs\";\nimport path from \"node:path\";\nimport crypto from \"node:crypto\";\nimport {\n  SandboxOptions,\n  listFilesRecursive,\n  resolveInRepo,\n  ensureParentDirExists,\n} from \"./security.ts\";\n\nexport type ToolName =\n  | \"list_files\"\n  | \"read_file\"\n  | \"write_file\"\n  | \"delete_file\"\n  | \"search_in_files\"\n  | \"get_baseline_info\"\n  | \"list_changed_files\"\n  | \"read_file_original\"\n  | \"diff_file_against_original\"\n  | \"apply_patch\";\n\nexport type ToolCall = {\n  name: ToolName;\n  arguments: any;\n};\n\nexport type ToolResult = {\n  ok: boolean;\n  result?: any;\n  error?: string;\n};\n\nconst BASELINE_FILENAME = \".agent_baseline.json\";\nconst LCS_MAX_TOTAL_LINES = 10000; // hard limit for LCS-based diff\n\nexport class RepoTools {\n  private readonly readFilesThisRun = new Set<string>();\n\n  constructor(private readonly opts: SandboxOptions) {}\n\n  /**\n   * Specyfikacje narzędzi dla modelu (function calling).\n   */\n  getToolSpecs() {\n    return [\n      {\n        type: \"function\",\n        name: \"list_files\",\n        description:\n          \"List files in the repository. Returns relative POSIX paths. Denylisted dirs/files are excluded.\",\n        parameters: {\n          type: \"object\",\n          additionalProperties: false,\n          properties: {\n            prefix: {\n              type: \"string\",\n              description: \"Optional prefix filter (POSIX, e.g. 'src/' ).\",\n            },\n            limit: {\n              type: \"integer\",\n              description: \"Max number of files to return (default 2000).\",\n              minimum: 1,\n              maximum: 5000,\n            },\n          },\n        },\n      },\n      {\n        type: \"function\",\n        name: \"read_file\",\n        description:\n          \"Read a text file from repo. MUST be called before modifying a file. Denylist and size limit apply.\",\n        parameters: {\n          type: \"object\",\n          additionalProperties: false,\n          properties: {\n            path: { type: \"string\", description: \"Relative path inside repo.\" },\n          },\n          required: [\"path\"],\n        },\n      },\n      {\n        type: \"function\",\n        name: \"write_file\",\n        description:\n          \"Write (create/overwrite) a text file inside repo. Provide full new file content. Denylist and size limit apply.\",\n        parameters: {\n          type: \"object\",\n          additionalProperties: false,\n          properties: {\n            path: { type: \"string\", description: \"Relative path inside repo.\" },\n            content: { type: \"string\", description: \"Full new file content.\" },\n          },\n          required: [\"path\", \"content\"],\n        },\n      },\n      {\n        type: \"function\",\n        name: \"delete_file\",\n        description:\n          \"Delete a file inside repo. Use only when explicitly needed. Denylist applies.\",\n        parameters: {\n          type: \"object\",\n          additionalProperties: false,\n          properties: {\n            path: { type: \"string\", description: \"Relative path inside repo.\" },\n          },\n          required: [\"path\"],\n        },\n      },\n      {\n        type: \"function\",\n        name: \"search_in_files\",\n        description:\n          \"Search for a substring in text files (simple contains). Returns matches with file and line numbers. Denylist and max file size apply.\",\n        parameters: {\n          type: \"object\",\n          additionalProperties: false,\n          properties: {\n            query: { type: \"string\", description: \"Substring to search for.\" },\n            prefix: { type: \"string\", description: \"Optional path prefix filter, e.g. 'src/'.\" },\n            limit_files: { type: \"integer\", minimum: 1, maximum: 2000 },\n            limit_matches: { type: \"integer\", minimum: 1, maximum: 2000 },\n          },\n          required: [\"query\"],\n        },\n      },\n      {\n        type: \"function\",\n        name: \"get_baseline_info\",\n        description:\n          \"Get metadata about the initial repository snapshot used for review (created at agent start).\",\n        parameters: { type: \"object\", additionalProperties: false, properties: {} },\n      },\n      {\n        type: \"function\",\n        name: \"list_changed_files\",\n        description:\n          \"List added/modified/deleted files compared to the baseline snapshot (created at agent start).\",\n        parameters: {\n          type: \"object\",\n          additionalProperties: false,\n          properties: {\n            prefix: { type: \"string\", description: \"Optional path prefix filter, e.g. 'src/'.\" },\n            limit: { type: \"integer\", minimum: 1, maximum: 5000 },\n          },\n        },\n      },\n      {\n        type: \"function\",\n        name: \"read_file_original\",\n        description:\n          \"Read file content from the baseline snapshot (original version at agent start).\",\n        parameters: {\n          type: \"object\",\n          additionalProperties: false,\n          properties: {\n            path: { type: \"string\", description: \"Relative path inside repo.\" },\n          },\n          required: [\"path\"],\n        },\n      },\n      {\n        type: \"function\",\n        name: \"diff_file_against_original\",\n        description:\n          \"Compute a simple unified diff between current file content and the baseline (original). Returns summary and diff text.\",\n        parameters: {\n          type: \"object\",\n          additionalProperties: false,\n          properties: {\n            path: { type: \"string\", description: \"Relative path inside repo.\" },\n            max_lines: { type: \"integer\", description: \"Max diff lines to include in output (default 2000).\", minimum: 1, maximum: 10000 },\n          },\n          required: [\"path\"],\n        },\n      },\n      {\n        type: \"function\",\n        name: \"apply_patch\",\n        description:\n          \"Apply a simple unified patch (without hunk headers) to one or more files. The format must match output of diff_file_against_original (lines starting with '--- a/', '+++ b/' followed by lines prefixed with space, '+' or '-'). Requires prior read_file for every existing file being modified.\",\n        parameters: {\n          type: \"object\",\n          additionalProperties: false,\n          properties: {\n            patch: { type: \"string\", description: \"Unified patch text for one or more files.\" },\n          },\n          required: [\"patch\"],\n        },\n      },\n    ] as const;\n  }\n\n  async dispatch(call: ToolCall): Promise<ToolResult> {\n    try {\n      switch (call.name) {\n        case \"list_files\":\n          return { ok: true, result: this.listFiles(call.arguments) };\n        case \"read_file\":\n          return { ok: true, result: this.readFile(call.arguments) };\n        case \"write_file\":\n          return { ok: true, result: this.writeFile(call.arguments) };\n        case \"delete_file\":\n          return { ok: true, result: this.deleteFile(call.arguments) };\n        case \"search_in_files\":\n          return { ok: true, result: this.searchInFiles(call.arguments) };\n        case \"get_baseline_info\":\n          return { ok: true, result: this.getBaselineInfo() };\n        case \"list_changed_files\":\n          return { ok: true, result: this.listChangedFiles(call.arguments) };\n        case \"read_file_original\":\n          return { ok: true, result: this.readFileOriginal(call.arguments) };\n        case \"diff_file_against_original\":\n          return { ok: true, result: this.diffFileAgainstOriginal(call.arguments) };\n        case \"apply_patch\":\n          return { ok: true, result: this.applyPatch(call.arguments) };\n        default:\n          return { ok: false, error: `Unknown tool: ${(call as any).name}` };\n      }\n    } catch (e: any) {\n      return { ok: false, error: e?.message ?? String(e) };\n    }\n  }\n\n  private listFiles(args: { prefix?: string; limit?: number }) {\n    const all = listFilesRecursive(this.opts, 5000);\n    const prefix = (args.prefix ?? \"\").trim();\n    let out = all;\n    if (prefix) out = out.filter((p) => p.startsWith(prefix));\n    const limit = Math.min(Math.max(args.limit ?? 2000, 1), 5000);\n    return { files: out.slice(0, limit), total: out.length };\n  }\n\n  private readFile(args: { path: string }) {\n    const { absPath, relPath } = resolveInRepo(this.opts, args.path);\n\n    const st = fs.statSync(absPath);\n    if (!st.isFile()) throw new Error(`Not a file: ${relPath}`);\n\n    if (st.size > this.opts.maxReadBytes) {\n      throw new Error(\n        `File too large for read_file (${st.size} bytes > ${this.opts.maxReadBytes}): ${relPath}`\n      );\n    }\n\n    const content = fs.readFileSync(absPath, \"utf8\");\n    this.readFilesThisRun.add(relPath);\n    return { path: relPath, bytes: st.size, content };\n  }\n\n  private writeFile(args: { path: string; content: string }) {\n    const { absPath, relPath } = resolveInRepo(this.opts, args.path);\n\n    const content = args.content ?? \"\";\n    const bytes = Buffer.byteLength(content, \"utf8\");\n    if (bytes > this.opts.maxWriteBytes) {\n      throw new Error(\n        `Content too large for write_file (${bytes} bytes > ${this.opts.maxWriteBytes}): ${relPath}`\n      );\n    }\n\n    // Enforce read_file before write for existing files\n    const exists = fs.existsSync(absPath);\n    if (exists && !this.readFilesThisRun.has(relPath)) {\n      throw new Error(`MUST read_file before write_file for existing file: ${relPath}`);\n    }\n\n    ensureParentDirExists(absPath);\n    fs.writeFileSync(absPath, content, \"utf8\");\n    return { path: relPath, bytes };\n  }\n\n  private deleteFile(args: { path: string }) {\n    const { absPath, relPath } = resolveInRepo(this.opts, args.path);\n\n    if (!fs.existsSync(absPath)) {\n      return { path: relPath, deleted: false, reason: \"not_found\" as const };\n    }\n    const st = fs.statSync(absPath);\n    if (!st.isFile()) throw new Error(`Not a file: ${relPath}`);\n\n    fs.unlinkSync(absPath);\n    return { path: relPath, deleted: true };\n  }\n\n  private searchInFiles(args: {\n    query: string;\n    prefix?: string;\n    limit_files?: number;\n    limit_matches?: number;\n  }) {\n    const query = (args.query ?? \"\").toString();\n    if (!query) throw new Error(\"query is required\");\n\n    const prefix = (args.prefix ?? \"\").trim();\n    const limitFiles = Math.min(Math.max(args.limit_files ?? 800, 1), 2000);\n    const limitMatches = Math.min(Math.max(args.limit_matches ?? 200, 1), 2000);\n\n    const all = listFilesRecursive(this.opts, 5000)\n      .filter((p) => (prefix ? p.startsWith(prefix) : true))\n      .slice(0, limitFiles);\n\n    const matches: Array<{ path: string; line: number; text: string }> = [];\n\n    for (const rel of all) {\n      if (matches.length >= limitMatches) break;\n\n      // Resolve safely within the repo (guards against symlink escape)\n      let absPath: string;\n      let relPath: string;\n      try {\n        const r = resolveInRepo(this.opts, rel);\n        absPath = r.absPath;\n        relPath = r.relPath;\n      } catch {\n        // Skip files that cannot be safely resolved\n        continue;\n      }\n\n      let st: fs.Stats;\n      try {\n        st = fs.statSync(absPath);\n      } catch {\n        continue;\n      }\n      if (!st.isFile()) continue;\n      if (st.size > this.opts.maxReadBytes) continue;\n\n      const content = fs.readFileSync(absPath, \"utf8\");\n      if (!content.includes(query)) continue;\n\n      const lines = content.split(/\\r?\\n/);\n      for (let i = 0; i < lines.length; i++) {\n        if (matches.length >= limitMatches) break;\n        if (lines[i].includes(query)) {\n          matches.push({ path: relPath, line: i + 1, text: lines[i].slice(0, 400) });\n        }\n      }\n    }\n\n    return { query, matches, scanned_files: all.length };\n  }\n\n  private baselinePath(): string {\n    return path.join(this.opts.repoRoot, BASELINE_FILENAME);\n  }\n\n  private loadBaseline(): {\n    createdAt: string;\n    maxReadBytes: number;\n    files: Record<string, { bytes: number; content: string | null }>;\n  } {\n    const p = this.baselinePath();\n    if (!fs.existsSync(p)) {\n      throw new Error(\"Baseline snapshot not found. It should be created automatically at agent start.\");\n    }\n    const raw = fs.readFileSync(p, \"utf8\");\n    let json: any;\n    try {\n      json = JSON.parse(raw);\n    } catch {\n      throw new Error(\"Invalid baseline file JSON.\");\n    }\n    if (!json || typeof json !== \"object\" || !json.files) {\n      throw new Error(\"Invalid baseline format.\");\n    }\n    return json;\n  }\n\n  private getBaselineInfo() {\n    const b = this.loadBaseline();\n    const count = Object.keys(b.files).length;\n    return { created_at: b.createdAt, files: count, maxReadBytes: b.maxReadBytes };\n  }\n\n  private listChangedFiles(args: { prefix?: string; limit?: number }) {\n    const b = this.loadBaseline();\n    const baselineFiles = Object.keys(b.files);\n    const currentFiles = listFilesRecursive(this.opts, 5000);\n\n    const prefix = (args.prefix ?? \"\").trim();\n    const filt = (p: string) => (prefix ? p.startsWith(prefix) : true);\n\n    const baselineSet = new Set(baselineFiles);\n    const currentSet = new Set(currentFiles);\n\n    const added = currentFiles.filter((p) => !baselineSet.has(p) && filt(p));\n    const deleted = baselineFiles.filter((p) => !currentSet.has(p) && filt(p));\n\n    const modified: string[] = [];\n    for (const p of currentFiles) {\n      if (!baselineSet.has(p)) continue;\n      if (!filt(p)) continue;\n      const abs = path.resolve(this.opts.repoRoot, p.replaceAll(\"/\", path.sep));\n      let st: fs.Stats;\n      try {\n        st = fs.statSync(abs);\n      } catch {\n        continue;\n      }\n      const base = b.files[p];\n      if (!base) continue;\n      if (st.size !== base.bytes) {\n        modified.push(p);\n      } else if (base.content != null && st.size <= this.opts.maxReadBytes) {\n        try {\n          const currentContent = fs.readFileSync(abs, \"utf8\");\n          if (currentContent !== base.content) modified.push(p);\n        } catch {}\n      }\n    }\n\n    const limit = Math.min(Math.max(args.limit ?? 2000, 1), 5000);\n    return {\n      baseline_files: baselineFiles.length,\n      current_files: currentFiles.length,\n      added: added.slice(0, limit),\n      deleted: deleted.slice(0, limit),\n      modified: modified.slice(0, limit),\n    };\n  }\n\n  private readFileOriginal(args: { path: string }) {\n    const { relPath } = resolveInRepo(this.opts, args.path);\n    const b = this.loadBaseline();\n    const base = b.files[relPath];\n    if (!base) {\n      return { path: relPath, existed: false };\n    }\n    return { path: relPath, existed: true, bytes: base.bytes, content: base.content };\n  }\n\n  private diffFileAgainstOriginal(args: { path: string; max_lines?: number }) {\n    const { absPath, relPath } = resolveInRepo(this.opts, args.path);\n    const b = this.loadBaseline();\n    const base = b.files[relPath];\n\n    let currentExists = fs.existsSync(absPath) && fs.statSync(absPath).isFile();\n\n    if (!base && !currentExists) {\n      return {\n        path: relPath,\n        status: \"unchanged\",\n        summary: { before_bytes: 0, after_bytes: 0, added_lines: 0, removed_lines: 0 },\n        note: \"File did not exist in baseline and still does not exist.\",\n      };\n    }\n\n    const maxLines = Math.min(Math.max(args.max_lines ?? 2000, 1), 10000);\n\n    if (!base && currentExists) {\n      const content = this.safeRead(absPath, this.opts.maxReadBytes);\n      const lines = content.split(/\\r?\\n/);\n      const diff = this.buildUnifiedDiff(relPath, [], lines, maxLines);\n      return {\n        path: relPath,\n        status: \"added\",\n        summary: { before_bytes: 0, after_bytes: Buffer.byteLength(content, \"utf8\"), added_lines: lines.length, removed_lines: 0 },\n        diff_text: diff,\n      };\n    }\n\n    if (base && !currentExists) {\n      const baseLines = (base.content ?? \"\").split(/\\r?\\n/);\n      const diff = this.buildUnifiedDiff(relPath, baseLines, [], maxLines);\n      return {\n        path: relPath,\n        status: \"deleted\",\n        summary: { before_bytes: base.bytes, after_bytes: 0, added_lines: 0, removed_lines: baseLines.length },\n        diff_text: diff,\n      };\n    }\n\n    // both exist\n    const baseContent = base!.content;\n    if (baseContent == null) {\n      const st = fs.statSync(absPath);\n      const changed = st.size !== base!.bytes;\n      return {\n        path: relPath,\n        status: changed ? \"modified\" : \"unchanged\",\n        summary: { before_bytes: base!.bytes, after_bytes: st.size, added_lines: 0, removed_lines: 0 },\n        note: \"Original file too large for content diff; compared by size only.\",\n      };\n    }\n\n    // We have baseline content; decide whether to run LCS or fallback\n    const curStat = fs.statSync(absPath);\n    const afterBytes = curStat.size;\n    const canReadCurrent = afterBytes <= this.opts.maxReadBytes;\n\n    if (!canReadCurrent) {\n      // Fallback: compare by size only, and include hash for baseline\n      const beforeBytes = Buffer.byteLength(baseContent, \"utf8\");\n      const baseHash = crypto.createHash(\"sha256\").update(baseContent, \"utf8\").digest(\"hex\");\n      const status = beforeBytes === afterBytes ? \"unchanged\" : \"modified\";\n      const header = [`--- a/${relPath}`, `+++ b/${relPath}`, `@@ DIFF OMITTED: file too large for content read @@`].join(\"\\n\");\n      return {\n        path: relPath,\n        status,\n        summary: { before_bytes: beforeBytes, after_bytes: afterBytes, added_lines: 0, removed_lines: 0 },\n        note: `Diff omitted due to size limit. before_bytes=${beforeBytes}, after_bytes=${afterBytes}, before_sha256=${baseHash}, after_sha256=unavailable` ,\n        diff_text: header,\n      };\n    }\n\n    const currentContent = fs.readFileSync(absPath, \"utf8\");\n    const baseLines = baseContent.split(/\\r?\\n/);\n    const curLines = currentContent.split(/\\r?\\n/);\n\n    if (baseLines.length + curLines.length > LCS_MAX_TOTAL_LINES) {\n      // Fallback: fast compare using sizes and hashes\n      const beforeBytes = Buffer.byteLength(baseContent, \"utf8\");\n      const afterBytes2 = Buffer.byteLength(currentContent, \"utf8\");\n      const baseHash = crypto.createHash(\"sha256\").update(baseContent, \"utf8\").digest(\"hex\");\n      const curHash = crypto.createHash(\"sha256\").update(currentContent, \"utf8\").digest(\"hex\");\n      const modified = beforeBytes !== afterBytes2 || baseHash !== curHash;\n      const header = [`--- a/${relPath}`, `+++ b/${relPath}`, `@@ DIFF OMITTED: total line limit exceeded (${baseLines.length + curLines.length} > ${LCS_MAX_TOTAL_LINES}) @@`].join(\"\\n\");\n      return {\n        path: relPath,\n        status: modified ? \"modified\" : \"unchanged\",\n        summary: { before_bytes: beforeBytes, after_bytes: afterBytes2, added_lines: 0, removed_lines: 0 },\n        note: `Diff omitted due to line limit. before_bytes=${beforeBytes}, after_bytes=${afterBytes2}, before_sha256=${baseHash}, after_sha256=${curHash}`,\n        diff_text: header,\n      };\n    }\n\n    const ops = this.diffLines(baseLines, curLines);\n    let added = 0;\n    let removed = 0;\n    for (const op of ops) {\n      if (op.type === \"add\") added += op.lines.length;\n      if (op.type === \"remove\") removed += op.lines.length;\n    }\n    const diff = this.buildUnifiedDiff(relPath, baseLines, curLines, maxLines, ops);\n\n    return {\n      path: relPath,\n      status: added === 0 && removed === 0 ? \"unchanged\" : \"modified\",\n      summary: {\n        before_bytes: Buffer.byteLength(baseContent, \"utf8\"),\n        after_bytes: Buffer.byteLength(currentContent, \"utf8\"),\n        added_lines: added,\n        removed_lines: removed,\n      },\n      diff_text: diff,\n    };\n  }\n\n  private safeRead(absPath: string, limit: number): string {\n    const st = fs.statSync(absPath);\n    if (st.size > limit) {\n      throw new Error(`File too large for diff (${st.size} bytes > ${limit}): ${absPath}`);\n    }\n    return fs.readFileSync(absPath, \"utf8\");\n  }\n\n  // Prosty LCS diff linii\n  private diffLines(a: string[], b: string[]): Array<{ type: \"equal\" | \"add\" | \"remove\"; lines: string[] }> {\n    const m = a.length;\n    const n = b.length;\n    const dp: number[][] = Array.from({ length: m + 1 }, () => Array(n + 1).fill(0));\n    for (let i = m - 1; i >= 0; i--) {\n      for (let j = n - 1; j >= 0; j--) {\n        if (a[i] === b[j]) dp[i][j] = dp[i + 1][j + 1] + 1;\n        else dp[i][j] = Math.max(dp[i + 1][j], dp[i][j + 1]);\n      }\n    }\n    const ops: Array<{ type: \"equal\" | \"add\" | \"remove\"; lines: string[] }> = [];\n    let i = 0,\n      j = 0;\n    while (i < m && j < n) {\n      if (a[i] === b[j]) {\n        this.pushOp(ops, \"equal\", a[i]);\n        i++;\n        j++;\n      } else if (dp[i + 1][j] >= dp[i][j + 1]) {\n        this.pushOp(ops, \"remove\", a[i]);\n        i++;\n      } else {\n        this.pushOp(ops, \"add\", b[j]);\n        j++;\n      }\n    }\n    while (i < m) {\n      this.pushOp(ops, \"remove\", a[i++]);\n    }\n    while (j < n) {\n      this.pushOp(ops, \"add\", b[j++]);\n    }\n    return ops;\n  }\n\n  private pushOp(\n    ops: Array<{ type: \"equal\" | \"add\" | \"remove\"; lines: string[] }>,\n    type: \"equal\" | \"add\" | \"remove\",\n    line: string\n  ) {\n    const last = ops[ops.length - 1];\n    if (last && last.type === type) {\n      last.lines.push(line);\n    } else {\n      ops.push({ type, lines: [line] });\n    }\n  }\n\n  private buildUnifiedDiff(\n    relPath: string,\n    a: string[],\n    b: string[],\n    maxLines: number,\n    precomputedOps?: Array<{ type: \"equal\" | \"add\" | \"remove\"; lines: string[] }>\n  ): string {\n    const ops = precomputedOps ?? this.diffLines(a, b);\n    const header = [`--- a/${relPath}`, `+++ b/${relPath}`];\n    const body: string[] = [];\n    for (const op of ops) {\n      for (const line of op.lines) {\n        if (body.length >= maxLines) break;\n        if (op.type === \"equal\") body.push(\" \" + line);\n        else if (op.type === \"add\") body.push(\"+\" + line);\n        else body.push(\"-\" + line);\n      }\n      if (body.length >= maxLines) break;\n    }\n    return header.concat(body).join(\"\\n\");\n  }\n\n  private applyPatch(args: { patch: string }) {\n    const patch = (args.patch ?? \"\").toString();\n    if (!patch.trim()) throw new Error(\"patch is required\");\n\n    type FilePatch = { relPath: string; lines: string[] };\n    const sections: FilePatch[] = [];\n    const lines = patch.replace(/\\r\\n/g, \"\\n\").split(\"\\n\");\n\n    let i = 0;\n    while (i < lines.length) {\n      const line = lines[i];\n      if (line?.startsWith(\"--- a/\")) {\n        const next = lines[i + 1] ?? \"\";\n        if (!next.startsWith(\"+++ b/\")) {\n          throw new Error(\"Invalid patch format: expected '+++ b/...' after '--- a/...'\");\n        }\n        const pathA = line.slice(6).trim(); // after '--- a/'\n        const pathB = next.slice(6).trim(); // after '+++ b/'\n        if (!pathA || !pathB) throw new Error(\"Invalid patch headers: empty path\");\n        // Use B path as target\n        const targetRel = pathB;\n        i += 2;\n        const body: string[] = [];\n        while (i < lines.length && !lines[i].startsWith(\"--- a/\")) {\n          const bLine = lines[i];\n          if (bLine.startsWith(\" \") || bLine.startsWith(\"+\") || bLine.startsWith(\"-\")) {\n            body.push(bLine);\n          }\n          i++;\n        }\n        sections.push({ relPath: targetRel, lines: body });\n      } else {\n        i++;\n      }\n    }\n\n    if (sections.length === 0) {\n      throw new Error(\"No file sections found in patch\");\n    }\n\n    // First pass: validate and compute new contents without writing\n    const plannedWrites: Array<{\n      relPath: string;\n      absPath: string;\n      existedBefore: boolean;\n      beforeBytes: number;\n      afterBytes: number;\n      newContent: string;\n    }> = [];\n\n    for (const sec of sections) {\n      const { absPath, relPath } = resolveInRepo(this.opts, sec.relPath);\n\n      const exists = fs.existsSync(absPath) && fs.statSync(absPath).isFile();\n      const beforeContent = exists ? fs.readFileSync(absPath, \"utf8\") : \"\";\n      const beforeLines = beforeContent.split(/\\r?\\n/);\n\n      // Build base and after from patch body\n      const baseFromPatch: string[] = [];\n      const afterFromPatch: string[] = [];\n      for (const l of sec.lines) {\n        if (l.startsWith(\" \")) {\n          const t = l.slice(1);\n          baseFromPatch.push(t);\n          afterFromPatch.push(t);\n        } else if (l.startsWith(\"-\")) {\n          baseFromPatch.push(l.slice(1));\n        } else if (l.startsWith(\"+\")) {\n          afterFromPatch.push(l.slice(1));\n        }\n      }\n\n      if (exists) {\n        if (!this.readFilesThisRun.has(relPath)) {\n          throw new Error(`MUST read_file before apply_patch for existing file: ${relPath}`);\n        }\n        // Validate base matches current file\n        if (beforeLines.join(\"\\n\") !== baseFromPatch.join(\"\\n\")) {\n          throw new Error(\n            `Patch base does not match current content for ${relPath}. Read the file and regenerate patch.`\n          );\n        }\n      } else {\n        // For new files, base must be empty\n        if (baseFromPatch.length > 0 && baseFromPatch.join(\"\\n\").trim() !== \"\") {\n          throw new Error(\n            `Patch for ${relPath} implies non-empty base, but file does not exist. Create file with write_file or provide correct patch.`\n          );\n        }\n      }\n\n      const newContent = afterFromPatch.join(\"\\n\");\n      const afterBytes = Buffer.byteLength(newContent, \"utf8\");\n      if (afterBytes > this.opts.maxWriteBytes) {\n        throw new Error(\n          `Resulting content too large for apply_patch (${afterBytes} bytes > ${this.opts.maxWriteBytes}): ${relPath}`\n        );\n      }\n\n      plannedWrites.push({\n        relPath,\n        absPath,\n        existedBefore: exists,\n        beforeBytes: Buffer.byteLength(beforeContent, \"utf8\"),\n        afterBytes,\n        newContent,\n      });\n    }\n\n    // Second pass: perform writes\n    for (const w of plannedWrites) {\n      ensureParentDirExists(w.absPath);\n      fs.writeFileSync(w.absPath, w.newContent, \"utf8\");\n    }\n\n    return {\n      files: plannedWrites.map((w) => ({\n        path: w.relPath,\n        existed_before: w.existedBefore,\n        before_bytes: w.beforeBytes,\n        after_bytes: w.afterBytes,\n        status: w.existedBefore ? (w.beforeBytes === w.afterBytes ? \"unchanged\" : \"modified\") : \"created\",\n      })),\n    };\n  }\n}\n"
    },
    "src/cli.ts": {
      "bytes": 2425,
      "content": "import \"dotenv/config\";\nimport path from \"node:path\";\n\nimport { runAgent } from \"./agent/run.ts\";\n\nfunction getArgValue(argv: string[], name: string): string | undefined {\n  const idx = argv.indexOf(name);\n  return idx === -1 ? undefined : argv[idx + 1];\n}\n\nfunction usage() {\n  console.log(`\nUżycie:\n  npm run dev -- edit \"<OPIS>\" --repo <ścieżka>\n\nOpis:\n  edit uruchamia agentową pętlę tool-calling.\n  Agent modyfikuje pliki bezpośrednio (write_file) lub przez patch-based edycję (apply_patch),\n  loguje przebieg do agent.raw.txt oraz zapisuje raport git diff do agent.diff.txt (jeśli możliwe).\n\nWymagania:\n  Wymaga skonfigurowanego klucza OPENAI_API_KEY (plik .env lub zmienna środowiskowa). Przykład w .env.example.\n`);\n}\n\nasync function main() {\n  const cmd = process.argv[2];\n\n  if (!cmd) {\n    usage();\n    process.exitCode = 1;\n    return;\n  }\n\n  const normalizedCmd = cmd.toLowerCase();\n  const isEdit = normalizedCmd === \"edit\";\n\n  if (!isEdit) {\n    usage();\n    process.exitCode = 1;\n    return;\n  }\n\n  // Walidacja argumentu --repo pod kątem placeholderów\n  const rawRepoArg = getArgValue(process.argv, \"--repo\");\n  if (rawRepoArg && /[<>]/.test(rawRepoArg)) {\n    console.error(\n      \"[agent] ERROR: Wykryto placeholder w argumencie --repo. Podaj prawdziwą ścieżkę do repozytorium.\\n\",\n    );\n    console.error(\"Przykład: --repo .    lub    --repo /pełna/ścieżka/do/repo\");\n    process.exitCode = 1;\n    return;\n  }\n\n  const repoRoot = path.resolve(rawRepoArg ?? process.cwd());\n\n  // Task to wszystko pomiędzy komendą a --repo\n  const repoIdx = process.argv.indexOf(\"--repo\");\n  const taskParts = repoIdx === -1 ? process.argv.slice(3) : process.argv.slice(3, repoIdx);\n  const task = taskParts.join(\" \").trim();\n\n  if (!task) {\n    console.error(\"[agent] ERROR: Brak opisu zadania.\");\n    usage();\n    process.exitCode = 1;\n    return;\n  }\n\n  console.log(\"[agent] Working (tool-calling loop)...\");\n  await runAgent({ repoRoot, task, model: process.env.OPENAI_MODEL ?? \"gpt-5\", maxToolCalls: 50 });\n\n  console.log(\"[agent] Done.\");\n  console.log(`- Log: ${path.join(repoRoot, \"agent.raw.txt\")}`);\n  console.log(`- Diff: ${path.join(repoRoot, \"agent.diff.txt\")} (jeśli git diff działa)`);\n  console.log(\"Przejrzyj zmiany w VS Code → Source Control.\");\n}\n\nmain().catch((e: any) => {\n  console.error(\"[agent] ERROR:\", e?.stack ?? e?.message ?? String(e));\n  process.exitCode = 1;\n});\n"
    },
    "src/openai.ts": {
      "bytes": 385,
      "content": "import OpenAI from \"openai\";\r\n\r\n/**\r\n * Minimalny klient OpenAI.\r\n * Wymaga zmiennej OPENAI_API_KEY.\r\n */\r\nconst apiKey = process.env.OPENAI_API_KEY;\r\nif (!apiKey || !apiKey.trim()) {\r\n  throw new Error(\r\n    \"[agent] Brak OPENAI_API_KEY. Ustaw zmienną środowiskową lub wpisz klucz w pliku .env (patrz .env.example).\"\r\n  );\r\n}\r\n\r\nexport const openai = new OpenAI({\r\n  apiKey,\r\n});\r\n"
    },
    "tests/security.test.ts": {
      "bytes": 2594,
      "content": "import path from \"node:path\";\nimport fs from \"node:fs\";\nimport os from \"node:os\";\nimport { test } from \"node:test\";\nimport assert from \"node:assert/strict\";\nimport { fileURLToPath } from \"node:url\";\nimport { resolveInRepo, isDeniedPath, type SandboxOptions } from \"../src/agent/security.ts\";\n\nfunction defaultOpts(repoRoot: string): SandboxOptions {\n  return {\n    repoRoot,\n    denyDirs: [\".git\", \"node_modules\", \"dist\"],\n    denyFilesExact: [\".env\"],\n    denyExtensions: [\".pem\", \".key\"],\n    maxReadBytes: 400_000,\n    maxWriteBytes: 800_000,\n  };\n}\n\nfunction repoRootFromTests(): string {\n  // tests/ -> repo root\n  const __filename = fileURLToPath(import.meta.url);\n  const __dirname = path.dirname(__filename);\n  return path.resolve(__dirname, \"..\");\n}\n\ntest(\"resolveInRepo: poprawna ścieżka src/cli.ts\", () => {\n  const repoRoot = repoRootFromTests();\n  const opts = defaultOpts(repoRoot);\n  const res = resolveInRepo(opts, \"src/cli.ts\");\n  assert.equal(res.relPath, \"src/cli.ts\");\n  assert.ok(fs.existsSync(res.absPath), \"absPath powinien istnieć\");\n  const st = fs.statSync(res.absPath);\n  assert.ok(st.isFile(), \"powinien być plikiem\");\n});\n\ntest(\"resolveInRepo: blokada ../x (path traversal)\", () => {\n  const repoRoot = repoRootFromTests();\n  const opts = defaultOpts(repoRoot);\n  assert.throws(() => resolveInRepo(opts, \"../x\"), /Path traversal blocked/);\n});\n\ntest(\"resolveInRepo: blokada ucieczki przez symlink poza repo\", () => {\n  const base = fs.mkdtempSync(path.join(os.tmpdir(), \"repo-sec-\"));\n  const repoDir = path.join(base, \"repo\");\n  fs.mkdirSync(repoDir);\n\n  // plik poza repo\n  const outsideFile = path.join(base, \"outside.txt\");\n  fs.writeFileSync(outsideFile, \"outside\");\n\n  // symlink w repo wskazujący poza repo\n  const linkPath = path.join(repoDir, \"link-out.txt\");\n  try {\n    fs.symlinkSync(outsideFile, linkPath);\n  } catch (e) {\n    // Na niektórych systemach tworzenie symlinków może wymagać uprawnień.\n    // Jeśli nie można utworzyć symlinka, pomiń test.\n    console.warn(\"[test] pominięto tworzenie symlinków:\", (e as any)?.message ?? e);\n    return;\n  }\n\n  const opts = defaultOpts(repoDir);\n  assert.throws(() => resolveInRepo(opts, \"link-out.txt\"), /Path traversal blocked/);\n});\n\ntest(\"denylist: case-insensitive .Git\", () => {\n  const repoRoot = repoRootFromTests();\n  const opts = defaultOpts(repoRoot);\n\n  // isDeniedPath bezpośrednio\n  assert.equal(isDeniedPath(opts, \".Git/config\"), true);\n\n  // resolveInRepo powinno zablokować dostęp\n  assert.throws(() => resolveInRepo(opts, \".Git/config\"), /Access denied by policy/);\n});\n"
    },
    "tests/tools-search.test.ts": {
      "bytes": 2006,
      "content": "import path from \"node:path\";\nimport fs from \"node:fs\";\nimport os from \"node:os\";\nimport { test } from \"node:test\";\nimport assert from \"node:assert/strict\";\n\nimport { RepoTools } from \"../src/agent/tools.ts\";\nimport type { SandboxOptions } from \"../src/agent/security.ts\";\n\nfunction defaultOpts(repoRoot: string): SandboxOptions {\n  return {\n    repoRoot,\n    denyDirs: [\".git\", \"node_modules\", \"dist\"],\n    denyFilesExact: [\".env\"],\n    denyExtensions: [\".pem\", \".key\"],\n    maxReadBytes: 400_000,\n    maxWriteBytes: 800_000,\n  };\n}\n\ntest(\"search_in_files: ignores symlink pointing outside repo and does not crash\", async () => {\n  const base = fs.mkdtempSync(path.join(os.tmpdir(), \"repo-search-\"));\n  const repoDir = path.join(base, \"repo\");\n  fs.mkdirSync(repoDir);\n\n  // Create a regular file inside repo (does not contain the query)\n  const insideFile = path.join(repoDir, \"inside.txt\");\n  fs.writeFileSync(insideFile, \"hello inside\\nno secrets here\\n\");\n\n  // Create a file outside repo that contains the query\n  const outsideFile = path.join(base, \"outside.txt\");\n  fs.writeFileSync(outsideFile, \"this contains secret-token which should not be read\\n\");\n\n  // Symlink inside repo pointing to outside file\n  const linkPath = path.join(repoDir, \"link-out.txt\");\n  try {\n    fs.symlinkSync(outsideFile, linkPath);\n  } catch (e) {\n    console.warn(\"[test] symlink creation skipped:\", (e as any)?.message ?? e);\n    return; // skip test on systems without symlink permissions\n  }\n\n  const tools = new RepoTools(defaultOpts(repoDir));\n  const res = await tools.dispatch({\n    name: \"search_in_files\",\n    arguments: { query: \"secret-token\", limit_files: 100, limit_matches: 50 },\n  } as any);\n\n  assert.equal(res.ok, true, res.error ?? \"search_in_files failed\");\n  const out: any = res.result;\n  assert.ok(out && typeof out === \"object\");\n  assert.equal(Array.isArray(out.matches), true);\n  // Should not find matches from the symlink pointing outside the repo\n  assert.equal(out.matches.length, 0);\n});\n"
    },
    "tsconfig.json": {
      "bytes": 286,
      "content": "{\r\n  \"compilerOptions\": {\r\n    \"target\": \"ES2022\",\r\n    \"module\": \"ES2022\",\r\n    \"moduleResolution\": \"Bundler\",\r\n    \"allowImportingTsExtensions\": true,\r\n    \"strict\": true,\r\n    \"skipLibCheck\": true,\r\n    \"noEmit\": true,\r\n    \"types\": [\"node\"]\r\n  },\r\n  \"include\": [\"src\", \"tests\"]\r\n}\r\n"
    }
  }
}